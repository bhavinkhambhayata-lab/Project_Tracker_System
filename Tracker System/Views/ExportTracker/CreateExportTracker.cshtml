@model Tracker_System.Models.Exporttracker
@{
    ViewBag.Title = "CreateExportTracker";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@*<style>
        .tr-yellow {
            background-color: yellow !important;
        }

        .tr-green {
            background-color: #ccffcc !important; /* light green */
        }
    </style>*@
@using (Html.BeginForm())
{
    @Html.HiddenFor(model => model.UserName)
    @Html.HiddenFor(model => model.Password)
    <section>
        <div class="box" style="width:auto;">
            <div class="box-body" style="width:auto;">
                <div class="clearfix"></div>
                <div id="tabs" class="nav-tabs-custom" style=" margin-top: -15px !important;">
                    <hr />
                    <ul class="nav nav-tabs" style=" margin-top: -6px !important; font-size:15px;">

                        <li id="lnkList" class="HeaderFont active"><a style="font-size:15px!important;" href="#tabList" data-toggle="tab" onclick="clearDetailsForm();GetData();"><b> @resourceSettings.getResourceLable("lblList", "common", "List")</b></a></li>
                        <li><a id="#lnkDetail" class="HeaderFont" style="font-size:15px!important;" href="#tabDetail" data-toggle="tab" onclick=""><b> @resourceSettings.getResourceLable("lblDetails", "common", "Details")</b></a></li>
                    </ul>
                </div>
                <div class="tab-content">
                    <div id="tabList" class="tab-pane active">
                        <div class="box">
                            <div class="col-md-12 form-group" id="invoiceNoSearchSectionList" style="margin-top: 6px !important; ">

                                <label for="searchType">@resourceSettings.getResourceLable("lblSearchType", "common", "Search Type")</label>
                                @Html.DropDownListFor(model => model.SearchType, new SelectList(ViewBag.SearchTypes, "Value", "Text"), new { @class = "form-control", onchange = "getgriddetails()", @id = "searchType", style = "width: 100px;" })
                                <a href="#" id="lnkExportToExcel" class="btn-cancel" style=" width: 14rem;">
                                    <i class="fa fa-eraser"></i>
                                    @resourceSettings.getResourceLable("lblExportToExcel", "common", "Export To Excel")
                                </a>

                                <div id="Accountpage" style=" margin-top: -17px; margin-left: 131rem; text-align: end;"></div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="form-group"></div>
                            <div class="box-body">
                                <div class="col-md-12 form-group" style=" margin-left: -13px !important; margin-top: -16px!important;">
                                    <div class="table-responsive">

                                        <div id="loadingMessage1" style="text-align:center; padding:20px; font-size:16px; display:none;">
                                            <span><i class="fa fa-spinner fa-spin" style="font-size:100px"></i> Loading data, please wait...</span>
                                        </div>
                             
                                            <table id="TblExportTrackerInfo" class="table table-bordered table-striped mt-4">
                                                <thead style="text-align:center!important;">
                                                    <tr>
                                                        <th  class="sticky-left-header" colspan="6" rowspan="2" style=" border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                           
                                                        </th>
                                                        <th   colspan="23" rowspan="2" style="border-left: 2px solid #918989; border-right: 2px solid #918989; border-top: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Invoice Details
                                                        </th>
                                                        <th colspan="2" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Clearance Charges
                                                        </th>
                                                        <th colspan="3" style="text-align: center; border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; font-weight: bold; background-color: #f0f0f0; ">
                                                            Forwarder Charges
                                                        </th>


                                                        <th colspan="2" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Transportation Charges
                                                        </th>
                                                        <th colspan="2" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            CFS Charges
                                                        </th>
                                                        <th colspan="2" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Additional Transportation Charges
                                                        </th>
                                                        <th colspan="2" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            COO Charges
                                                        </th>
                                                        <th colspan="2" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Export Inspection Agency Charges
                                                        </th>

                                                        <th colspan="2" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Other Charges (IF ANY)
                                                        </th>
                                                        <th colspan="2" rowspan="2" style="border-right: 2px solid #918989; white-space: nowrap; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Other Charges (IF ANY)
                                                        </th>
                                                        <th colspan="2" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Other Charges (IF ANY)
                                                        </th>

                                                        <th colspan="1" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Total EXP (Excluding GST)
                                                        </th>
                                                        <th colspan="1" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Average Cost Per SQM (Excluding GST)
                                                        </th>
                                                        <th colspan="1" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Average Cost Per FCL (Excluding GST)
                                                        </th>
                                                        <th colspan="4" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0; ">
                                                            Document Details
                                                        </th>
                                                    </tr>

                                                    <!-- Subgroup under Forwarded Charges -->
                                                    <tr>
                                                        <th colspan="1" style="background-color:#f0f0f0;"></th>

                                                        <th colspan="1" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #e0f7fa; ">
                                                            Sea
                                                        </th>
                                                        <th colspan="1" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #e8f5e9; ">
                                                            Air
                                                        </th>

                                                    </tr>
                                                    <!-- Actual Column Headers -->
                                                    <tr style="text-align: center !important; white-space: nowrap;" class="coma">
                                                        <!--invoice details-->
                                                        <th class="sticky-left-header" style="text-align: center;"><b>Sr No</b></th>
                                                        <th class="sticky-left-header" title="Division"><b>Division</b></th>
                                                        <th class="sticky-left-header" title="Mfr/Out"><b>Mfr/Out</b></th>
                                                        <th class="sticky-left-header" title="InvoiceNo"><b>InvoiceNo</b></th>
                                                        <th class="sticky-left-header" title="InvDate"><b>InvDate</b></th>
                                                        <th class="sticky-left-header" title="Bill To Name" style="border-right: 2px solid #918989 ;"><b>Bill To Name</b></th>
                                                        <th title="Ship To Name"><b>Ship To Name</b></th>
                                                        <th title="Shipping Bill No."><b>Shipping Bill No.</b></th>
                                                        <th title="Shipping Bill Date"><b>Shipping Bill Date</b></th>
                                                        <th title="EPCG Licence No."><b>EPCG Licence No.</b></th>
                                                        <th title="Currency"><b>Currency</b></th>
                                                        <th title="Basic Amt Charges"><b>Basic Amt Charges</b></th>
                                                        <th title="Sea Freight/Air Freight"><b>Sea Freight / Air Freight</b></th>
                                                        <th title="Insurnce Charged"><b>Insurnce Charged</b></th>
                                                        <th title="other Charged"><b>other Charged</b></th>
                                                        <th title="Invoice Value"><b>Invoice Value</b></th>
                                                        <th title="Quantity(SQM)"><b>Quantity(SQM)</b></th>
                                                        <th title="Air Way Bill No / Bill of Lading No"><b>Air Way Bill No /<br /> Bill of Lading  No</b></th>
                                                        <th title="Air Way Bill Date / Bill of Lading Date"><b>Air Way Bill Date /<br /> Bill of Lading  Date</b></th>
                                                        <th title="Clearing Point"><b>Clearing Point</b></th>
                                                        <th title="Port of Lading"><b>Port of Lading</b></th>
                                                        <th title="Port of discharge"><b>Port of discharge</b></th>
                                                        <th title="Mode of Dishcharge"><b>Mode</b></th>
                                                        <th title="Type"><b>Type</b></th>
                                                        <th title="No of FCL"><b>No Of FCL</b></th>
                                                        <th title="Country"><b>Country</b></th>
                                                        <th title="Inco Terms"><b>Inco Terms</b></th>
                                                        <th title="Payment terms"><b>Payment terms</b></th>
                                                        <th title="Remarks"><b>Remarks</b></th>




                                                        <!--Clearance Charges-->

                                                        <th style="border-left: 2px solid #918989;" title="Clearance Agent Name"><b>Clearance Agent</b></th>
                                                        <th style="border-right: 2px solid #918989 ;" title="Total"><b>Total</b></th>

                                                        <!--Forwared Charges-->

                                                        <th style="border-top: 2px solid #918989;" title="Forwared"><b>Forwarder Name</b></th>
                                                        <th title="Total"><b>Total</b></th>
                                                        <th style=" border-right: 2px solid #918989;" title="Total"><b>Total</b></th>

                                                        <!--Transportation Charges(Factory to ICD Khodiyar ,ICD Sanad-Factory-ICD Sanand,Mundra-Factory-Mundra,Mudra-Morbi-Mundra)-->

                                                        <th title="Transporter"><b>Transporter</b></th>
                                                        <th style=" border-right: 2px solid #918989;" title="Total"><b>Total</b></th>

                                                        <!--CFS Charges IHC (ICD Sanand-Mundra)-->

                                                        <th title="Vendor Name"><b>Vendor Name</b></th>
                                                        <th style=" border-right: 2px solid #918989;" title="Total"><b>Total</b></th>
                                                        <!--Additional Transportation Charges( ICD toport by road)-->

                                                        <th title="AdditionalTransporter"><b>AdditionalTransporter</b></th>
                                                        <th style=" border-right: 2px solid #918989;" title="Total"><b>Total</b></th>
                                                        <!--Gujarat Chamber of Commerce and Industry(COO Charges)-->

                                                        <th title="Vendor Name"><b>Vendor Name</b></th>
                                                        <th style=" border-right: 2px solid #918989;" title="Total"><b>Total</b></th>

                                                        <!--Export Inspection Agency(CEPA/ECTA/AI/SAPTA/SAFTA)-->


                                                        <th title="Vendor Name"><b>Vendor</b></th>
                                                        <th style=" border-right: 2px solid #918989;" title="Total"><b>Total</b></th>

                                                        <!--Other Charges(IF ANY)-->

                                                        <th title="Vendor"><b>Vendor</b></th>
                                                        <th style=" border-right: 2px solid #918989;" title="Total"><b>Total</b></th>

                                                        <!--Other Charges(IF ANY)-->

                                                        <th title="Vendor"><b>Vendor</b></th>
                                                        <th style=" border-right: 2px solid #918989;" title="Total"><b>Total</b></th>

                                                        <!--Other Charges(IF ANY)-->

                                                        <th title="Vendor"><b>Vendor</b></th>
                                                        <th style=" border-right: 2px solid #918989;" title="Total"><b>Total</b></th>

                                                        <th style=" border-right: 2px solid #918989;" title="Total EXP(Excluding GST)">
                                                            <b>
                                                                Total
                                                            </b>
                                                        </th>

                                                        <th style=" border-right: 2px solid #918989;" title=" Average Cost Per SQM (Excluding GST)">
                                                            <b>
                                                                SQM
                                                            </b>
                                                        </th>

                                                        <th style=" border-right: 2px solid #918989;" title=" Average Cost Per FCL(Excluding GST)">
                                                            <b>
                                                                FCL
                                                            </b>
                                                        </th>
                                                        <!--Document Details-->


                                                        <th title="Document Forwarded No"><b>Courier Airway Bill No</b></th>
                                                        <th title="Document Sent Through"><b>Document Sent Through</b></th>
                                                        <th title="Document  Courier Date"><b>Document Courier Date</b></th>
                                                        <th style=" border-right: 2px solid #918989;" title="Document Submitted Account On"><b>Document Submitted Account On </b></th>


                                                    </tr>
                                                    <tr class="comb">
                                                        <th class="sticky-left-header"><input type="text" class="column-search srno-search" data-column="0"></th>
                                                        <th class="sticky-left-header"><input type="text" class="column-search Division-search" data-column="1"></th>
                                                        <th class="sticky-left-header"><input type="text" class="column-search Mfr/Out-search" data-column="2"></th>
                                                        <th class="sticky-left-header"><input type="text" class="column-search Invoice_No-search" data-column="3"></th>
                                                        <th class="sticky-left-header"><input type="text" class="column-search Invoice_Date-search" data-column="4"></th>
                                                        <th class="sticky-left-header" style="border-right: 2px solid #918989 ;"><input type="text" class="column-search Bill_To_Name-search" data-column="5"></th>
                                                        <th><input type="text" class="column-search Ship_To_Name-search" data-column="6" style="width: 10rem !important;"></th>
                                                        <th><input type="text" class="column-search Shipping_Bill_No-search" data-column="7" style="width: 10rem !important;"></th>
                                                        <th><input type="text" class="column-search Shipping_Bill_Date-search" data-column="8" style="width: 10rem !important;"></th>
                                                        <th><input type="text" class="column-search EPCG_Licence_No-search" data-column="9" style="width: 10rem !important;"></th>
                                                        <th><input type="text" class="column-search Currency-search" data-column="10" style="width: 4rem !important;"></th>
                                                        <th><input type="text" class="column-search Basic_Amt_Charges-search" data-column="11" style="width: 10rem !important;"></th>
                                                        <th><input type="text" class="column-search Sea_Freight/Air_Freight-search" data-column="12" style="width: 14rem !important;"></th>
                                                        <th><input type="text" class="column-search Insurnce_Charged-search" data-column="13" style="width: 10rem !important;"></th>
                                                        <th><input type="text" class="column-search other_charges-search" data-column="14" style="width: 8rem !important;"></th>
                                                        <th><input type="text" class="column-search Invoice_Value-search" data-column="15" style="width: 7rem !important;"></th>
                                                        <th><input type="text" class="column-search Invoice_Value-search" data-column="16" style="width: 7rem !important;"></th>
                                                        <th><input type="text" class="column-search Air_Way_Bill_No_Bill_of_Loding_No-search" data-column="17" style="width: 10rem !important;"></th>
                                                        <th><input type="text" class="column-search Air_Way_Bill_No_Bill_of_Loding_Date-search" data-column="18" style="width: 10rem !important;"></th>
                                                        <th><input type="text" class="column-search Clearing_Point-search" data-column="19" style="width: 8rem;"></th>
                                                        <th><input type="text" class="column-search Port_of_Loading-search" data-column="20" style="width: 9rem;"></th>
                                                        <th><input type="text" class="column-search Port_of_discharge-search" data-column="21" style="width: 10rem;"></th>
                                                        <th><input type="text" class="column-search Mode_of_Dishcharge-search" data-column="22" style="width: 5rem;"></th>
                                                        <th><input type="text" class="column-search Type-search" data-column="23" style="width: 8rem"></th>

                                                        <th><input type="text" class="column-search Country-search" data-column="24" style=" width: 5rem;"></th>
                                                        <th><input type="text" class="column-search Inco_Terms-search" data-column="25" style=" width: 6rem;"></th>
                                                        <th><input type="text" class="column-search Payment_terms-search" data-column="26" style=" width: 8rem;"></th>
                                                        <th><input type="text" class="column-search Remarks-search" data-column="27" style="width: 8rem !important;"></th>
                                                        <th><input type="text" class="column-search Clearance_Agent-search" data-column="28" style="width: 11rem !important;"></th>
                                                        <th style="border-left: 3px solid #918989;"><input type="text" class="column-search Total-search" data-column="29" style="width: 10rem !important;"></th>

                                                        <th style="border-right: 2px solid #918989 ;"><input type="text" class="column-search Forwader-search" data-column="30" style="width: 6rem !important;"></th>
                                                        <th style="border-left: 2px solid #918989;"><input type="text" class="column-search seatotal-search" data-column="31" style="width: 9rem !important;"></th>

                                                        <th><input type="text" class="column-search airtotal-search" data-column="32" style="width:5rem"></th>

                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search transporter-search" data-column="33" style="width: 11rem "></th>
                                                        <th><input type="text" class="column-search transporttotal-search" data-column="34" style="width:5rem"></th>
                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search Vendor-name-search" data-column="35" style="width: 9rem"></th>
                                                        <th><input type="text" class="column-search CFSTotal-search" data-column="36" style="max-width:3rem"></th>
                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search additionaltransporter-search" data-column="37" style="width: 11rem "></th>
                                                        <th><input type="text" class="column-search addtotal-search" data-column="38" style="width:5rem"></th>
                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search coovendor-search" data-column="39" style="max-width:5rem"></th>
                                                        <th><input type="text" class="column-search coottotal-search" data-column="40" style="width:9rem"></th>
                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search eiavendorname-search" data-column="41" style="width:6rem"></th>
                                                        <th><input type="text" class="column-search eiatotal-search" data-column="42" style="width:6rem"></th>
                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search othervendor-search" data-column="43" style="width:10rem"></th>
                                                        <th><input type="text" class="column-search Othertotal-search" data-column="44" style="width:5rem"></th>
                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search othertotal-search" data-column="45" style="width:3rem"></th>

                                                        <th><input type="text" class="column-search Vendor-name-search" data-column="46" style="width:5rem"></th>
                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search Vendor-name-search" data-column="47" style="width:3rem"></th>
                                                        <th><input type="text" class="column-search srno-search" data-column="48" style="width:8rem"></th>

                                                        <th style="border-right: 2px solid #918989;"><input type="text" class="column-search srno-search" data-column="49" style="width: 6rem"></th>
                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search srno-search" data-column="50" style="width: 6rem"></th>
                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search srno-search" data-column="51" style="width: 6rem"></th>
                                                        <th style=" border-right: 2px solid #918989;"><input type="text" class="column-search srno-search" data-column="52" style="width:8rem"></th>
                                                        <th><input type="text" class="column-search srno-search" data-column="53" style="width:8rem"></th>

                                                        <th><input type="text" class="column-search Vendor-name-search" data-column="54" style="width: 16rem"></th>
                                                        <th><input type="text" class="column-search srno-search" data-column="55" style="width:8rem"></th>
                                                        <th style="border-right: 2px solid #918989;"><input type="text" class="column-search Nooffcl-search" data-column="56"></th>


                                                    </tr>

                                                </thead>

                                                <tbody class="ExportInfotbody"></tbody>
                                            </table>
                                    
                                        </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                    <div id="tabDetail" class="HeaderFont tab-pane">
                        <div class="card" style="margin-top: 1rem; margin-bottom: -4px; border: 1px solid blanchedalmond;">
                            <div class="card-body" style="margin-top: 2rem; margin-bottom: 0rem;">
                                <div class="panel panel-default" id="InvoiceDetailsPanel" style="margin-top: 22px; font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); ">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;">Invoice Details</span>
                                        <div id="loginvDiv" style="margin-right: -124rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logEmployeeName">
                                            </strong>
                                            on
                                            <strong id="logDate">
                                            </strong>
                                        </div>

                                        <i class="fa fa-minus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                        @*//<div style="padding: 10px 20px; background-color: #f9f9f9; border-bottom: 1px solid #ddd; font-size: 14px; display: flex; justify-content: space-between;">*@

                                    </div>
                                    <div class="toggle-content" style="display: block; padding: 15px;">
                                        <div class="card" style="margin-bottom: -4px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 2rem;">




                                                <div id="loadingSpinner" class="spinner" style=" margin-top: 10rem; position: absolute; top: 0; left: 50%; transform: translateX(-50%); text-align: center; padding: 20px; font-size: 16px; display: none; z-index: 1000;">
                                                    <i class="fa fa-spinner fa-spin" style="font-size: 100px; color: #24aff1;"></i>
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-12 form-group">

                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Invoice No</div>
                                                                <div class="col-md-7">
                                                                    <input type="text" id="invoiceDropdown" placeholder="select invoice" class="form-control" autocomplete="off" />
                                                                    <ul id="invoiceList" class="custom-dropdown hidden">
                                                                        @foreach (var invoice in ViewBag.InvoiceList as List<string>)
                                                                        {
                                                                            <li class="dropdown-item">@invoice</li>
                                                                        }
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">InvDate</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.InvDate, new { Class = "form-control", @id = "Date1", maxlength = "500", placeholder = "dd/mm/yy", @disabled = "disabled" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Division</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Division, new { Class = "form-control", @disabled = "disabled" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Mfr / Out</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Mfr_Out, new { Class = "form-control ", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Bill To Name</div>
                                                                <div class="col-md-7" style="margin-left: -2px;">@Html.TextBoxFor(model => model.Bill_to_Name, new { Class = "form-control", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Ship To Name</div>
                                                                <div class="col-md-7" style="margin-left: -1px;">@Html.TextBoxFor(model => model.Ship_to_Name, new { Class = "form-control", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">
                                                                    <span class="hash-label">#</span> Shipping Bill No.
                                                                </div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Shipping_Bill_No, new { Class = "form-control", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">   <span class="hash-label">#</span> Shipping Bill Date</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Shipping_Bill_Date, new { Class = "form-control", @id = "Date2", placeholder = "dd/mm/yy", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Total Weight</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Weight, new { Class = "form-control", maxlength = "500" })</div>
                                                            </div>

                                                        </div>
                                                        <div class="col-md-4">

                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Currency</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Currency, new { Class = "form-control", @disabled = "disabled" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Basic Amt Charges</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Basic_Amt_Charges, new { Class = "form-control", placeholder = "0.00", style = "text-align:right;", @disabled = "disabled" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Sea Freight / Air Freight</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Sea_Freight_Air_Freight, new { Class = "form-control", placeholder = "0.00", style = "text-align:right;", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Insurance Charged</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Insurarnce_charged, new { Class = "form-control", placeholder = "0.00", style = "text-align:right;", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Other Charges / <br />Discount</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Other_Charges, new { Class = "form-control", placeholder = "0.00", style = "text-align:right;", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Invoice Value</div>
                                                                <div class="col-md-7">
                                                                    @Html.TextBoxFor(model => model.Invoice_Value, new
                                                               {
                                                                   Class = "form-control",
                                                                   @disabled = "disabled",
                                                                   placeholder = "0.00",
                                                                   maxlength = "500",
                                                                   style = "text-align:right;"
                                                               })
                                                                </div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">   <span class="hash-label">#</span> Airway Bill No /<br />Bill of Lading No</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.AirWay_BillNo_Bill_of_LodingNo, new { Class = "form-control", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize" style="white-space:nowrap">   <span class="hash-label">#</span> Airway Bill Date /<br />Bill of Lading Date</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.AirWay_BillDate_Bill_of_LodingDate, new { @id = "AirWay_BillDate_Bill_of_LodingDate", placeholder = "dd/mm/yy", @disabled = "disabled", Class = "form-control", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Quantity(SQM)</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Quntity_SQM, new { Class = "form-control", maxlength = "500" })</div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">

                                                                <div class="col-md-5 PDtop6px FontSize">Payment Term</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Payment_Terms, new { Class = "form-control", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Mode</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Mode, new { Class = "form-control", @disabled = "disabled", @id = "Mode", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize"><span class="required-startype" style="color: red; margin-right: 6px;">*</span>Type</div>
                                                                <div class="col-md-7">
                                                                    @Html.DropDownListFor(model => model.Type, new SelectList(Model.lstFCL, "ID", "Name"), "-- Select --", new { Class = "form-control", id = "Type" })
                                                                </div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">     <span class="required-star" style="color: red; margin-right: 6px;">*</span>No of FCL</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.No_of_FCL, new { Class = "form-control", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Country</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Country, new { Class = "form-control", @disabled = "disabled", maxlength = "500" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Inco Terms</div>
                                                                <div class="col-md-7">
                                                                    @Html.DropDownListFor(model => model.Inco_Terms, new SelectList(Model.lstInco_Terms, "ID", "Name"), "-- Select --", new { Class = "form-control", @disabled = "disabled" })
                                                                </div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">EPCG Licence No.</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.EPCG_Licence_No, new { Class = "form-control", @disabled = "disabled" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Clearing Point</div>
                                                                <div class="col-md-7">
                                                                    @Html.DropDownListFor(model => model.Clearing_Point, new SelectList(Model.lstCleringPoint, "ID", "Name"), "-- Select --", new { Class = "form-control", })
                                                                </div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center ">
                                                                <div class="col-md-5 PDtop6px FontSize">   <span class="hash-label">#</span> Port of Lading</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.Port_of_Loading, new { Class = "form-control", maxlength = "500" })</div>
                                                            </div>







                                                        </div>
                                                        <div class="col-md-8  d-flex align-items-center ">
                                                            <label class="col-md-2  PDtop6px FontSize" style=" margin-left: 21px;">Remarks</label>
                                                            <div class="col-md-9">
                                                                @Html.TextBoxFor(model => model.Remarks, new { @class = "form-control", maxlength = "500", style = "width:84rem;margin-left:-20px;" })
                                                                @* If you need multiline instead:
                @Html.TextAreaFor(model => model.Remarks, new { @class = "form-control", rows = "2", maxlength = "500" }) *@
                                                            </div>
                                                        </div>

                                                        <!-- Port of Discharge -->
                                                        <div class="col-md-4  d-flex align-items-center  ">
                                                            <!-- Port of Discharge -->
                                                            <label class="col-md-4 PDtop6px FontSize" style=" margin-left: 14px;">
                                                                <span class="hash-label">#</span> Port of Discharge
                                                            </label>
                                                            <div class="col-md-6 d-flex">
                                                                @Html.TextBoxFor(model => model.Port_of_Discharge, new { @class = "form-control", @disabled = "disabled", maxlength = "500", style = "width:90%; margin-right:5px;" })


                                                            </div>
                                                        </div>

                                                        <div class="col-md-4  d-flex align-items-center mt-4 ">

                                                            <label class="col-md-4 PDtop6px FontSize" style=" margin-left: 14px;">
                                                                <span class="hash-label">#</span> Due Date
                                                            </label>
                                                            <div class="col-md-6 d-flex">
                                                                @Html.TextBoxFor(model => model.Due_Date, new { @class = "form-control", @disabled = "disabled", maxlength = "500", style = "width:90%; margin-right:5px;", placeholder = "dd/mm/yy" })


                                                            </div>
                                                        </div>

                                                    </div>


                                                </div>
                                                @*<div class="row">
                            <div class="col-md-12">


                                <div class="col-md-8">
                                    <div class="col-md-12 form-group">
                                        <div class="col-md-8">
                                            <div class="col-md-2 PDtop6px FontSize">Remarks</div>
                                            <div class="col-md-10" style=" width: 78%; ">@Html.TextBoxFor(model => model.Remarks, new { Class = "form-control", maxlength = "500" })</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-10 form-group">
                                    <div class="col-md-5 PDtop6px FontSize">   <span class="hash-label">#</span> Port of Discharge</div>
                                    <div class="col-md-7">@Html.TextBoxFor(model => model.Port_of_Discharge, new { Class = "form-control", @disabled = "disabled", maxlength = "500" })</div>
                                </div>
                                <div class="col-md-4">
                                    <a href="" id="lnkSave" class="btn" style=" width: 17%; height: 59%; font-size: 15px; background-color: #339be1; color: white; margin-left: 49rem;">
                                        <i class="fa fa-eraser" style="margin-left:0;"></i>
                                        @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                    </a>
                                </div>
                            </div>
                        </div>*@




                                                <div class="row">
                                                    <div class="col-md-12" style=" display: flex;  margin-left: 5rem; ">
                                                        <div class="col-md-9" style="display: flex; align-items: center;">
                                                            <div style="width: 16px; height: 16px; background-color: red; border-radius: 50%; margin-right: 8px;"></div>

                                                            <b style="color:red"># Marked items are Updated in ERP When Saved here.</b>
                                                        </div>

                                                        <div class="col-md-4" style="text-align:center">
                                                            <a href="" id="lnkSave" class="btn btn-primary" style="width:25%; font-size: 15px; background-color: #339be1; color: white; flex: 0 0 auto; white-space: nowrap; ">
                                                                <i class="fa fa-eraser"></i>
                                                                @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                            </a>
                                                        </div>


                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                    </div>
                                </div>


                                <div class="panel panel-default" id="ClearanceDetailsPanel" style=" font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;">Clearance Charges</span>
                                        <div id="cleardiv" style="margin-right: -121rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logccEmployeeName">
                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Model.ExporttrackerLogDetails.First().EmployeeName
                        : "")*@
                                            </strong>
                                            on
                                            <strong id="clearanceLogDate">

                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Convert.ToString(Model.ExporttrackerLogDetails.First().LogDate)
                        : "")*@
                                            </strong>
                                        </div>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>

                                    <div class="toggle-content" style="display: none; padding: 15px;">
                                        <div class="card" style="margin-bottom: -8px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 2rem; ">
                                                <div class="row">
                                                    <div class="col-md-12 form-group">
                                                        <div class="col-md-4">

                                                            <div class="col-md-10 form-group  d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize" style="margin-left: -30px;">Clearance Agent Name</div>
                                                                <div class="col-md-7">
                                                                    <input type="hidden" id="hdnFinalSave" value="false" />
                                                                    @Html.TextBoxFor(model => model.CCClearance_Agent_Name, new { @class = "form-control", name = "CCClearance_Agent_Name", id = "CCClearance_Agent_Name" })
                                                                </div>

                                                            </div>


                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group  d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize" style="margin-left: -30px;">Clearance Invoice No</div>
                                                                <div class="col-md-7">
                                                                    @Html.TextBoxFor(model => model.CCInvoice_No, new { @class = "form-control", id = "CCInvoice_No", name = "CCInvoice_No", maxlength = "500" })
                                                                </div>
                                                            </div>


                                                        </div>
                                                        <div class="col-md-4">

                                                            <div class="col-md-10 form-group  d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize" style="margin-left: -30px;">Clearance Invoice Date</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.CCInvDate, new { Class = "form-control", @id = "Date3", placeholder = "dd/mm/yy" })</div>
                                                            </div>


                                                        </div>
                                                    </div>
                                                    <div class="col-md-12 form-group">
                                                        <div class="card" style="border: 1px solid blanchedalmond;">

                                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -2rem;">
                                                                <table class="table table-bordered" id="tblClearanceCharges">
                                                                    <thead>
                                                                        <tr>
                                                                            <th style="text-align:center">SrNo.</th>
                                                                            <th style="text-align:center">Charge Name</th>
                                                                            <th style="text-align:center">Amt Before GST</th>
                                                                            <th style="text-align:center">GST %</th>
                                                                            <th style="text-align:center">GST Amount</th>
                                                                            <th style="text-align:center">Total</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td style="text-align:center">1</td>
                                                                            <td>Clearance / Agency Charges</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCClearance_agency_charges, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCClearance_Agency_chargesGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCClearance_Agency_chargesGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCClearance_Agency_charges_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">2</td>
                                                                            <td>EDI / Xeam Charges</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCEDI_Xeam_charges, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCEdi_Xeam_ChargesGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCEdi_Xeam_ChargesGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCEdi_Xeam_Charges_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">3</td>
                                                                            <td>Verified Gross Mass</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCVGM, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCVGMGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCVGMGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCVGM_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">4</td>
                                                                            <td>General Service & Equipment Charges</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCGSEC, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCGSECGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCGSECGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCGSEC_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">5</td>
                                                                            <td>Certificate of Origin</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCCOO, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCCOOGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCCOOGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCCOO_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">6</td>
                                                                            <td>Customs Examination Charges / Container Freight Station</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCExamination_CFS, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCExamination_CFSGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCExamination_CFSGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCExamination_CFS_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">7</td>
                                                                            <td>Lift ON / Lift Off</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCLift_on_Lift_off, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCLift_on_Lift_offGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCLift_on_Lift_offGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCLift_on_Lift_off_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">8</td>
                                                                            <td>CFS</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCCFS, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCCFSGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCCFSGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCCFSTotal, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">9</td>
                                                                            <td>Others</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCOthers, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCOthersGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCOthersGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCOthers_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>

                                                                        <tr>
                                                                            <td style="text-align:center"></td>
                                                                            <td>GrandTotal</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCAmt_Before_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@*@Html.TextBoxFor(m => m.FCSOther_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })*@</td>
                                                                            <td>@Html.TextBoxFor(m => m.CCGST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.CC_total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td colspan="6" style="text-align:end">
                                                                                <a href="#" id="lnkClearance" style="margin-top: 3px; width: 8%; height: 95%; font-size: 15px; background-color: #339be1; color: white; align-items:end; " class="btn">
                                                                                    <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                                                </a>
                                                                            </td>
                                                                        </tr>


                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="panel panel-default" id="forwerderDetailsPanel" style=" font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;">Forwarder Charges</span>
                                        <div id="forwerdiv" style="margin-right: -121rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logForEmployeeName">
                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Model.ExporttrackerLogDetails.First().EmployeeName
                        : "")*@
                                            </strong>
                                            on
                                            <strong id="fcLogDate">

                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Convert.ToString(Model.ExporttrackerLogDetails.First().LogDate)
                        : "")*@
                                            </strong>
                                            <strong id="fcLogDate">

                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Convert.ToString(Model.ExporttrackerLogDetails.First().LogDate)
                        : "")*@
                                            </strong>
                                        </div>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>
                                    <div class="toggle-content" style="display: none; padding: 15px;">

                                        <div class="card" style="border: 1px solid blanchedalmond;">

                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -2rem;">
                                                <div class="row">
                                                    <div class="col-md-12 form-group">
                                                        <div class="col-md-4">
                                                            <div class="col-md-12 form-group  d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Forwarder Name</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.FCForwarder, new { @class = "form-control", id = "FCForwarder", name = "FCForwarder" })</div>
                                                            </div>
                                                            <div class="col-md-12 form-group  d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Submitted To Account On</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.AdvPaymenton, new { Class = "form-control", @id = "AdvPaymenton", maxlength = "500", placeholder = "dd/mm/yy" })</div>

                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group  d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">FC Invoice No.</div>
                                                                <div class="col-md-6">@Html.TextBoxFor(model => model.FCInvoice_No, new { @class = "form-control", id = "FCInvoice_No", name = "FCInvoice_No" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group  d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Payment Date</div>
                                                                <div class="col-md-6">@Html.TextBoxFor(model => model.PaymentDate, new { Class = "form-control", @id = "PaymentDate", maxlength = "500", placeholder = "dd/mm/yy" })</div>

                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group  d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">FC InvDate</div>
                                                                <div class="col-md-6">@Html.TextBoxFor(model => model.FCInvDate, new { Class = "form-control", @id = "FCInvDate", maxlength = "500", placeholder = "dd/mm/yy" })</div>
                                                            </div>


                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="row">
                                            <div id="tabs" class="nav-tabs-custom" style="margin-top: -15px !important;">

                                                <ul class="nav nav-tabs" style="margin-top: -6px !important; font-size:15px;">
                                                    <li class="active"><a data-toggle="tab" href="#seaTab">Sea</a></li>
                                                    <li><a data-toggle="tab" href="#airTab">Air</a></li>
                                                </ul>
                                            </div>


                                            <div class="tab-content" style="padding-top: 15px;">
                                                <div id="seaTab" class="tab-pane active">
                                                    <div class="card" style="border: 1px solid blanchedalmond;">
                                                        <div class="card-header">
                                                            <h5>Sea Forwarder Details</h5>
                                                        </div>
                                                        <div class="card-body" style="margin-top: 2rem; margin-bottom: -1rem;">
                                                            <table class="table table-bordered" id="tblSeaForwerderCharges">
                                                                <thead>
                                                                    <tr>
                                                                        <th style="text-align:center">SrNo.</th>
                                                                        <th style="text-align:center">Charge Name</th>
                                                                        <th style="text-align:center">Amt Before GST</th>
                                                                        <th style="text-align:center">GST %</th>
                                                                        <th style="text-align:center">GST Amount</th>
                                                                        <th style="text-align:center">Total</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td style="text-align:center">1</td>
                                                                        <td>Freight</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSFreight, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSFreight_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSFreight_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSFreight_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">2</td>
                                                                        <td>Terminal Handling Charges</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSTHC, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSTHC_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSTHC_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSTHC_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">3</td>
                                                                        <td>Bill of Lading</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSBL, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSBL_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSBL_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSBL_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">4</td>
                                                                        <td>Security Seal</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSSeal, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSSEAL_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSSEAL_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSSEAL_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">5</td>
                                                                        <td>Verified Gross Mass</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSVGM, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSVGM_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSVGM_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSVGM_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">6</td>
                                                                        <td>Mandatory User Charge</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSMUC, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSMUC_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSMUC_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSMUC_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">7</td>
                                                                        <td>Inland Terminal Handling Charges</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSITHC, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSITHC_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSITHC_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSITHC_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">8</td>
                                                                        <td>Dry Port Charges</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSDry_Port_charges, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSDry_Port_charges_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSDry_Port_charges_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSDry_Port_charges_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">9</td>
                                                                        <td>Administrative Charges</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSAdministrative_charges, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSAdministrative_charges_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSAdministrative_charges_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSAdministrative_charges_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">10</td>
                                                                        <td>Security Filling Fees</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSSecurity_filling_fees, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSSecurity_filling_fees_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSSecurity_filling_fees_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSSecurity_filling_fees_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">11</td>
                                                                        <td>Other</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSOther, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSOther_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSOther_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSOther_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td style="text-align:center"></td>
                                                                        <td>GrandTotal</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSAmt_Before_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@*@Html.TextBoxFor(m => m.FCSOther_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })*@</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSGST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCSTotal, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="6" style="text-align:end">
                                                                            <a href="#" id="lnkUpdateFCS" style="margin-top: 3px; width: 8%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white;  " class="btn">
                                                                                <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                                            </a>
                                                                        </td>
                                                                    </tr>


                                                                </tbody>
                                                            </table>



                                                        </div>
                                                    </div>
                                                </div>

                                                <div id="airTab" class="HeaderFont tab-pane">
                                                    <div class="card" style="border: 1px solid blanchedalmond;">
                                                        <div class="card-header">
                                                            <h5>Air Forwarder Details</h5>
                                                        </div>
                                                        <div class="card-body" style="margin-top: 2rem; margin-bottom: -1rem;">
                                                            <table class="table table-bordered" id="tblAirForwerderCharges">
                                                                <thead>
                                                                    <tr>
                                                                        <th style="text-align:center">SrNo.</th>
                                                                        <th style="text-align:center">Charge Name</th>
                                                                        <th style="text-align:center">Amt Before GST</th>
                                                                        <th style="text-align:center">GST %</th>
                                                                        <th style="text-align:center">GST Amount</th>
                                                                        <th style="text-align:center">Total</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td style="text-align:center">1</td>
                                                                        <td>Air Freight</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAir_Freight, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAir_Freight_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAir_Freight_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAir_Freight_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">2</td>
                                                                        <td>Multi-Country Consolidation</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAMCC, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAMCC_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAMCC_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAMCC_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">3</td>
                                                                        <td>X-Ray</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAX_Ray, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAX_Ray_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAX_Ray_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAX_Ray_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">4</td>
                                                                        <td>Miscellaneous Yards Charges / Fuel</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAMYC_Fuel, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAMYC_Fuel_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAMYC_Fuel_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAMYC_Fuel_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">5</td>
                                                                        <td>Automated Manifest System</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAMS, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAMS_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAMS_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAMS_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>

                                                                    <tr>
                                                                        <td style="text-align:center">6</td>
                                                                        <td>Air Waybill</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAWB, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAWB_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAWB_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAWB_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">7</td>
                                                                        <td>Port Congestion Allowance</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAPCA, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAPCA_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAPCA_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAPCA_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center">8</td>
                                                                        <td>Others</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAOthers, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAOthers_GST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAOthers_GSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAOthers_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="text-align:center"></td>
                                                                        <td>GrandTotal</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAAMT_before_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@*@Html.TextBoxFor(m => m.FCSOther_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })*@</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCAGST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        <td>@Html.TextBoxFor(m => m.FCATotal, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td colspan="6" style="text-align:end">

                                                                            <a href="#" id="lnkUpdateFCA" style="margin-top: 3px; width: 8%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white;  " class="btn">
                                                                                <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                                            </a>
                                                                        </td>
                                                                    </tr>


                                                                </tbody>
                                                            </table>



                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>






                                    </div>
                                </div>


                                <div class="panel panel-default" id="TransporterDetailsPanel" style=" font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;">Transportation Charges(Factory to ICD Khodiyar ,ICD Sanad-Factory-ICD Sanand,Mundra-Factory-Mundra,Mudra-Morbi-Mundra)</span>
                                        <div id="transdiv" style="margin-right: -49rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logTraEmployeeName">

                                            </strong>
                                            on
                                            <strong id="transportLogDate">


                                            </strong>
                                        </div>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>
                                    <div class="toggle-content" style="display: none; padding: 15px;">
                                        <div class="card" style="margin-bottom: -4px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -1rem;">
                                                <div class="row">

                                                    <div class="col-md-12 form-group">
                                                        <div class="col-md-4">
                                                            <div class="col-md-12 form-group  d-flex align-items-center">
                                                                <div class="col-md-4 PDtop6px FontSize">Transporter</div>
                                                                <div class="col-md-8">@Html.TextBoxFor(model => model.TC_Transporter, new { @class = "form-control", id = "TC_Transporter", name = "TC_Transporter" })</div>
                                                            </div>

                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-12 form-group d-flex align-items-center">
                                                                <div class="col-md-4 PDtop6px FontSize">Trasporter Invoice No.</div>
                                                                <div class="col-md-8">@Html.TextBoxFor(model => model.TC_Invoice_No, new { @class = "form-control", id = "TC_Invoice_No", maxlength = "500", name = "TC_Invoice_No" })</div>
                                                            </div>


                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-12 form-group d-flex align-items-center">
                                                                <div class="col-md-4 PDtop6px FontSize">Trasporter InvDate</div>
                                                                <div class="col-md-8">@Html.TextBoxFor(model => model.TC_InvDate, new { Class = "form-control", @id = "TC_InvDate", placeholder = "dd/mm/yy" })</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12 form-group">
                                                        <div class="card" style="border: 1px solid blanchedalmond;">

                                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -2rem;">
                                                                <table class="table table-bordered" id="tblTCCharges">
                                                                    <thead>
                                                                        <tr>
                                                                            <th style="text-align:center">SrNo.</th>
                                                                            <th style="text-align:center">Charge Name</th>
                                                                            <th style="text-align:center">Amt Before GST</th>
                                                                            <th style="text-align:center">GST %</th>
                                                                            <th style="text-align:center">GST Amount</th>
                                                                            <th style="text-align:center">Total</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td style="text-align:center">1</td>
                                                                            <td>Charges</td>
                                                                            <td>@Html.TextBoxFor(m => m.TC_Charges, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.TCChargesGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.TCChargesGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.TCCharges_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">2</td>
                                                                            <td>Verified Gross Mass</td>
                                                                            <td>@Html.TextBoxFor(m => m.TC_VGM, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.TCVGMGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.TCVGMGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.TCVGM_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">3</td>
                                                                            <td>Other</td>
                                                                            <td>@Html.TextBoxFor(m => m.TC_Other, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.TCOtherGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.TCOtherGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.TCOther_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center"></td>
                                                                            <td>GrandTotal</td>
                                                                            <td>@Html.TextBoxFor(m => m.TC_AMT_Before_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@*@Html.TextBoxFor(m => m.FCSOther_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })*@</td>
                                                                            <td>@Html.TextBoxFor(m => m.TC_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.TC_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td colspan="6" style="text-align:end">

                                                                                <a href="#" id="lnkUpdateTC" style="margin-top: 3px; width: 8%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white;  " class="btn">
                                                                                    <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                                                </a>
                                                                            </td>
                                                                        </tr>


                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div id="cfsChargesPanel" class="panel panel-default" style=" font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;">CFS Charges IHC (ICD To Port)</span>
                                        <div id="CFSvDiv" style="margin-right: -114rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logCFSEmployeeName">

                                            </strong>
                                            on
                                            <strong id="cfsLogDate">

                                            </strong>
                                        </div>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>
                                    <div class="toggle-content" style="display: none; padding: 15px;">
                                        <div class="card" style="margin-bottom: -6px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -2rem; ">
                                                <div class="row">
                                                    <div class="col-md-12 form-group">
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">CFS Vendor Name</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.CFS_Vendor, new { @class = "form-control", id = "CFS_Vendor", name = "CFS_Vendor" })</div>
                                                            </div>


                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">CFS Invoice No.</div>
                                                                <div class="col-md-6">@Html.TextBoxFor(model => model.CFS_Invoice_No, new { @class = "form-control", id = "CFS_Invoice_No", name = "CFS_Invoice_No" })</div>
                                                            </div>

                                                            @* <div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">CFS Particulars</div>
                                        <div class="col-md-6">@Html.TextBoxFor(model => model.CFS_Particulars, new { @class = "form-control", autocomplete = "on" })</div>
                                    </div>
                                                            *@

                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">CFS InvDate </div>
                                                                <div class="col-md-6">@Html.TextBoxFor(model => model.CFS_InvDate, new { Class = "form-control", @id = "CFS_InvDate", placeholder = "dd/mm/yy" })</div>
                                                            </div>
                                                            @*
                                    <div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize"></div>
                                        <div class="col-md-6"></div>
                                    </div>
                                    <div class="col-md-10 form-group" style="margin-top: 30px;">
                                        <a href="#" id="lnkUpdateCFS" style="margin-top: 3px; width: 19%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white; /* text-align: end; */ margin-left: 50rem; " class="btn">
                                            <i class="fa fa-eraser"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                        </a>
                                    </div>*@
                                                        </div>
                                                        <table class="table table-bordered" id="CfschargesTable" style=" font-size: 18px; ">
                                                            <thead>
                                                                <tr>
                                                                    <th style="text-align:center">SrNo .</th>
                                                                    <th style="text-align:center">Charge Name</th>
                                                                    <th style="text-align:center">Amt Before GST</th>

                                                                    <th style="text-align:center">GST %</th>
                                                                    <th style="text-align:center">GST Amount</th>
                                                                    <th style="text-align:center">Total</th>

                                                                    <th style="display:none">Cfs_RowId</th>
                                                                    <th>
                                                                        <button type="button" class="btn btn-danger rounded-circle" style="width: 40px; height: 40px; font-size: 20px; padding: 0;" onclick="addRow()">
                                                                            <i class="fa fa-plus" style="margin-left:0;"></i>
                                                                        </button>
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            @{
                                                                var fixedServices = new List<string> {
                                                                "Other/Private Yard LoLo Charges",
                                                                "Terminal Handling Charges",
                                                                "Rail Freight Charges",
                                                                "Others Support Ser.Infrastructure & Devel.Charges"
                                                            };
                                                            }
                                                            <tbody>



                                                                @if (Model?.CFSOtherCharges != null && Model.CFSOtherCharges.Count > 0)
                                                                {
                                                                    for (int i = 0; i < Model.CFSOtherCharges.Count; i++)
                                                                    {
                                                                        <tr style="font-size: 15px;">
                                                                            <td class="sr-no"></td>
                                                                            <td>@Html.TextBoxFor(model => model.CFSOtherCharges[i].Nature_of_Service, fixedServices[i], new { @class = "form-control cfs-nature_of_service", autocomplete = "on", name = "OC_Vendor", id = "OC_Vendor" })</td>
                                                                            <td>@Html.TextBoxFor(model => model.CFSOtherCharges[i].AmtBeforeGST, new { @class = "form-control cfs_amtbeforegst input-right", autocomplete = "on", placeholder = "0.00" })</td>

                                                                            <td>@Html.TextBoxFor(model => model.CFSOtherCharges[i].GstPercentage, new { Class = "form-control cfs_gstpercentage input-right", placeholder = "0" })</td>
                                                                            <td>@Html.TextBoxFor(model => model.CFSOtherCharges[i].GstAmount, new { @class = "form-control cfs_gstAmount input-right", placeholder = "0.00", @readonly = "readonly" })</td>
                                                                            <td>
                                                                                @Html.TextBoxFor(model => model.CFSOtherCharges[i].Total, new
                                                                           {
                                                                               Class = "form-control cfs_total input-right",
                                                                               placeholder = "0.00",
                                                                               @readonly = "readonly"

                                                                           })
                                                                            </td>

                                                                            <td style="display:none">@Html.TextBoxFor(model => model.CFSOtherCharges[i].Cfs_RowId, new { @class = "form-control cfs_rowid", @readonly = "readonly" })</td>

                                                                            <td>

                                                                                <button type="button" class="btn btn-danger" onclick="removeRow2(this)">
                                                                                    <i class="fa fa-minus" style="margin-left:0;"></i>
                                                                                </button>
                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    for (int i = 0; i < fixedServices.Count; i++)
                                                                    {
                                                                        <tr style="font-size: 15px;">
                                                                            <td class="sr-no"></td>
                                                                            <td>
                                                                                <input type="text" class="form-control cfs-nature_of_service"
                                                                                       value="@fixedServices[i]" />
                                                                            </td>
                                                                            <td><input type="text" class="form-control cfs_amtbeforegst" placeholder="0.00" style="text-align:right;" /></td>
                                                                            <td><input type="text" class="form-control cfs_gstpercentage" placeholder="0" style="text-align:right;" /></td>
                                                                            <td><input type="text" class="form-control cfs_gstAmount" placeholder="0.00" style="text-align:right;" readonly="readonly" /></td>
                                                                            <td><input type="text" class="form-control cfs_total" placeholder="0.00" style="text-align:right;" readonly="readonly" /></td>
                                                                            <td style="display:none"><input type="text" class="form-control cfs_rowid" style="text-align:right;" readonly="readonly" /></td>
                                                                            <td>
                                                                                <button type="button" class="btn btn-danger" onclick="removeRow2(this)">
                                                                                    <i class="fa fa-minus" style="margin-left:0;"></i>
                                                                                </button>
                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                }
                                                                <tr>
                                                                    <!-- CFS Amt. Before GST -->
                                                                    <td></td>
                                                                    <td colspan="1">Grand Total</td>
                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.CFS_Amt_Before_GST, new
                                                                        {
                                                                            @class = "form-control",
                                                                            maxlength = "500",
                                                                            @readonly = "readonly",
                                                                            style = "text-align:right;",  // Smaller input
                                                                            placeholder = "0.00"
                                                                        })
                                                                    </td>

                                                                    <!-- CFS GST -->

                                                                    <td></td>
                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.CFS_GST, new
                                                                        {
                                                                            @class = "form-control",
                                                                            @readonly = "readonly",
                                                                            maxlength = "500",
                                                                            style = "text-align:right; ",  // Reduced width here
                                                                            placeholder = "0.00"
                                                                        })
                                                                    </td>

                                                                    <!-- CFS Total -->

                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.CFS_Total, new
                                                                        {
                                                                            @class = "form-control",
                                                                            @readonly = "readonly",
                                                                            style = "text-align:right;",
                                                                            placeholder = "0.00"
                                                                        })
                                                                    </td>

                                                                    <!-- Save Button -->
                                                                    <td></td>
                                                                </tr>
                                                                <tr>
                                                                    <td colspan="6" style="text-align:end">
                                                                        <a href="#" id="lnkUpdateCfsOC" class="btn"
                                                                           style="font-size: 15px; background-color: #339be1; color: white; width: 7%;">
                                                                            <i class="fa fa-eraser"></i>
                                                                            @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                                        </a>
                                                                    </td>
                                                                    <td></td>
                                                                </tr>


                                                            </tbody>







                                                        </table>
                                                        @*<div class="col-md-12 form-group">
                                <div class="col-md-4">
                                    <div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">CFS Amt. Before GST</div>
                                        <div class="col-md-6">@Html.TextBoxFor(model => model.CFS_Amt_Before_GST, new { Class = "form-control", maxlength = "500", @readonly = "readonly", style = "text-align:right;", placeholder = "0.00" })</div>
                                    </div>

                                </div>
                                <div class="col-md-4">
                                    <div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">CFS GST (18%)</div>
                                        <div class="col-md-6">@Html.TextBoxFor(model => model.CFS_GST, new { Class = "form-control", @disabled = "disabled", style = "text-align:right;", maxlength = "500", placeholder = "0.00" })</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">CFS Total</div>
                                        <div class="col-md-6">@Html.TextBoxFor(model => model.CFS_Total, new { Class = "form-control", @disabled = "disabled", style = "text-align:right;", placeholder = "0.00" })</div>
                                    </div>
                                </div>
                                </div>
                                <div class="col-md-12 form-group" style="text-align:end; margin-top: -8px;">
                                    <a href="#" id="lnkUpdateCfsOC" style=" margin-top: 3px; width: 9%; height: 96%; font-size: 15px; background-color: #339be1; align-items: end; color: white; /* text-align: end; */ margin-left: 6rem; " class="btn">
                                        <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                    </a>
                                </div>*@

                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <div class="panel panel-default" id="addtransporter" style=" font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;"> Additional Transportation Charges(ICD To Port By Road)</span>
                                        <div id="AddTransportdiv" style="margin-right: -97rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logaddtraEmployeeName">
                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Model.ExporttrackerLogDetails.First().EmployeeName
                        : "")*@
                                            </strong>
                                            on
                                            <strong id="addTransportLogDate">

                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Convert.ToString(Model.ExporttrackerLogDetails.First().LogDate)
                        : "")*@
                                            </strong>
                                        </div>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>
                                    <div class="toggle-content" style="display: none; padding: 15px;">
                                        <div class="card" style="margin-bottom: -4px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -1rem;">
                                                <div class="row">

                                                    <div class="col-md-12 form-group">
                                                        <div class="col-md-4">
                                                            <div class="col-md-12 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">AddTransporter</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.AddTC_Transporter, new { @class = "form-control", id = "AddTC_Transporter", name = "AddTC_Transporter" })</div>
                                                            </div>
                                                            <div class="col-md-12 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Submitted To Account On</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.AddTCAdvPaymentOn, new { Class = "form-control", @id = "AddTCAdvPaymentOn", placeholder = "dd/mm/yy" })</div>
                                                            </div>

                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-12 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">AddTrasporter Invoice No.</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.AddTC_Invoice_No, new { @class = "form-control", id = "AddTC_Invoice_No", maxlength = "500", name = "AddTC_Invoice_No" })</div>
                                                            </div>
                                                            <div class="col-md-12 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Payment Date</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.AddTCPaymentDate, new { Class = "form-control", @id = "AddTCPaymentDate", placeholder = "dd/mm/yy" })</div>
                                                            </div>

                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">AddTrasporter InvDate</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.AddTC_InvDate, new { Class = "form-control", @id = "AddTC_InvDate", placeholder = "dd/mm/yy" })</div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                    <div class="col-md-12 form-group">
                                                        <div class="card" style="border: 1px solid blanchedalmond;">

                                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -2rem;">
                                                                <table class="table table-bordered" id="tblAddTCCharges">
                                                                    <thead>
                                                                        <tr>
                                                                            <th style="text-align:center">SrNo.</th>
                                                                            <th style="text-align:center">Charge Name</th>
                                                                            <th style="text-align:center">Amt Before GST</th>
                                                                            <th style="text-align:center">GST %</th>
                                                                            <th style="text-align:center">GST Amount</th>
                                                                            <th style="text-align:center">Total</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td style="text-align:center">1</td>
                                                                            <td>AddCharges</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTC_Charges, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTCChargesGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTCChargesGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTCCharges_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">2</td>
                                                                            <td> Additional Verified Gross Mass</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTC_VGM, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTCVGMGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTCVGMGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTCVGM_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center">3</td>
                                                                            <td>AddOther</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTC_Other, new { @class = "form-control text-right", placeholder = "0.00" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTCOtherGST, new { @class = "form-control text-right", placeholder = "0.00", })</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTCOtherGSTAmount, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTCOther_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td style="text-align:center"></td>
                                                                            <td>GrandTotal</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTC_AMT_Before_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@*@Html.TextBoxFor(m => m.FCSOther_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })*@</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTC_GST, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                            <td>@Html.TextBoxFor(m => m.AddTC_Total, new { @class = "form-control text-right", placeholder = "0.00", @disabled = "disabled" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td colspan="6" style="text-align:end">

                                                                                <a href="#" id="lnkUpdateAddTC" style="margin-top: 3px; width: 8%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white;" class="btn">
                                                                                    <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                                                </a>

                                                                            </td>
                                                                        </tr>


                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="panel panel-default" id="COODetailsPanel" style=" font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;">Gujarat Chamber of Commerce and Industry(COO Charges)</span>
                                        <div id="COO" style="margin-right: -94rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logcooEmployeeName">
                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Model.ExporttrackerLogDetails.First().EmployeeName
                        : "")*@
                                            </strong>
                                            on
                                            <strong id="cooLogDate">

                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Convert.ToString(Model.ExporttrackerLogDetails.First().LogDate)
                        : "")*@
                                            </strong>
                                        </div>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>
                                    <div class="toggle-content" style="display: none; padding: 15px;">
                                        <div class="card" style="margin-bottom: -8px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -2rem;">
                                                <div class="row">
                                                    <div class="col-md-12 form-group">
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">COO Vendor</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.COO_Vendor, new { @class = "form-control", id = "COO_Vendor", name = "COO_Vendor" })</div>
                                                            </div>
                                                            @*<div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">COO Particulars</div>
                                        <div class="col-md-7">@Html.TextBoxFor(model => model.COO_Particulars, new { @class = "form-control", autocomplete = "on" })</div>
                                    </div>
                                    <div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">COO GST Amount</div>
                                        <div class="col-md-7">@Html.TextBoxFor(model => model.COO_GST, new { Class = "form-control", @disabled = "disabled", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</div>
                                    </div>*@

                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-6 PDtop6px FontSize">COO Invoice No.</div>
                                                                <div class="col-md-6">@Html.TextBoxFor(model => model.COO_Invoice_No, new { @class = "form-control", id = "COO_Invoice_No", name = "COO_Invoice_No" })</div>
                                                            </div>


                                                            @*<div class="col-md-10 form-group">
                                        <div class="col-md-6 PDtop6px FontSize">COO Amount Before GST</div>
                                        <div class="col-md-6">@Html.TextBoxFor(model => model.COO_Amt_Before_GST, new { Class = "form-control", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</div>
                                    </div>

                                    <div class="col-md-10 form-group">
                                        <div class="col-md-6 PDtop6px FontSize">Total</div>
                                        <div class="col-md-6">@Html.TextBoxFor(model => model.COO_Total, new { Class = "form-control", @disabled = "disabled", placeholder = "0.00", style = "text-align:right;" })</div>
                                    </div>*@

                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">COO InvDate </div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.COO_InvDate, new { Class = "form-control", @id = "COO_InvDate", placeholder = "dd/mm/yy" })</div>
                                                            </div>
                                                            @*<div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">COO GST % </div>
                                        <div class="col-md-7">@Html.TextBoxFor(model => model.COOGSTPercentage, new { Class = "form-control", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</div>
                                    </div>
                                    <div class="col-md-12 form-group " style=" text-align: end;">
                                        <a href="#" id="lnkUpdateCOO" style=" width: 19%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white;  " class="btn">
                                            <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                        </a>
                                    </div>*@
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12 form-group">
                                                        <div class="card" style="border: 1px solid blanchedalmond;">

                                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -2rem;">
                                                                <table class="table table-bordered" id="tblCOOCharges">
                                                                    <thead>
                                                                        <tr>
                                                                            <th style="text-align:center">SrNo.</th>

                                                                            <th style="text-align:center">Particulars</th>
                                                                            <th style="text-align:center">Amt Before GST</th>
                                                                            <th style="text-align:center">GST %</th>
                                                                            <th style="text-align:center">GST Amount</th>
                                                                            <th style="text-align:center">Total</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td style="text-align:center">1</td>
                                                                            <td>@Html.TextBoxFor(model => model.COO_Particulars, new { @class = "form-control", autocomplete = "on" })</td>
                                                                            <td>@Html.TextBoxFor(model => model.COO_Amt_Before_GST, new { Class = "form-control", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</td>
                                                                            <td>@Html.TextBoxFor(model => model.COOGSTPercentage, new { Class = "form-control", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</td>
                                                                            <td>@Html.TextBoxFor(model => model.COO_GST, new { Class = "form-control", @disabled = "disabled", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</td>
                                                                            <td>@Html.TextBoxFor(model => model.COO_Total, new { Class = "form-control", @disabled = "disabled", placeholder = "0.00", style = "text-align:right;" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td colspan="6" style="text-align:end">

                                                                                <a href="#" id="lnkUpdateCOO" style="margin-top: 3px; width: 8%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white;  " class="btn">
                                                                                    <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                                                </a>
                                                                            </td>
                                                                        </tr>


                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="panel panel-default" id="EIADetailsPanel" style=" font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;">Export Inspection Agency(CEPA/ECTA/AI/SAPTA/SAFTA)</span>
                                        <div id="EIADIV" style="margin-right: -97rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logeiaEmployeeName">
                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Model.ExporttrackerLogDetails.First().EmployeeName
                        : "")*@
                                            </strong>
                                            on
                                            <strong id="eiaLogDate">

                                                @*@(Model.ExporttrackerLogDetails != null && Model.ExporttrackerLogDetails.Any()
                        ? Convert.ToString(Model.ExporttrackerLogDetails.First().LogDate)
                        : "")*@
                                            </strong>
                                        </div>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>
                                    <div class="toggle-content" style="display: none; padding: 15px;">
                                        <div class="card" style="margin-bottom: -8px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -2rem;">
                                                <div class="row">
                                                    <div class="col-md-12 form-group">
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">EIA Vendor</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.EIA_Vendor, new { @class = "form-control", id = "EIA_Vendor", name = "EIA_Vendor" })</div>
                                                            </div>
                                                            @*<div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">EIA Particulars</div>
                                        <div class="col-md-7">@Html.TextBoxFor(model => model.EIA_Particulars, new { @class = "form-control", id = "EIA_Particulars", name = "EIA_Particulars" })</div>
                                    </div>
                                    <div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">EIA GST (18%)</div>
                                        <div class="col-md-7">@Html.TextBoxFor(model => model.EIA_GST, new { Class = "form-control", @disabled = "disabled", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</div>
                                    </div>*@
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">EIA Invoice No.</div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.EIA_Invoice_No, new { @class = "form-control", id = "EIA_Invoice_No", name = "EIA_Invoice_No" })</div>
                                                            </div>


                                                            @*<div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">EIA Amt. Before GST</div>
                                        <div class="col-md-7">@Html.TextBoxFor(model => model.EIA_Amt_Before_GST, new { Class = "form-control", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</div>
                                    </div>

                                    <div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">Export Agency Total</div>
                                        <div class="col-md-7">@Html.TextBoxFor(model => model.EIA_Total, new { Class = "form-control", @disabled = "disabled", placeholder = "0.00", style = "text-align:right;" })</div>
                                    </div>*@
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">EIA InvDate </div>
                                                                <div class="col-md-7">@Html.TextBoxFor(model => model.EIA_InvDate, new { Class = "form-control", @id = "EIA_InvDate", placeholder = "dd/mm/yy" })</div>
                                                            </div>

                                                            @*<div class="col-md-10 form-group">
                                        <div class="col-md-5 PDtop6px FontSize">Export Agency GST %</div>
                                        <div class="col-md-7">@Html.TextBoxFor(model => model.EIAGSTPercentage, new { Class = "form-control", placeholder = "0.00", style = "text-align:right;" })</div>
                                    </div>

                                    <div class="col-md-12 form-group" style="text-align: end;">
                                        <a href="#" id="lnkUpdateEIA" style=" width: 19%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white; " class="btn">
                                            <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                        </a>
                                    </div>*@
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12 form-group">
                                                        <div class="card" style="border: 1px solid blanchedalmond;">

                                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -2rem;">
                                                                <table class="table table-bordered" id="tblEIACharges">
                                                                    <thead>
                                                                        <tr>
                                                                            <th style="text-align:center">SrNo.</th>

                                                                            <th style="text-align:center">Particulars</th>
                                                                            <th style="text-align:center">Amt Before GST</th>
                                                                            <th style="text-align:center">GST %</th>
                                                                            <th style="text-align:center">GST Amount</th>
                                                                            <th style="text-align:center">Total</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td style="text-align:center">1</td>
                                                                            <td>@Html.TextBoxFor(model => model.EIA_Particulars, new { @class = "form-control", autocomplete = "on" })</td>
                                                                            <td>@Html.TextBoxFor(model => model.EIA_Amt_Before_GST, new { Class = "form-control", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</td>
                                                                            <td>@Html.TextBoxFor(model => model.EIAGSTPercentage, new { Class = "form-control", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</td>
                                                                            <td>@Html.TextBoxFor(model => model.EIA_GST, new { Class = "form-control", @disabled = "disabled", maxlength = "500", placeholder = "0.00", style = "text-align:right;" })</td>
                                                                            <td>@Html.TextBoxFor(model => model.EIA_Total, new { Class = "form-control", @disabled = "disabled", placeholder = "0.00", style = "text-align:right;" })</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td colspan="6" style="text-align:end">

                                                                                <a href="#" id="lnkUpdateEIA" style=" width: 8%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white; " class="btn">
                                                                                    <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                                                </a>
                                                                            </td>
                                                                        </tr>


                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="panel panel-default" id="OtherDetailsPanel" style=" font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;">Other Charges(IF ANY)</span>
                                        <div id="logDiv" style="margin-right: -120rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logotherEmployeeName">

                                            </strong>
                                            on
                                            <strong id="otherChargesLogDate">

                                            </strong>
                                        </div>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>
                                    <div class="toggle-content" style="display: none; padding: 15px;">
                                        <div class="card" style="margin-bottom: -6px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 1rem; margin-bottom: -11px; ">
                                                <div class="row">
                                                    <div class="col-md-12 form-group">
                                                        @if (Model?.OtherCharges != null && Model.OtherCharges.Count > 0)
                                                        {
                                                            for (int i = 0; i < Model.OtherCharges.Count; i++)
                                                            {
                                                                <div class="col-md-4">

                                                                    <div class="col-md-12 form-group  d-flex align-items-center">
                                                                        <div class="col-md-5 PDtop6px FontSize">Submitted To Account On</div>
                                                                        <div class="col-md-7">@Html.TextBoxFor(model => model.OtherCharges[i].OCAdvPaymenton, new { Class = "form-control oc-advpaymenton", maxlength = "500", placeholder = "dd/mm/yy" })</div>

                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">

                                                                    <div class="col-md-10 form-group  d-flex align-items-center">
                                                                        <div class="col-md-5 PDtop6px FontSize">Payment Date</div>
                                                                        <div class="col-md-6">@Html.TextBoxFor(model => model.OtherCharges[i].OCPaymentDate, new { Class = "form-control oc-paymentdate", maxlength = "500", placeholder = "dd/mm/yy" })</div>

                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">



                                                                </div>
                                                            }
                                                        }
                                                    </div>
                                                </div>
                                                <table class="table table-bordered" id="chargesTable" style=" font-size: 18px; ">
                                                    <thead>
                                                        <tr style="font-size: 15px;">
                                                            <th>SrNo .</th>
                                                            <th>Vendor</th>
                                                            <th>Invoice No.</th>

                                                            <th>Date</th>
                                                            <th>Particulars</th>
                                                            <th>Amt. Before GST</th>
                                                            <th>GST Percentage</th>
                                                            <th>GST Amount</th>
                                                            <th>Total</th>
                                                            <th style="display:none">RowId</th>
                                                            <th>
                                                                <button type="button" class="btn btn-danger rounded-circle" style="width: 40px; height: 40px; font-size: 20px; padding: 0;" onclick="addRow()">
                                                                    <i class="fa fa-plus" style="margin-left:0;"></i>
                                                                </button>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>



                                                        @if (Model?.OtherCharges != null && Model.OtherCharges.Count > 0)
                                                        {
                                                            for (int i = 0; i < Model.OtherCharges.Count; i++)
                                                            {
                                                                <tr style="font-size: 15px;">
                                                                    <td class="sr-no"></td>
                                                                    <td>@Html.TextBoxFor(model => model.OtherCharges[i].OC_Vendor, new { @class = "form-control oc-vendor", autocomplete = "on", name = "OC_Vendor", id = "OC_Vendor" })</td>
                                                                    <td>@Html.TextBoxFor(model => model.OtherCharges[i].OC_Invoice_No, new { @class = "form-control oc-invoice-no", autocomplete = "on" })</td>

                                                                    <td>@Html.TextBoxFor(model => model.OtherCharges[i].OC_InvDate, new { Class = "form-control oc-invdate", placeholder = "dd/mm/yy" })</td>
                                                                    <td>@Html.TextBoxFor(model => model.OtherCharges[i].OC_Particulars, new { @class = "form-control oc-particulars", autocomplete = "on" })</td>
                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.OtherCharges[i].OC_Amt_Before_GST, new
                                                                   {
                                                                       Class = "form-control oc-amt-before-gst input-right",
                                                                       placeholder = "0.00"
                                                                   })
                                                                    </td>
                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.OtherCharges[i].OC_GSTPercentage, new
                                                                   {
                                                                       Class = "form-control  oc-gstPercentage input-right",

                                                                       placeholder = "0.00"
                                                                   })
                                                                    </td>
                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.OtherCharges[i].OC_GSTAmount, new
                                                                   {
                                                                       Class = "form-control  oc-gstAmount input-right",
                                                                       @readonly = "readonly",
                                                                       placeholder = "0.00"
                                                                   })
                                                                    </td>
                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.OtherCharges[i].OC_Total, new
                                                                   {
                                                                       Class = "form-control oc-total input-right",
                                                                       @readonly = "readonly",
                                                                       placeholder = "0.00"
                                                                   })
                                                                    </td>
                                                                    <td style="display:none">@Html.TextBoxFor(model => model.OtherCharges[i].OC_RowId, new { @class = "form-control oc-rowid", @readonly = "readonly" })</td>

                                                                    <td>

                                                                        <button type="button" class="btn btn-danger" onclick="removeRow(this)">
                                                                            <i class="fa fa-minus" style="margin-left:0;"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            }
                                                        }

                                                    </tbody>
                                                </table>
                                                <div class="col-md-12 form-group" style="margin-top: -8px; text-align:end">
                                                    <a href="#" id="lnkUpdateOC" style=" margin-top: 3px; width: 6%; height: 96%; font-size: 15px; background-color: #339be1; align-items: end; color: white; /* text-align: end; */ margin-left: 6rem; " class="btn">
                                                        <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                    </a>
                                                </div>

                                            </div>
                                        </div>


                                    </div>
                                </div>
                                <div class="panel panel-default" id="DocumentDetailsPanel" style=" font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;">Document Details</span>
                                        <div id="DocumentDiv" style="margin-right: -124rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logdocEmployeeName">
                                               
                                            </strong>
                                            on
                                            <strong id="documentLogDate">

                                              
                                            </strong>
                                        </div>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>
                                    <div class="toggle-content" style="display: none; padding: 15px;">
                                        <div class="card" style="margin-bottom: -8px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 2rem; margin-bottom: -2rem;">
                                                <div class="row">
                                                    <div class="col-md-12 form-group">
                                                        <div class="col-md-6">
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Courier Airway Bill No</div>
                                                                <div class="col-md-6">@Html.TextBoxFor(model => model.Doc_ForwardedNo, new { @class = "form-control", id = "Doc_ForwardedNo", name = "Doc_ForwardedNo" })</div>
                                                            </div>

                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Document Sent Through</div>
                                                                <div class="col-md-6">@Html.TextBoxFor(model => model.Doc_Sent_Through, new { @class = "form-control", id = "Doc_Sent_Through" })</div>
                                                            </div>

                                                        </div>
                                                        <div class="col-md-6">

                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Document Courier Date </div>
                                                                <div class="col-md-6">@Html.TextBoxFor(model => model.Doc_Date, new { Class = "form-control", @id = "Doc_Date", placeholder = "dd/mm/yy" })</div>
                                                            </div>
                                                            <div class="col-md-10 form-group d-flex align-items-center">
                                                                <div class="col-md-5 PDtop6px FontSize">Document Submitted Account On</div>
                                                                <div class="col-md-6">@Html.TextBoxFor(model => model.Doc_Submitted_Account_On, new { Class = "form-control", @id = "Doc_Submitted_Account_On", placeholder = "dd/mm/yy" })</div>
                                                            </div>
                                                            <div class="col-md-12 form-group " style="text-align:end">
                                                                <a href="#" id="lnkUpdateDocDetails" style="margin-top: 3px; width: 13%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white; /* text-align: end; */ margin-left: 50rem; " class="btn">
                                                                    <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                                </a>
                                                            </div>


                                                        </div>

                                                    </div>
                                                    <!--<div class="col-md-12 form-group text-end">
                        <a href="#" id="lnkUpdateDocDetails" style="margin-top: 3px; width: 5%; height: 95%; font-size: 15px; background-color: #339be1; align-items: end; color: white; /* text-align: end; */ margin-left: 50rem; " class="btn">
                            <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                        </a>-->
                                                    @*<div class="col-md-10 form-group" style="margin-top: 37px;">

                            </div>*@
                                                    <!--</div>-->
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="col-md-12 form-group" style="margin-top: -8px; text-align: start;">
                                    <div class="col-md-6">
                                        <div class="col-md-10">
                                            <div class="col-md-5">
                                                <a href="#" id="lnkUpdateFinalSave" style=" display: flex; justify-content: center; margin-top: 3px; width: 100%; height: 96%; font-size: 15px; background-color: #339be1; align-items: center; color: white; text-decoration: none; cursor: pointer; border-radius: 5px; " class="btn">
                                                    <i class="fa fa-eraser" style="margin-right: 5px;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Close & Update On ERP")
                                                </a>
                                            </div>
                                            <div class="col-md-6">
                                                <a href="#" id="lnkEnableFinalSave" style=" margin-top: 3px; width: 57%; height: 96%; font-size: 15px; background-color: #339be1; align-items: end; color: white;  " class="btn">
                                                    <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblReActive", "common", "Re - Active")
                                                </a>
                                            </div>
                                        </div>


                                    </div>
                                    <div class="col-md-9" id="FinalsavePanel" style="background: linear-gradient(to right, rgb(17, 69, 31), rgb(50, 120, 69)); margin-left: 54rem; margin-top: -31px; width: 132rem; font-size: 18px; border: 1px solid #ccc; padding: 8px 20px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; ">
                                        <div id="FinalsaveDiv" style="font-weight: 600; font-size: 14px; color: #e9dede; text-align: end; margin-right: 45px; align-items: center; ">
                                         Last Updated By :
                                            <strong id="logFinalsaveEmployeeName"> </strong>
                                            on
                                            <strong id="FianlsaveLogDate">  </strong>
                                        </div>
                                    </div>


                                </div>

                                <div class="panel panel-default"  id="OtherBLDetailsPanel" style=" font-size: 18px; border: 1px solid #ccc; border-radius: 8px; margin-top: 65px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;">BL Surrender Charges</span>
                                        <div id="logOtherBLdiv" style="margin-right: -120rem; font-weight: 600; font-size: 14px; color: #e9dede; ">
                                            Last Updated By:
                                            <strong id="logotherBLEmployeeName">

                                            </strong>
                                            on
                                            <strong id="otherBLChargesLogDate">

                                            </strong>
                                        </div>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>
                                    <div class="toggle-content" style="display: none; padding: 15px;">
                                        <div class="card" style="margin-bottom: -6px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 1rem; margin-bottom: -11px; ">
                                                <div class="row">
                                                    <div class="col-md-12 form-group">
                                                        @if (Model?.OtherCharges != null && Model.OtherCharges.Count > 0)
                                                        {
                                                            for (int i = 0; i < Model.OtherCharges.Count; i++)
                                                            {
                                                                <div class="col-md-4">

                                                                    <div class="col-md-12 form-group  d-flex align-items-center">
                                                                        <div class="col-md-5 PDtop6px FontSize">Submitted To Account On</div>
                                                                        <div class="col-md-7">@Html.TextBoxFor(model => model.OtherCharges[i].OC_BLAdvPaymenton, new { Class = "form-control oc-bladvpaymenton", maxlength = "500", placeholder = "dd/mm/yy" })</div>

                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">

                                                                    <div class="col-md-10 form-group  d-flex align-items-center">
                                                                        <div class="col-md-5 PDtop6px FontSize">Payment Date</div>
                                                                        <div class="col-md-6">@Html.TextBoxFor(model => model.OtherCharges[i].OC_BLPaymentDate, new { Class = "form-control oc-blpaymentdate", maxlength = "500", placeholder = "dd/mm/yy" })</div>

                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">



                                                                </div>
                                                            }
                                                        }
                                                    </div>
                                                </div>
                                                <table class="table table-bordered" id="BLchargesTable" style=" font-size: 18px; ">
                                                    <thead>
                                                        <tr style="font-size: 15px;">
                                                            <th>SrNo .</th>
                                                            <th>Vendor</th>
                                                            <th>Invoice No.</th>

                                                            <th>Date</th>
                                                            <th>Particulars</th>
                                                            <th>Amt. Before GST</th>
                                                            <th>GST Percentage</th>
                                                            <th>GST Amount</th>
                                                            <th>Total</th>
                                                            <th style="display:none">RowId</th>
                                                           @* <th>
                                                                <button type="button" class="btn btn-danger rounded-circle" style="width: 40px; height: 40px; font-size: 20px; padding: 0;" onclick="addRow2()">
                                                                    <i class="fa fa-plus" style="margin-left:0;"></i>
                                                                </button>
                                                            </th>*@
                                                        </tr>
                                                    </thead>
                                                    <tbody>



                                                        @if (Model?.OtherCharges != null && Model.OtherCharges.Count > 0)
                                                        {
                                                            for (int i = 0; i < Model.OtherCharges.Count; i++)
                                                            {
                                                                <tr style="font-size: 15px;">
                                                                    <td class="sr-no"></td>
                                                                    <td>@Html.TextBoxFor(model => model.OtherCharges[i].OC_Vendor, new { @class = "form-control oc-BLvendor", autocomplete = "on", name = "OC_Vendor", id = "OC_Vendor" })</td>
                                                                    <td>@Html.TextBoxFor(model => model.OtherCharges[i].OC_Invoice_No, new { @class = "form-control oc-BLLinvoice-no", autocomplete = "on" })</td>

                                                                    <td>@Html.TextBoxFor(model => model.OtherCharges[i].OC_InvDate, new { Class = "form-control oc-BLinvdate", placeholder = "dd/mm/yy" })</td>
                                                                    <td>@Html.TextBoxFor(model => model.OtherCharges[i].OC_Particulars, new { @class = "form-control oc-BLparticulars", autocomplete = "on" })</td>
                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.OtherCharges[i].OC_Amt_Before_GST, new
                                                                   {
                                                                       Class = "form-control oc-BLamt-before-gst input-right",
                                                                       placeholder = "0.00"
                                                                   })
                                                                    </td>
                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.OtherCharges[i].OC_GSTPercentage, new
                                                                   {
                                                                       Class = "form-control  oc-BLgstPercentage input-right",

                                                                       placeholder = "0.00"
                                                                   })
                                                                    </td>
                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.OtherCharges[i].OC_GSTAmount, new
                                                                   {
                                                                       Class = "form-control  oc-BLgstAmount input-right",
                                                                       @readonly = "readonly",
                                                                       placeholder = "0.00"
                                                                   })
                                                                    </td>
                                                                    <td>
                                                                        @Html.TextBoxFor(model => model.OtherCharges[i].OC_Total, new
                                                                   {
                                                                       Class = "form-control oc-BLtotal input-right",
                                                                       @readonly = "readonly",
                                                                       placeholder = "0.00"
                                                                   })
                                                                    </td>
                                                                    <td style="display:none">@Html.TextBoxFor(model => model.OtherCharges[i].OC_RowId, new { @class = "form-control oc-BLrowid", @readonly = "readonly" })</td>

                                                                    @*<td>

                                                                        <button type="button" class="btn btn-danger" onclick="removeRow3(this)">
                                                                            <i class="fa fa-minus" style="margin-left:0;"></i>
                                                                        </button>
                                                                    </td>*@
                                                                </tr>
                                                            }
                                                        }

                                                    </tbody>
                                                </table>
                                                <div class="col-md-12 form-group" style="margin-top: -8px; text-align:end">
                                                    <a href="#" id="lnkUpdateBLOC" style=" margin-top: 3px; width: 6%; height: 96%; font-size: 15px; background-color: #339be1; align-items: end; color: white; /* text-align: end; */ margin-left: 6rem; " class="btn">
                                                        <i class="fa fa-eraser" style="margin-left:0;"></i> @resourceSettings.getResourceLable("lblSave", "common", "Save")
                                                    </a>
                                                </div>

                                            </div>
                                        </div>


                                    </div>
                                </div>
                                <div class="panel panel-default" style="margin-top:2rem; font-size: 18px; border: 1px solid #ccc; border-radius: 8px; padding: 0; box-shadow: 2px 2px 5px rgba(0,0,0,0.1);">
                                    <div class="panel-heading" style="background: linear-gradient(to right, #032962, #24aff1); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); transition: background 0.3s ease; " onclick="toggleDetails(this)">
                                        <span style="font-weight: 600; font-size: 14px; color: #e9dede;"> Charges are applied according to the invoice details</span>
                                        <i class="fa fa-plus toggle-icon" style="font-size: 18px; color: white; transition: transform 0.3s ease;"></i>
                                    </div>
                                    <div class="toggle-content" style="display: none; padding: 15px;">
                                        <div class="card" style="margin-bottom: -6px; border: 1px solid blanchedalmond;">
                                            <div class="card-body" style="margin-top: 1rem; margin-bottom: -11px; ">
                                                <table class="table table-bordered" id="chargesSummaryTable" style=" font-size: 18px; ">

                                                    <tbody id="chargesSummaryBody">
                                                    <thead>
                                                        <tr style="font-size: 15px;">
                                                            <th style="width:6%;">SrNo .</th>
                                                            <th>Charges Name </th>

                                                            <th style="width:10%;">Amt. Before GST</th>
                                                            <th style="width:10%;">GST Amount</th>
                                                            <th style="width:10%;">Total Including GST</th>

                                                        </tr>
                                                    </thead>
                                                    <tr>
                                                        <td>1</td>
                                                        <td>Clearance Charges</td>
                                                        <td id="amount"><span id="td_CCAmt_Before_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_CCGST">0.00</span></td>
                                                        <td id="amount"><span id="td_CC_total">0.00</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>2</td>
                                                        <td>Sea Forwarder Charges</td>
                                                        <td id="amount"><span id="td_FCSAmt_Before_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_FCSGST">0.00</span></td>
                                                        <td id="amount"><span id="td_FCSTotal">0.00</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>3</td>
                                                        <td>Air Forwarder Charges</td>
                                                        <td id="amount"><span id="td_FCAAMT_before_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_FCAGST">0.00</span></td>
                                                        <td id="amount"><span id="td_FCATotal">0.00</span></td>
                                                    </tr>

                                                    <tr>
                                                        <td>4</td>
                                                        <td>Transportation Charges</td>
                                                        <td id="amount"><span id="td_TC_AMT_Before_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_TC_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_TC_Total">0.00</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>5</td>
                                                        <td>CFS Charges</td>
                                                        <td id="amount"><span id="td_CFS_Amt_Before_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_CFS_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_CFS_Total">0.00</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>6</td>
                                                        <td> Additional Transportation Charges</td>
                                                        <td id="amount"><span id="td_AddTC_AMT_Before_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_AddTC_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_AddTC_Total">0.00</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>7</td>
                                                        <td>COO Charges</td>
                                                        <td id="amount"><span id="td_COO_Amt_Before_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_COO_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_COO_Total">0.00</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>8</td>
                                                        <td>Export Inspection Agency Charges</td>
                                                        <td id="amount"><span id="td_EIA_Amt_Before_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_EIA_GST">0.00</span></td>
                                                        <td id="amount"><span id="td_EIA_Total">0.00</span></td>
                                                    </tr>
                                                    @*<tr id="oc-row-placeholder" class="oc-summary-row" style="display:none">
                                <td class="td-sr">9</td>
                                <td class="td-charge-name">Other Charges</td>
                                <td id="amount"><span class="td-amt">0.00</span></td>
                                <td id="amount"><span class="td-gst">0.00</span></td>
                                <td id="amount"><span class="td-total">0.00</span></td>
                            </tr>*@
                                                    <tr id="tr_total">
                                                        <td style="color: rgb(230, 240, 255); background-color: rgb(1, 41, 112) !important;">10</td>
                                                        <td style="color: rgb(230, 240, 255); background-color: rgb(1, 41, 112) !important;">Total</td>
                                                        <td id="amount" style="color: rgb(230, 240, 255); background-color: rgb(1, 41, 112) !important;">
                                                            <span id="td_amt_before_gst">0.00</span>
                                                        </td>
                                                        <td id="amount" style="color: rgb(230, 240, 255); background-color: rgb(1, 41, 112) !important;">
                                                            <span id="td_GST">0.00</span>
                                                        </td>
                                                        <td id="amount" style="color: rgb(230, 240, 255); background-color: rgb(1, 41, 112) !important;">
                                                            <span id="td_Total">0.00</span>
                                                        </td>
                                                    </tr>
                                                    <tr id="tr_FCL">
                                                        <td>10</td>
                                                        <td>Avg Cost Per FCL</td>

                                                        <td id="amount">
                                                            <span id="td_avgfclamt_before_gst">0.00</span>
                                                        </td>
                                                        <td id="amount">
                                                            <span id="td_avgfcl_gst">0.00</span>
                                                        </td>
                                                        <td id="amount">
                                                            <span id="td_avgfcl_total">0.00</span>
                                                        </td>
                                                    </tr>
                                                    <tr id="tr_sqm">
                                                        <td>10</td>
                                                        <td>Avg Cost Per SQM</td>
                                                        <td id="amount">
                                                            <span id="td_avgsqmamt_before_gst">0.00</span>
                                                        </td>
                                                        <td id="amount">
                                                            <span id="td_avgsqm_gst">0.00</span>
                                                        </td>
                                                        <td id="amount">
                                                            <span id="td_avgsqm">0.00</span>
                                                        </td>
                                                    </tr>
                                                    @*<tr id="tr_total">
                                <td>8</td>
                                <td>Total</td>
                                <td id="amount"><span id="td_amt_before_gst">0.00</span></td>
                                <td id="amount"><span id="td_GST">0.00</span></td>
                                <td id="amount"><span id="td_Total">0.00</span></td>
                            </tr>*@
                                                    </tbody>

                                                </table>


                                            </div>
                                        </div>


                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>
}


<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
@*<link href="~/Content/Css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="~/Content/plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="~/Content/simple-datatables/style.css" rel="stylesheet" />
    <script src="~/Content/simple-datatables/simple-datatables.js"></script>*@
@*<script src="~/Content/plugins/datatables/jquery.dataTables.min.js"></script>*@

@*<link href="~/Content/Css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="~/Content/plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/lib/datatables/css/jquery.dataTables.min.css" />
    <script src="~/lib/datatables/js/jquery.dataTables.min.js"></script>
    <link href="~/Content/simple-datatables/style.css" rel="stylesheet" />
    <script src="~/Content/simple-datatables/simple-datatables.js"></script>*@
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="~/Scripts/bootstrap.bundle.min.js"></script>
<script src="~/assets/bootstrap-select/bootstrap-select.min.js"></script>
<link href="~/Content/Css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="~/Content/plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" />

<link href="~/assets/bootstrap-select/bootstrap-select.min.css" rel="stylesheet" />

<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
<link href="~/Content/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="~/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
<link href="~/Content/boxicons/css/boxicons.min.css" rel="stylesheet" />
<link href="~/Content/quill/quill.snow.css" rel="stylesheet" />
<link href="~/Content/quill/quill.bubble.css" rel="stylesheet" />
<link href="~/Content/remixicon/remixicon.css" rel="stylesheet" />
<link href="~/Content/simple-datatables/style.css" rel="stylesheet" />
<script src="~/Content/echarts/echarts.min.js"></script>
<script src="~/Content/quill/quill.js"></script>
<script src="~/Content/simple-datatables/simple-datatables.js"></script>
<script src="~/Content/tinymce/tinymce.min.js"></script>
<script src="~/Content/php-email-form/validate.js"></script>

<script src="~/Scripts/main.js"></script>
<link href="~/Scripts/style.css" rel="stylesheet" />
<link href="~/Styles/style.css" rel="stylesheet" />

<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="~/Scripts/jquery-3.7.1.min.js"></script>
<script src="~/Scripts/jquery.min.js"></script>
<link href="~/Content/themes/base/minified/jquery.ui.tabs.min.css" rel="stylesheet" />
<link href="~/Content/themes/redmond/minified/jquery.ui.tabs.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery-2.1.4.min.js"></script>
<script src="~/Scripts/jquery.datetimepicker.js"></script>
<script src="~/Content/SiteCss/js/jquery.datetimepicker.js"></script>
<link href="~/Content/SiteCss/css/jquery.datetimepicker.css" rel="stylesheet" />
<script src="~/Scripts/jquery-1.7.1.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
@*<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>*@
<link href="~/Content/Css/TSCommon.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap.bundle.js"></script>

<script src="~/WebFormScripts/ExtOperation.js"></script>
<link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" />
<link href="~/Content/themes/redmond/minified/jquery-ui.css" rel="stylesheet" />
<script src="~/Scripts/jquery-1.12.4.min.js"></script>

<link href="~/Scripts/bootstrap.min.css" rel="stylesheet" />
<link href="~/Styles/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/assets/css/style.css" rel="stylesheet" />
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Styles/bootstrap.css" rel="stylesheet" />
<link href="~/Styles/bootstrap.min.css" rel="stylesheet" />
<link href="~/Scripts/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/bootstrap/css/bootstrap.min.css" rel="stylesheet" />


<link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" />
<link href="~/Content/themes/redmond/minified/jquery-ui.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery-ui.js"></script>
<script src="~/Content/plugins/datatables/jquery.dataTables.min.js"></script>

<script src="~/Scripts/ext-all.js"></script>
<link href="~/Styles/ext-all.css" rel="stylesheet" />
<link href="~/Content/Css/ext.css" rel="stylesheet" />



<script type="text/javascript">
    var total = '';

    document.addEventListener('DOMContentLoaded', function () {
        const dropdown = document.getElementById('Clearing_Point');


        let selectedValue = dropdown.value;


        let selectedText = dropdown.options[dropdown.selectedIndex].text;

        const panel = document.getElementById('cfsChargesPanel');
        if (!panel || !dropdown) return;

        const textboxes = panel.querySelectorAll('input, textarea, select');
        const isReadOnly = panel.getAttribute('data-readonly') === 'True' || panel.getAttribute('data-readonly') === 'true';


        ['CFS_GST', 'CFS_Total'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.setAttribute('data-always-disabled', 'true');
        });
        function generateTableHeader() {
            const tableHeader = document.querySelector('#TblExportTrackerInfo thead');

            tableHeader.innerHTML = '';

              const firstRow = document.createElement('tr');
                firstRow.innerHTML = `
            <th colspan="2" rowspan="2" style="border-right: 2px solid #918989; border-top: 2px solid #918989; border-left: 2px solid #918989; border-bottom: 2px solid #918989; text-align: center; font-weight: bold; background-color: #f0f0f0;">
                Other Charges (IF ANY)
            </th>
        `;
                tableHeader.appendChild(firstRow);


                const secondRow = document.createElement('tr');
                secondRow.innerHTML = `
            <th title="Vendor"><b>Vendor</b></th>
            <th style="border-right: 2px solid #918989;" title="Total"><b>Total</b></th>
        `;
                tableHeader.appendChild(secondRow);


                const thirdRow = document.createElement('tr');
                thirdRow.innerHTML = `
            <th><input type="text" class="column-search srno-search" data-column="45" style="width:8rem"></th>
            <th style="border-right: 2px solid #918989;"><input type="text" class="column-search srno-search" data-column="46" style="width: 6rem"></th>
        `;
                tableHeader.appendChild(thirdRow);

        }


        function togglePanelBasedOnValue(value,text) {
            const isICD = text.toUpperCase().includes("ICD");

            if (isReadOnly) {
                panel.style.display = 'block'; // Always show in detail view
                return;
            }

            if (text.toUpperCase() === "MUNDRA") {
                panel.style.display = 'none';
                textboxes.forEach(el => el.disabled = true);
            } else {
                panel.style.display = 'block';
                textboxes.forEach(el => {
                    if (!el.hasAttribute('data-always-disabled')) {
                        el.disabled = false;
                    }
                });
            }
        }


        dropdown.addEventListener('change', function () {
            togglePanelBasedOnValue(this.value, this.options[this.selectedIndex].text);
        });


        togglePanelBasedOnValue(dropdown.value, dropdown.options[dropdown.selectedIndex].text);
    });

    document.getElementById("lnkUpdateFinalSave").addEventListener("click", function (e) {
        e.preventDefault();


        document.querySelectorAll(".panel").forEach(panel => {
            const content = panel.querySelector(".toggle-content");
            const icon = panel.querySelector(".toggle-icon");

            if (content) content.style.display = "none";

            if (icon) {
                icon.classList.remove("fa-minus");
                icon.classList.add("fa-plus");
                icon.style.transform = "rotate(0deg)";
            }
  panel.querySelectorAll("input, select, textarea, button").forEach(field => {
                field.disabled = true;
            });

        });
        const docPanel = document.querySelector(".panel .panel-heading span:contains('Document Details')")?.closest(".panel");
        const panels = document.querySelectorAll(".panel");
        panels.forEach(panel => {
            const heading = panel.querySelector(".panel-heading span");
          //  if (heading && heading.textContent.trim() === "Document Details" || heading && heading.textContent.trim() === "BL SUrrender Charges" ) {
            if (
                heading &&
                (
                    heading.textContent.trim() === "Document Details" ||
                    heading.textContent.trim() === "BL Surrender Charges"
                )
            ) {
            panel.querySelectorAll("input, select, textarea, button").forEach(field => {
                    field.disabled = false;
                });
                const icon = panel.querySelector(".toggle-icon");
                if (icon) {
                    icon.classList.remove("fa-minus");
                    icon.classList.add("fa-plus");
                    icon.style.transform = "rotate(0deg)";
                }
            }
        });
    });

  $(document).ready(function () {
      $(".form-control").on("keyup", function () {

        var $this = $(this);
        var columnName = $this.attr("id");
        var term = $this.val();
        var url = '@Url.Action("GetColumnWiseSuggestions", "ExportTracker")';

        $.ajax({
            url: url,
            type: 'GET',
            data: { column_Name: columnName, term_value: term },
            success: function (result) {
                var suggestions = result.values || [];


                $(".suggestion-box").remove();

                if (suggestions.length > 0) {
                    var $dropdown = $("<ul class='suggestion-box'></ul>").css({
                        position: "absolute",
                        border: "1px solid #ccc",
                        background: "#fff",
                        zIndex: 9999,
                        listStyleType: "none",
                        padding: "5px",
                        margin: 0,
                        width: $this.outerWidth()
                    });
                    if (suggestions.length === 0) {
                        alert("No suggestions returned for term: " + term);
                    }
                    suggestions.forEach(function (suggestion) {
                        $("<li></li>")
                            .text(suggestion)
                            .css({ padding: "5px", cursor: "pointer" })
                            .on("click", function () {
                                $this.val(suggestion);
                                $(".suggestion-box").remove();
                            })
                            .appendTo($dropdown);
                    });

                    $("body").append($dropdown);
                    $dropdown.position({
                        my: "left top",
                        at: "left bottom",
                        of: $this
                    });
                    $dropdown.css({
                        top: $this.offset().top + $this.outerHeight(),
                        left: $this.offset().left
                    });
                }
            },
            error: function () {
                console.error("Failed to fetch suggestions for " + columnName);
            }
        });
    });

    $(document).on("click", function (e) {
        if (!$(e.target).closest(".form-control, .suggestion-box").length) {
            $(".suggestion-box").remove();
        }
    });
  });
    function isValidInvoice(value) {
        return value !== null && value !== undefined && value !== "";
    }
    $(document).ready(function () {
        $('.oc-invdate,.oc-BLinvdate').datepicker({
            dateFormat: 'dd/mm/yy'
        });


        const $input = $("#invoiceDropdown");
        const $dropdown = $("#invoiceList");

        function showFilteredList(value) {
            const filter = value.toLowerCase();
            let hasMatch = false;

            $dropdown.find("li").each(function () {
                const text = $(this).text().toLowerCase();
                const match = filter === "" || text.includes(filter);
                $(this).toggle(match);
                if (match) hasMatch = true;
            });

            $dropdown.toggleClass("hidden", !hasMatch);
        }


        $input.on("click", function () {
            const invoiceValue = $(this).val();
            showFilteredList(invoiceValue);

        });


        $input.on("input", function () {
            const invoiceValue = $(this).val();
            showFilteredList(invoiceValue);

        });


        $dropdown.on("click", "li", function () {
            const selectedInvoice = $(this).text();
            $input.val(selectedInvoice);
            $dropdown.addClass("hidden");
            loadInvoiceDetails(selectedInvoice);
        });


        $(document).on("click", function (e) {
            if (!$(e.target).closest("#invoiceDropdown, #invoiceList").length) {
                $dropdown.addClass("hidden");
            }
        });
    });

          $(document).ready(function () {


              getgriddetails();

              var selectedInvoice = document.getElementById("invoiceDropdown").value;
              if (selectedInvoice !== "") {

                  loadInvoiceDetails(selectedInvoice);
              }
              const sectionDivMap = {
                  "OtherCharges": "#logDiv",
                  "EIA": "#EIADIV",
                  "Invoice": "#loginvDiv",
                  "Clearance": "#cleardiv",
                  "FCS": "#forwerdiv",
                  "FCA": "#forwerdiv",
                  "Transport": "#transdiv",
                  "CFS": "#CFSvDiv",
                  "AddTransport": "#AddTransportdiv",
                  "COO": "#COO",
                  "Document": "#DocumentDiv",
                  "OtherBL": "#logOtherBLdiv",
                  "Finalsave": "#FinalsaveDiv"
              };
              $("#FinalsavePanel").hide();
              Object.values(sectionDivMap).forEach(divId => $(divId).hide());
                $('#lnkExportToExcel').click(function (e) {
      e.preventDefault();

                    //$('#loadingMessage1').show();
                    var selectedSearchType = $('#searchType').val();

      var urlRequest = '@Url.Action("ExportReport", "ExportTracker")';

$.ajax({
          url: urlRequest,
    type: 'POST',

          contentType: 'application/json',
    data: JSON.stringify({ SearchType: selectedSearchType }),
    xhrFields: {
        responseType: 'blob' // 🔹 This is key
    },
    success: function (blob, status, xhr) {
        // Get filename from response headers
        var disposition = xhr.getResponseHeader('Content-Disposition');
        var filename = "ExportTrackerReport.xlsx";
        if (disposition && disposition.indexOf('filename=') !== -1) {
            var matches = disposition.match(/filename="?([^"]+)"?/);
            if (matches != null && matches[1]) filename = matches[1];
        }

        // Create a temporary download link
        var link = document.createElement('a');
        link.href = window.URL.createObjectURL(blob);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    },

    @*success: function (result) {


        if (result.success) {


                  var downloadUrl = '@Url.Action("Download", "ExportTracker", new { filetype = "Excel", file = "__filename__" })'.replace('__filename__', result.filename);
  window.open(downloadUrl);
                 // window.location.href = '/ExportTracker/DownloadExporttrackerReport?fileName=' + encodeURIComponent(result.fileName);


              } else {
                  alert("Error: " + result.message);
              }


            },*@
          error: function (xhr, status, error) {
              alert("Error: " + error + "\nStatus: " + status + "\nResponse: " + xhr.responseText);
              console.log("Error: " + error + "\nStatus: " + status + "\nResponse: " + xhr.responseText);
          }
      });


     });
            $('#lnkUpdateFinalSave').click(function (e) {
                e.preventDefault();

    calculateGSTAndTotal();
    var invoice_no = $('#invoiceDropdown').val();
    var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';
                var charges = [];
                var cfsCharges = [];
                let advPaymentOn = formatDateToShortDMY($('.oc-advpaymenton').val());
                let paymentDate = formatDateToShortDMY($('.oc-paymentdate').val());
                let BLadvPaymentOn = formatDateToShortDMY($('.oc-bladvpaymenton').val());
                let BLpaymentDate = formatDateToShortDMY($('.oc-blpaymentdate').val());
                $('#chargesTable tbody tr').each(function () {
                    var vendor = $(this).find('.oc-vendor').val()?.trim();
                    var invoiceNo = $(this).find('.oc-invoice-no').val()?.trim();
                    var invDate = formatDateToShortDMY($(this).find('.oc-invdate').val());

                    var particulars = $(this).find('.oc-particulars').val()?.trim();
                    var amtBeforeGst = $(this).find('.oc-amt-before-gst').val().replace(/,/g, '')?.trim() || "0";
                    var gstPercentage = $(this).find('.oc-gstPercentage').val()?.trim() || "0";
                    var gst = $(this).find('.oc-gstAmount').val()?.trim() || "0";
                    var total = $(this).find('.oc-total').val()?.trim() || "0";
                    var rowId = $(this).find('.oc-rowid').val()?.trim() || "0";
                    var hasValue = (vendor && vendor !== "") ||
                        (invoiceNo && invoiceNo !== "") ||
                        (invDate && invDate !== "") ||
                        (particulars && particulars !== "") ||
                        (amtBeforeGst && parseFloat(amtBeforeGst) > 0) ||
                        (gst && parseFloat(gst) > 0) ||
                        (total && parseFloat(total) > 0);
                      if (hasValue) {
                            charges.push({
                                OC_Vendor: vendor || "",
                                OC_Invoice_No: invoiceNo || "",
                                OCAdvPaymenton: advPaymentOn,
                                OCPaymentDate: paymentDate,
                                OC_InvDate: invDate || "",
                                OC_Particulars: particulars || "",

                                OC_BLAdvPaymenton: formatDateToShortDMY(BLadvPaymentOn),

                                OC_BLPaymentDate: formatDateToShortDMY(BLpaymentDate),
                                OC_Amt_Before_GST: amtBeforeGst || "0",
                                OC_GSTPercentage: gstPercentage || "0",
                                OC_GSTAmount: gst || "0",
                                OC_Total: total || "0",
                                OC_RowId: rowId
                            });
                        }
                   // }
                });
                $('#CfschargesTable tbody tr').each(function () {
                    var natureOfService = $(this).find('.cfs-nature_of_service').val()?.trim();
                    var amtBeforeGst = $(this).find('.cfs_amtbeforegst').val()?.trim() || "0";
                    var gstPercentage = $(this).find('.cfs_gstpercentage').val()?.trim() || "0";
                    var gstAmount = $(this).find('.cfs_gstAmount').val()?.trim() || "0";
                    var total = $(this).find('.cfs_total').val()?.trim() || "0";
                    var rowId = $(this).find('.cfs_rowid').val()?.trim() || "0";

                     cfsCharges.push({
                            Nature_of_Service: natureOfService || "",
                            AmtBeforeGST: amtBeforeGst,
                            GstPercentage: gstPercentage,
                            GstAmount: gstAmount,
                            Total: total,
                            Cfs_RowId: rowId
                        });
                   // }
                });
    $.ajax({
        type: "POST",
        url: urlRequest1,
        data: { invNo: invoice_no },
        success: function (response) {
            if (response.exists) {

                var typeText = $('#Type option:selected').text();
                var noOfFCL = $('#No_of_FCL').val().trim();

                if (typeText === "-- Select --") {
                    alert("Please select at least one Type");
                    return false;
                }


                if (typeText === "FCL") {
                    if (noOfFCL === "" || noOfFCL === null) {
                        alert("Please enter the value for No of FCL");
                        return false;
                    }
                }

                //add charges panel data set 05/02/26
                updateChargesPabelLoadData()

                var model = {
                    "Invoice_No": invoice_no,
                    "InvDate": $('#Date1').val(),
                    "Division": $('#Division').val(),
                    "Mfr_Out": $('#Mfr_Out').val(),
                    "Bill_to_Name": $('#Bill_to_Name').val(),
                    "Ship_to_Name": $('#Ship_to_Name').val(),
                    "Shipping_Bill_No": $('#Shipping_Bill_No').val(),
                    "Shipping_Bill_Date": $('#Date2').val(),
                    "EPCG_Licence_No": $('#EPCG_Licence_No').val(),
                    "Currency": $('#Currency').val(),
                    "Basic_Amt_Charges": $('#Basic_Amt_Charges').val(),
                    "Sea_Freight_Air_Freight": $('#Sea_Freight_Air_Freight').val(),
                    "Insurarnce_charged": $('#Insurarnce_charged').val(),
                    "Other_Charges": $('#Other_Charges').val(),
                    "Invoice_Value": $('#Invoice_Value').val(),
                    "AirWay_BillNo_Bill_of_LodingNo": $('#AirWay_BillNo_Bill_of_LodingNo').val(),
                    "AirWay_BillDate_Bill_of_LodingDate": $('#AirWay_BillDate_Bill_of_LodingDate').val(),
                    "Mode": $('#Mode').val(),
                    "Country": $('#Country').val(),
                    "Port_of_Discharge": $('#Port_of_Discharge').val(),
                    "Port_of_Loading": $('#Port_of_Loading').val(),
                    "Payment_Terms": $('#Payment_Terms').val(),
                    "Clearing_Point": $('#Clearing_Point option:selected').text(),
                    "Inco_Terms": $('#Inco_Terms option:selected').text(),
                    "Remarks": $('#Remarks').val(),
                    "CCClearance_Agent_Name": $('#CCClearance_Agent_Name').val(),
                    "CCInvoice_No": $('#CCInvoice_No').val(),
                    "CCInvDate": $('#Date3').val(),

                    "CCClearance_agency_charges": $('#CCClearance_agency_charges').val(),
                    "CCClearance_Agency_chargesGST": $('#CCClearance_Agency_chargesGST').val(),
                    "CCClearance_Agency_chargesGSTAmount": $('#CCClearance_Agency_chargesGSTAmount').val(),
                    "CCClearance_Agency_charges_Total": $('#CCClearance_Agency_charges_Total').val(),

                    "CCEDI_Xeam_charges": $('#CCEDI_Xeam_charges').val(),
                    "CCEdi_Xeam_ChargesGST": $('#CCEdi_Xeam_ChargesGST').val(),
                    "CCEdi_Xeam_ChargesGSTAmount": $('#CCEdi_Xeam_ChargesGSTAmount').val(),
                    "CCEdi_Xeam_Charges_Total": $('#CCEdi_Xeam_Charges_Total').val(),

                    "CCVGM": $('#CCVGM').val(),
                    "CCVGMGST": $('#CCVGMGST').val(),
                    "CCVGMGSTAmount": $('#CCVGMGSTAmount').val(),
                    "CCVGM_Total": $('#CCVGM_Total').val(),

                    "CCGSEC": $('#CCGSEC').val(),
                    "CCGSECGST": $('#CCGSECGST').val(),
                    "CCGSECGSTAmount": $('#CCGSECGSTAmount').val(),
                    "CCGSEC_Total": $('#CCGSEC_Total').val(),

                    "CCCOO": $('#CCCOO').val(),
                    "CCCOOGST": $('#CCCOOGST').val(),
                    "CCCOOGSTAmount": $('#CCCOOGSTAmount').val(),
                    "CCCOO_Total": $('#CCCOO_Total').val(),

                    "CCExamination_CFS": $('#CCExamination_CFS').val(),
                    "CCExamination_CFSGST": $('#CCExamination_CFSGST').val(),
                    "CCExamination_CFSGSTAmount": $('#CCExamination_CFSGSTAmount').val(),
                    "CCExamination_CFS_Total": $('#CCExamination_CFS_Total').val(),

                    "CCLift_on_Lift_off": $('#CCLift_on_Lift_off').val(),
                    "CCLift_on_Lift_offGST": $('#CCLift_on_Lift_offGST').val(),
                    "CCLift_on_Lift_offGSTAmount": $('#CCLift_on_Lift_offGSTAmount').val(),
                    "CCLift_on_Lift_off_Total": $('#CCLift_on_Lift_off_Total').val(),

                    "CCCFS": $('#CCCFS').val(),
                    "CCCFSGST": $('#CCCFSGST').val(),
                    "CCCFSGSTAmount": $('#CCCFSGSTAmount').val(),
                    "CCCFSTotal": $('#CCCFSTotal').val(),

                    "CCOthers": $('#CCOthers').val(),
                    "CCOthersGST": $('#CCOthersGST').val(),
                    "CCOthersGSTAmount": $('#CCOthersGSTAmount').val(),
                    "CCOthers_Total": $('#CCOthers_Total').val(),

                    "Insurarnce_charged": $('#Insurarnce_charged').val(),
                    "CCAmt_Before_GST": $('#CCAmt_Before_GST').val(),
                    "CCGST": $('#CCGST').val(),
                    "CC_total": $('#CC_total').val(),
                    "CFS_Vendor": $('#CFS_Vendor').val(),
                    "CFS_Invoice_No": $('#CFS_Invoice_No').val(),
                    "CFS_InvDate": $('#CFS_InvDate').val(),
                    "CFS_Particulars": $('#CFS_Particulars').val(),
                    "CFS_Amt_Before_GST": $('#CFS_Amt_Before_GST').val(),
                    "CFS_GST": $('#CFS_GST').val(),
                    "CFS_Total": $('#CFS_Total').val(),
                    "TC_Transporter": $('#TC_Transporter').val(),
                    "TC_Invoice_No": $('#TC_Invoice_No').val(),
                    "TC_InvDate": $('#TC_InvDate').val(),
                    "TC_Charges": $('#TC_Charges').val(),
                    "TCChargesGST": $('#TCChargesGST').val(),
                    "TCChargesGSTAmount": $('#TCChargesGSTAmount').val(),
                    "TCCharges_Total": $('#TCCharges_Total').val(),

                    "TC_VGM": $('#TC_VGM').val(),
                    "TCVGMGST": $('#TCVGMGST').val(),
                    "TCVGMGSTAmount": $('#TCVGMGSTAmount').val(),
                    "TCVGM_Total": $('#TCVGM_Total').val(),

                    "TC_Other": $('#TC_Other').val(),
                    "TCOtherGST": $('#TCOtherGST').val(),
                    "TCOtherGSTAmount": $('#TCOtherGSTAmount').val(),
                    "TCOther_Total": $('#TCOther_Total').val(),

                    "TC_AMT_Before_GST": $('#TC_AMT_Before_GST').val(),
                    "TC_GST": $('#TC_GST').val(),
                    "TC_Total": $('#TC_Total').val(),
                    "AddTC_Transporter": $('#AddTC_Transporter').val(),
                    "AddTC_Invoice_No": $('#AddTC_Invoice_No').val(),
                    "AddTC_InvDate": $('#AddTC_InvDate').val(),
                    "AddTCAdvPaymentOn": $('#AddTCAdvPaymentOn').val(),
                    "AddTCPaymentDate": $('#AddTCPaymentDate').val(),
                    "AddTC_Charges": $('#AddTC_Charges').val(),
                    "AddTCChargesGST": $('#AddTCChargesGST').val(),
                    "AddTCChargesGSTAmount": $('#AddTCChargesGSTAmount').val(),
                    "AddTCCharges_Total": $('#AddTCCharges_Total').val(),

                    "AddTC_VGM": $('#AddTC_VGM').val(),
                    "AddTCVGMGST": $('#AddTCVGMGST').val(),
                    "AddTCVGMGSTAmount": $('#AddTCVGMGSTAmount').val(),
                    "AddTCVGM_Total": $('#AddTCVGM_Total').val(),

                    "AddTC_Other": $('#AddTC_Other').val(),
                    "AddTCOtherGST": $('#AddTCOtherGST').val(),
                    "AddTCOtherGSTAmount": $('#AddTCOtherGSTAmount').val(),
                    "AddTCOther_Total": $('#AddTCOther_Total').val(),

                    "AddTC_AMT_Before_GST": $('#AddTC_AMT_Before_GST').val(),
                    "AddTC_GST": $('#AddTC_GST').val(),
                    "AddTC_Total": $('#AddTC_Total').val(),
                    "COO_Vendor": $('#COO_Vendor').val(),
                    "COO_Invoice_No": $('#COO_Invoice_No').val(),
                    "COO_InvDate": $('#COO_InvDate').val(),
                    "COO_Particulars": $('#COO_Particulars').val(),
                    "COO_Amt_Before_GST": $('#COO_Amt_Before_GST').val(),
                    "COOGSTPercentage": $('#COOGSTPercentage').val(),
                    "COO_GST": $('#COO_GST').val(),
                    "COO_Total": $('#COO_Total').val(),
                    "EIA_Vendor": $('#EIA_Vendor').val(),
                    "EIA_Invoice_No": $('#EIA_Invoice_No').val(),
                    "EIA_InvDate": $('#EIA_InvDate').val(),
                    "EIA_Particulars": $('#EIA_Particulars').val(),
                    "EIA_Amt_Before_GST": $('#EIA_Amt_Before_GST').val(),
                    "EIAGSTPercentage": $('#EIAGSTPercentage').val(),
                    "EIA_GST": $('#EIA_GST').val(),
                    "EIA_Total": $('#EIA_Total').val(),
                    "FCForwarder": $('#FCForwarder').val(),
                    "FCInvoice_No": $('#FCInvoice_No').val(),
                    "FCInvDate": $('#FCInvDate').val(),
                    "AdvPaymenton": $('#AdvPaymenton').val(),
                    "PaymentDate": $('#PaymentDate').val(),

                    // Sea-specific Fields
                    "FCSFreight": ($('#FCSFreight').val() || '0').replace(/,/g, ''),
                    "FCSFreight_GST": $('#FCSFreight_GST').val(),
                    "FCSFreight_GSTAmount": $('#FCSFreight_GSTAmount').val(),
                    "FCSFreight_Total": $('#FCSFreight_Total').val(),

                    "FCSTHC": ($('#FCSTHC').val() || '0').replace(/,/g, ''),
                    "FCSTHC_GST": $('#FCSTHC_GST').val(),
                    "FCSTHC_GSTAmount": $('#FCSTHC_GSTAmount').val(),
                    "FCSTHC_Total": $('#FCSTHC_Total').val(),

                    "FCSBL": ($('#FCSBL').val() || '0').replace(/,/g, ''),
                    "FCSBL_GST": $('#FCSBL_GST').val(),
                    "FCSBL_GSTAmount": $('#FCSBL_GSTAmount').val(),
                    "FCSBL_Total": $('#FCSBL_Total').val(),

                    "FCSSeal": ($('#FCSSeal').val() || '0').replace(/,/g, ''),
                    "FCSSEAL_GST": $('#FCSSEAL_GST').val(),
                    "FCSSEAL_GSTAmount": $('#FCSSEAL_GSTAmount').val(),
                    "FCSSEAL_Total": $('#FCSSEAL_Total').val(),

                    "FCSVGM": ($('#FCSVGM').val() || '0').replace(/,/g, ''),
                    "FCSVGM_GST": $('#FCSVGM_GST').val(),
                    "FCSVGM_GSTAmount": $('#FCSVGM_GSTAmount').val(),
                    "FCSVGM_Total": $('#FCSVGM_Total').val(),

                    "FCSMUC": ($('#FCSMUC').val() || '0').replace(/,/g, ''),
                    "FCSMUC_GST": $('#FCSMUC_GST').val(),
                    "FCSMUC_GSTAmount": $('#FCSMUC_GSTAmount').val(),
                    "FCSMUC_Total": $('#FCSMUC_Total').val(),

                    "FCSITHC": ($('#FCSITHC').val() || '0').replace(/,/g, ''),
                    "FCSITHC_GST": $('#FCSITHC_GST').val(),
                    "FCSITHC_GSTAmount": $('#FCSITHC_GSTAmount').val(),
                    "FCSITHC_Total": $('#FCSITHC_Total').val(),

                    "FCSDry_Port_charges": ($('#FCSDry_Port_charges').val() || '0').replace(/,/g, ''),
                    "FCSDry_Port_charges_GST": $('#FCSDry_Port_charges_GST').val(),
                    "FCSDry_Port_charges_GSTAmount": $('#FCSDry_Port_charges_GSTAmount').val(),
                    "FCSDry_Port_charges_Total": $('#FCSDry_Port_charges_Total').val(),

                    "FCSAdministrative_charges": ($('#FCSAdministrative_charges').val() || '0').replace(/,/g, ''),
                    "FCSAdministrative_charges_GST": $('#FCSAdministrative_charges_GST').val(),
                    "FCSAdministrative_charges_GSTAmount": $('#FCSAdministrative_charges_GSTAmount').val(),
                    "FCSAdministrative_charges_Total": $('#FCSAdministrative_charges_Total').val(),

                    "FCSSecurity_filling_fees": ($('#FCSSecurity_filling_fees').val() || '0').replace(/,/g, ''),
                    "FCSSecurity_filling_fees_GST": $('#FCSSecurity_filling_fees_GST').val(),
                    "FCSSecurity_filling_fees_GSTAmount": $('#FCSSecurity_filling_fees_GSTAmount').val(),
                    "FCSSecurity_filling_fees_Total": $('#FCSSecurity_filling_fees_Total').val(),

                    "FCSOther": ($('#FCSOther').val() || '0').replace(/,/g, ''),
                    "FCSOther_GST": $('#FCSOther_GST').val(),
                    "FCSOther_GSTAmount": $('#FCSOther_GSTAmount').val(),
                    "FCSOther_Total": $('#FCSOther_Total').val(),

                    "FCSAmt_Before_GST": $('#FCSAmt_Before_GST').val(),
                    "FCSGST": $('#FCSGST').val(),
                    "FCSTotal": $('#FCSTotal').val(),

                    // Air-specific Fields
                    "FCAAir_Freight": ($('#FCAAir_Freight').val() || '0').replace(/,/g, ''),
                    "FCAAir_Freight_GST": $('#FCAAir_Freight_GST').val(),
                    "FCAAir_Freight_GSTAmount": $('#FCAAir_Freight_GSTAmount').val(),
                    "FCAAir_Freight_Total": $('#FCAAir_Freight_Total').val(),

                    "FCAMCC": ($('#FCAMCC').val() || '0').replace(/,/g, ''),
                    "FCAMCC_GST": $('#FCAMCC_GST').val(),
                    "FCAMCC_GSTAmount": $('#FCAMCC_GSTAmount').val(),
                    "FCAMCC_Total": $('#FCAMCC_Total').val(),

                    "FCAX_Ray": ($('#FCAX_Ray').val() || '0').replace(/,/g, ''),
                    "FCAX_Ray_GST": $('#FCAX_Ray_GST').val(),
                    "FCAX_Ray_GSTAmount": $('#FCAX_Ray_GSTAmount').val(),
                    "FCAX_Ray_Total": $('#FCAX_Ray_Total').val(),

                    "FCAMYC_Fuel": ($('#FCAMYC_Fuel').val() || '0').replace(/,/g, ''),
                    "FCAMYC_Fuel_GST": $('#FCAMYC_Fuel_GST').val(),
                    "FCAMYC_Fuel_GSTAmount": $('#FCAMYC_Fuel_GSTAmount').val(),
                    "FCAMYC_Fuel_Total": $('#FCAMYC_Fuel_Total').val(),

                    "FCAAMS": ($('#FCAAMS').val() || '0').replace(/,/g, ''),
                    "FCAAMS_GST": $('#FCAAMS_GST').val(),
                    "FCAAMS_GSTAmount": $('#FCAAMS_GSTAmount').val(),
                    "FCAAMS_Total": $('#FCAAMS_Total').val(),

                    "FCAAWB": ($('#FCAAWB').val() || '0').replace(/,/g, ''),
                    "FCAAWB_GST": $('#FCAAWB_GST').val(),
                    "FCAAWB_GSTAmount": $('#FCAAWB_GSTAmount').val(),
                    "FCAAWB_Total": $('#FCAAWB_Total').val(),

                    "FCAPCA": ($('#FCAPCA').val() || '0').replace(/,/g, ''),
                    "FCAPCA_GST": $('#FCAPCA_GST').val(),
                    "FCAPCA_GSTAmount": $('#FCAPCA_GSTAmount').val(),
                    "FCAPCA_Total": $('#FCAPCA_Total').val(),

                    "FCAOthers": ($('#FCAOthers').val() || '0').replace(/,/g, ''),
                    "FCAOthers_GST": $('#FCAOthers_GST').val(),
                    "FCAOthers_GSTAmount": $('#FCAOthers_GSTAmount').val(),
                    "FCAOthers_Total": $('#FCAOthers_Total').val(),

                    "FCAAMT_before_GST": $('#FCAAMT_before_GST').val(),
                    "FCAGST": $('#FCAGST').val(),
                    "FCATotal": $('#FCATotal').val(),
                    "Doc_ForwardedNo": $('#Doc_ForwardedNo').val(),
                    "Doc_Sent_Through": $('#Doc_Sent_Through').val(),
                    "Doc_Date": $('#Doc_Date').val(),
                    "Doc_Submitted_Account_On": $('#Doc_Submitted_Account_On').val(),
                    "finalsave": true,
                    "FinalAmtbeforegst": parseFloat($('#td_amt_before_gst').text()) || 0,
                    "FinalTotal" : parseFloat($('#td_Total').text()) || 0,
                    "Finalgstamount": parseFloat($('#td_GST').text()) || 0,
                    "AvgCostPerFCL": parseFloat($('#td_avgfclamt_before_gst').text()) || 0,
                    "AvgCostPerSQM": parseFloat($('#td_avgsqmamt_before_gst').text()) || 0,
                    "Weight": $('#Weight').val(),
                    "Quntity_SQM": $('#Quntity_SQM').val(),
                    "No_of_FCL": noOfFCL,
                    "Type": typeText,
                    "Due_Date": $('#Due_Date').val()
                };
                
                var urlcfsRequest = '@Url.Action("GetAllDataUpdate", "ExportTracker")';

                $.ajax({
                    url: urlcfsRequest,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(model),
                    success: function (data) {
                        if (data.Status === true) {

                            alert('✅ Record Inserted Successfully.');

                            $('#FinalsavePanel').show();
                            $('#FinalsaveDiv').show();
                            $('#logFinalsaveEmployeeName').text('@Session["UserName"]');
                            const now = new Date();
                            const formattedDate = formatJSDate(now);
                            $('#FianlsaveLogDate').text(formattedDate);
                            $('.panel').each(function () {
                                $(this).find('.toggle-content').hide();
                                $(this).find('.toggle-icon')
                                    .removeClass('fa-minus')
                                    .addClass('fa-plus')
                                    .css('transform', 'rotate(0deg)');

                                $(this).find('input, select, textarea, button').prop('disabled', true);
                                const panels = document.querySelectorAll(".panel");
                                panels.forEach(panel => {
                                    const heading = panel.querySelector(".panel-heading span");
                                    if (heading && heading.textContent.trim() === "Document Details" ) {
                                        panel.querySelectorAll("input, select, textarea, button").forEach(field => {
                                            field.disabled = false;
                                        });


                                        const icon = panel.querySelector(".toggle-icon");
                                        if (icon) {
                                            icon.classList.remove("fa-minus");
                                            icon.classList.add("fa-plus");
                                            icon.style.transform = "rotate(0deg)";
                                        }
                                    }
                                });
                            });

                            $('.panel-heading').off('click');

                            if (charges && charges.length > 0) {

                                var ocInsertUrl = '@Url.Action("GetDataUpdateOtherCharges", "ExportTracker")';

                                var model1 = {
                                    Invoice_No: invoice_no,
                                    OtherCharges: charges
                                };
                                $.ajax({
                                    url: ocInsertUrl,
                                    type: 'POST',
                                    contentType: 'application/json',
                                    data: JSON.stringify(model1),
                                    success: function (res) {
                                        if (res.Status === true) {
                                            alert('✅ Other Charges save successfully.');
                                            $('.panel').each(function () {
                                                $(this).find('.toggle-content').hide();
                                                $(this).find('.toggle-icon')
                                                    .removeClass('fa-minus')
                                                    .addClass('fa-plus')
                                                    .css('transform', 'rotate(0deg)');

                                                $(this).find('input, select, textarea, button').prop('disabled', true);
                                            });


                                            $('.panel-heading').off('click');
                                        }
                                    },
                                    error: function (xhr, status, error) {
                                        console.error("InsertOCDetails error:", error);
                                        alert('🚨 Error occurred while inserting Other Charges.');
                                    }
                                });

                            }


                            if (cfsCharges && cfsCharges.length > 0) {


                                var CFSocInsertUrl = '@Url.Action("GetDataUpdateCFSOtherCharges", "ExportTracker")';

           var CFSmodel = {
               Invoice_No: invoice_no,
               Other_Charges: cfsCharges
                                };
                                $.ajax({
                                    url: CFSocInsertUrl,
                                    type: 'POST',
                                    contentType: 'application/json',
                                    data: JSON.stringify(CFSmodel),
                                    success: function (res) {
                                        if (res.Status === true) {
                                            alert('✅ CFS Charges save successfully.');
                                            $('.panel').each(function () {
                                                $(this).find('.toggle-content').hide();
                                                $(this).find('.toggle-icon')
                                                    .removeClass('fa-minus')
                                                    .addClass('fa-plus')
                                                    .css('transform', 'rotate(0deg)');

                                                $(this).find('input, select, textarea, button').prop('disabled', true); // Disable all fields
                                            });


                                            $('.panel-heading').off('click');
                                        }
                                    },
                                    error: function (xhr, status, error) {
                                        console.error("InsertOCDetails error:", error);
                                        alert('🚨 Error occurred while inserting Other Charges.');
                                    }
                                });



                            }

                            //Disabled and Enable Btns
                            $('#lnkEnableFinalSave').css({ 'pointer-events': 'auto', 'filter': 'none', 'opacity': '1', 'cursor': 'pointer' });
                            $('#lnkUpdateFinalSave').css({ 'pointer-events': 'none', 'filter': 'grayscale(1)', 'opacity': '0.6', 'cursor': 'not-allowed' });
                        }
                    }
                });

            } else {

                alert("❗Invoice record not found. Inserting new invoice...");

            }
        },
        error: function () {
            alert("🚨 Error checking invoice record.");
        }
    });
});

              $('#lnkEnableFinalSave').click(function (e) {
                  e.preventDefault();


 var invoice_no = $('#invoiceDropdown').val();

             var model = {

                 "Invoice_No": invoice_no,

             };

             var urlRequest = '@Url.Action("GetDataunloack", "ExportTracker")';

             $.ajax({
                 url: urlRequest,
                 type: 'POST',
                 contentType: 'application/json',
                 data: JSON.stringify(model),
                 success: function (data) {
                     if (data.Status === true) {
                         alert('✅ Invoice has been unlocked successfully!');
                         //Disable and Enable Btn
                         $('#lnkUpdateFinalSave').css({ 'pointer-events': 'auto', 'filter': 'none', 'opacity': '1', 'cursor': 'pointer' });
                         $('#lnkEnableFinalSave').css({ 'pointer-events': 'none', 'filter': 'grayscale(1)', 'opacity': '0.6', 'cursor': 'not-allowed' });

                     } else {
                         alert('⚠️ Failed to unlocked record.');
                     }
                 },
                 error: function (xhr, ret, e) {
                     alert('🚨 Error inserting record: ' + xhr.responseText);
                 }
             });


           });
                  $('#lnkUpdateDocDetails').click(function (e) {
    e.preventDefault();


    var invoice_no = $('#invoiceDropdown').val();
    var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';


    $.ajax({
        type: "POST",
        url: urlRequest1,
        data: { invNo: invoice_no },
        success: function (response) {

            if (response.exists) {

                var model = {

                    "Invoice_No": invoice_no,
                    "Doc_ForwardedNo": $('#Doc_ForwardedNo').val(),
                    "Doc_Sent_Through": $('#Doc_Sent_Through').val(),
                    "Doc_Date": $('#Doc_Date').val(),
                    "Doc_Submitted_Account_On": $('#Doc_Submitted_Account_On').val(),
                    "FinalTotal"  : parseFloat($('#td_Total').text()) || 0,
                     "Finalgstamount": parseFloat($('#td_GST').text()) || 0,
                         "FinalAmtbeforegst" : parseFloat($('#td_amt_before_gst').text()) || 0

                };

                var urlRequest = '@Url.Action("GetDataUpdateDocumnetDetails", "ExportTracker")';


                $.ajax({
                    url: urlRequest,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(model),
                    success: function (data) {
                        if (data.Status === true) {
                            alert('✅ Record Save Successfully.');
                            $('#DocumentDiv').show();
                            $('#logdocEmployeeName').text('@Session["UserName"]');
   const now = new Date();
   const formattedDate = formatJSDate(now);
                            $('#documentLogDate').text(formattedDate);
                            const panel = document.getElementById('DocumentDetailsPanel');
                            if (panel) {
                                const heading = panel.querySelector('.panel-heading');
                                if (heading) {
                                    heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                }
                            }
                        } else {
                            alert('⚠️ Failed to Save record.');
                        }
                    },
                    error: function (xhr, ret, e) {
                        alert('🚨 Error inserting record: ' + xhr.responseText);
                    }
                });

            } else {
                alert("❗Please insert the invoice details first before adding charges.");
            }
        },
        error: function () {
            alert("🚨 Error checking invoice record.");
        }
    });

              });
              $("#Type").click(function (e) {
                  e.preventDefault();
                  var mode = $("#Mode").val();
                  loadFCLByMode(mode);

                  })
  $('#lnkClearance').click(function (e) {
    e.preventDefault();

      calculateGSTAndTotal();
    var invoice_no = $('#invoiceDropdown').val();
    var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';


    $.ajax({
        type: "POST",
        url: urlRequest1,
        data: { invNo: invoice_no },
        success: function (response) {

            if (response.exists) {


                calculateGSTAndTotal();

                var model = {

                    "Invoice_No": invoice_no,
                    "CCClearance_Agent_Name": $('#CCClearance_Agent_Name').val(),
                    "CCInvoice_No": $('#CCInvoice_No').val(),
                    "CCInvDate": $('#Date3').val(),
                    "CCClearance_agency_charges": $('#CCClearance_agency_charges').val(),
                    "CCClearance_Agency_chargesGST": $('#CCClearance_Agency_chargesGST').val(),
                    "CCClearance_Agency_chargesGSTAmount": $('#CCClearance_Agency_chargesGSTAmount').val(),
                    "CCClearance_Agency_charges_Total": $('#CCClearance_Agency_charges_Total').val(),
                    "CCEDI_Xeam_charges": $('#CCEDI_Xeam_charges').val(),
                    "CCEdi_Xeam_ChargesGST": $('#CCEdi_Xeam_ChargesGST').val(),
                    "CCEdi_Xeam_ChargesGSTAmount": $('#CCEdi_Xeam_ChargesGSTAmount').val(),
                    "CCEdi_Xeam_Charges_Total": $('#CCEdi_Xeam_Charges_Total').val(),
                    "CCVGM": $('#CCVGM').val(),
                    "CCVGMGST": $('#CCVGMGST').val(),
                    "CCVGMGSTAmount": $('#CCVGMGSTAmount').val(),
                    "CCVGM_Total": $('#CCVGM_Total').val(),
                    "CCGSEC": $('#CCGSEC').val(),
                    "CCGSECGST": $('#CCGSECGST').val(),
                    "CCGSECGSTAmount": $('#CCGSECGSTAmount').val(),
                    "CCGSEC_Total": $('#CCGSEC_Total').val(),
                    "CCCOO": $('#CCCOO').val(),
                    "CCCOOGST": $('#CCCOOGST').val(),
                    "CCCOOGSTAmount": $('#CCCOOGSTAmount').val(),
                    "CCCOO_Total": $('#CCCOO_Total').val(),
                    "CCExamination_CFS": $('#CCExamination_CFS').val(),
                    "CCExamination_CFSGST": $('#CCExamination_CFSGST').val(),
                    "CCExamination_CFSGSTAmount": $('#CCExamination_CFSGSTAmount').val(),
                    "CCExamination_CFS_Total": $('#CCExamination_CFS_Total').val(),
                    "CCLift_on_Lift_off": $('#CCLift_on_Lift_off').val(),
                    "CCLift_on_Lift_offGST": $('#CCLift_on_Lift_offGST').val(),
                    "CCLift_on_Lift_offGSTAmount": $('#CCLift_on_Lift_offGSTAmount').val(),
                    "CCLift_on_Lift_off_Total": $('#CCLift_on_Lift_off_Total').val(),
                    "CCCFS": $('#CCCFS').val(),
                    "CCCFSGST": $('#CCCFSGST').val(),
                    "CCCFSGSTAmount": $('#CCCFSGSTAmount').val(),
                    "CCCFSTotal": $('#CCCFSTotal').val(),

                    "CCOthers": $('#CCOthers').val(),
                    "CCOthersGST": $('#CCOthersGST').val(),
                    "CCOthersGSTAmount": $('#CCOthersGSTAmount').val(),
                    "CCOthers_Total": $('#CCOthers_Total').val(),

                    "CCAmt_Before_GST": $('#CCAmt_Before_GST').val(),
                    "CCGST": $('#CCGST').val(),
                    "CC_total": $('#CC_total').val(),
                    "FinalAmtbeforegst": parseFloat($('#td_amt_before_gst').text()) || 0,
                    "FinalTotal": parseFloat($('#td_Total').text()) || 0,
                    "Finalgstamount": parseFloat($('#td_GST').text()) || 0,

                };

                var urlRequest = '@Url.Action("GetDataUpdateClearance", "ExportTracker")';
                if (model.CCAmt_Before_GST !== "0.00") {
                    $.ajax({
                        url: urlRequest,
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(model),
                        success: function (data) {
                            if (data.Status === true) {
                                alert('✅ Record Inserted Successfully.');
                                $('#cleardiv').show();

                                $('#logccEmployeeName').text('@Session["UserName"]');
                                const now = new Date();
                                const formattedDate = formatJSDate(now);
                                $('#clearanceLogDate').text(formattedDate);
                                const panel = document.getElementById('ClearanceDetailsPanel');
                                if (panel) {
                                    const heading = panel.querySelector('.panel-heading');
                                    if (heading) {
                                        heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                    }
                                }
                            } else {
                                alert('⚠️ Failed to insert record.');
                            }
                        },
                        error: function (xhr, ret, e) {
                            alert('🚨 Error inserting record: ' + xhr.responseText);
                        }
                    });
                }
                else {
                    alert("Please Enter the value ....");
                }
            }
          else {
                alert("❗Please insert the invoice details first before adding charges.");
            }
        },
        error: function () {
            alert("🚨 Error checking invoice record.");
        }
    });

  });
  $(document).on('click', '#lnkUpdateCfsOC', function (e) {
    e.preventDefault();


    var invoice_no = $('#invoiceDropdown').val();
    var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';

    $.ajax({
        type: "POST",
        url: urlRequest1,
        data: { invNo: invoice_no },
        success: function (response) {
            if (response.exists) {
                var model = {
                    "Invoice_No": invoice_no,
                    "CFS_Vendor": $('#CFS_Vendor').val(),
                    "CFS_Invoice_No": $('#CFS_Invoice_No').val(),
                    "CFS_InvDate": $('#CFS_InvDate').val(),
                    "CFS_Amt_Before_GST": $('#CFS_Amt_Before_GST').val(),
                    "CFS_GST": $('#CFS_GST').val(),
                    "CFS_Total": $('#CFS_Total').val(),
                    "FinalAmtbeforegst": parseFloat($('#td_amt_before_gst').text()) || 0,
                    "FinalTotal": parseFloat($('#td_Total').text()) || 0,
                    "Finalgstamount": parseFloat($('#td_GST').text()) || 0,

                };

                var urlRequestCFS = '@Url.Action("GetDataUpdateCFS", "ExportTracker")';
                if (model.CFS_Amt_Before_GST !== "0.00") {
                    $.ajax({
                        url: urlRequestCFS,
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(model),
                        success: function (data) {
                            if (data.Status === true) {
                                InsertcfsOCDetails();

                                $('#CFSvDiv').show();
                                $('#logCFSEmployeeName').text('@Session["UserName"]');
                                const now = new Date();
                                const formattedDate = formatJSDate(now);
                                $('#cfsLogDate').text(formattedDate);
                                const panel = document.getElementById('cfsChargesPanel');
                                if (panel) {
                                    const heading = panel.querySelector('.panel-heading');
                                    if (heading) {
                                        heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                    }
                                }
                            } else {
                                alert('⚠️ Failed to insert record.');
                            }
                        },
                        error: function (xhr, ret, e) {
                            alert('🚨 Error inserting record: ' + xhr.responseText);
                        }
                    });
                }
                else {
                    alert("Please Enter the value ....");
                }

            } else {
                alert("❗Please insert the invoice details first before adding charges.");
            }
        },
        error: function () {
            alert("🚨 Error checking invoice record.");
        }
    });
});

              $(document).on('click', '#lnkUpdateTC', function (e) {
    e.preventDefault();

    calculateGSTAndTotal();
    var invoice_no = $('#invoiceDropdown').val();
    var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';

    $.ajax({
        type: "POST",
        url: urlRequest1,
        data: { invNo: invoice_no },
        success: function (response) {
            if (response.exists) {
                calculateGSTAndTotal();

                var model = {
                    "Invoice_No": invoice_no,
                    "TC_Transporter": $('#TC_Transporter').val(),
                    "TC_Invoice_No": $('#TC_Invoice_No').val(),
                    "TC_InvDate": $('#TC_InvDate').val(),

                    "TC_Charges": $('#TC_Charges').val(),
                    "TCChargesGST": $('#TCChargesGST').val(),
                    "TCChargesGSTAmount": $('#TCChargesGSTAmount').val(),
                    "TCCharges_Total": $('#TCCharges_Total').val(),

                    "TC_VGM": $('#TC_VGM').val(),
                    "TCVGMGST": $('#TCVGMGST').val(),
                    "TCVGMGSTAmount": $('#TCVGMGSTAmount').val(),
                    "TCVGM_Total": $('#TCVGM_Total').val(),

                    "TC_Other": $('#TC_Other').val(),
                    "TCOtherGST": $('#TCOtherGST').val(),
                    "TCOtherGSTAmount": $('#TCOtherGSTAmount').val(),
                    "TCOther_Total": $('#TCOther_Total').val(),

                    "TC_AMT_Before_GST": $('#TC_AMT_Before_GST').val(),
                    "TC_GST": $('#TC_GST').val(),
                    "TC_Total": $('#TC_Total').val(),
                    "FinalAmtbeforegst": parseFloat($('#td_amt_before_gst').text()) || 0,
                    "FinalTotal": parseFloat($('#td_Total').text()) || 0,
                    "Finalgstamount": parseFloat($('#td_GST').text()) || 0,

                };

                var urlRequestCFS = '@Url.Action("GetDataUpdateTransportation", "ExportTracker")';
                if (model.TC_AMT_Before_GST !== "0.00") {
                    $.ajax({
                        url: urlRequestCFS,
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(model),
                        success: function (data) {
                            if (data.Status === true) {
                                alert('✅ Record Inserted Successfully.');
                                $('#transdiv').show();
                                $('#logTraEmployeeName').text('@Session["UserName"]');
                                const now = new Date();
                                const formattedDate = formatJSDate(now);
                                $('#transportLogDate').text(formattedDate);

                                const panel = document.getElementById('TransporterDetailsPanel');
                                if (panel) {
                                    const heading = panel.querySelector('.panel-heading');
                                    if (heading) {
                                        heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                    }
                                }
                            } else {
                                alert('⚠️ Failed to insert record.');
                            }
                        },
                        error: function (xhr, ret, e) {
                            alert('🚨 Error inserting record: ' + xhr.responseText);
                        }
                    });
                }
                else {
                    alert("Please enter the value ....");
                }


            } else {
                alert("❗Please insert the invoice details first before adding charges.");
            }
        },
        error: function () {
            alert("🚨 Error checking invoice record.");
        }
    });
});


              $('#lnkUpdateAddTC').click(function (e) {
e.preventDefault();

  calculateGSTAndTotal();
var invoice_no = $('#invoiceDropdown').val();
var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';


$.ajax({
    type: "POST",
    url: urlRequest1,
    data: { invNo: invoice_no },
    success: function (response) {

        if (response.exists) {


            calculateGSTAndTotal();

            var model = {
                "Invoice_No": invoice_no,
                "AddTC_Transporter": $('#AddTC_Transporter').val(),
                "AddTC_Invoice_No": $('#AddTC_Invoice_No').val(),
                "AddTC_InvDate": $('#AddTC_InvDate').val(),
                "AddTCAdvPaymentOn": $('#AddTCAdvPaymentOn').val(),
                "AddTCPaymentDate": $('#AddTCPaymentDate').val(),
                "AddTC_Charges": $('#AddTC_Charges').val(),
                "AddTCChargesGST": $('#AddTCChargesGST').val(),
                "AddTCChargesGSTAmount": $('#AddTCChargesGSTAmount').val(),
                "AddTCCharges_Total": $('#AddTCCharges_Total').val(),

                "AddTC_VGM": $('#AddTC_VGM').val(),
                "AddTCVGMGST": $('#AddTCVGMGST').val(),
                "AddTCVGMGSTAmount": $('#AddTCVGMGSTAmount').val(),
                "AddTCVGM_Total": $('#AddTCVGM_Total').val(),

                "AddTC_Other": $('#AddTC_Other').val(),
                "AddTCOtherGST": $('#AddTCOtherGST').val(),
                "AddTCOtherGSTAmount": $('#AddTCOtherGSTAmount').val(),
                "AddTCOther_Total": $('#AddTCOther_Total').val(),

                "AddTC_AMT_Before_GST": $('#AddTC_AMT_Before_GST').val(),
                "AddTC_GST": $('#AddTC_GST').val(),
                "AddTC_Total": $('#AddTC_Total').val(),
                "FinalAmtbeforegst": parseFloat($('#td_amt_before_gst').text()) || 0,
                "FinalTotal": parseFloat($('#td_Total').text()) || 0,
                "Finalgstamount": parseFloat($('#td_GST').text()) || 0,


            };

            var urlRequestCFS = '@Url.Action("GetDataUpdateAddTransportation", "ExportTracker")';
            if (model.AddTC_AMT_Before_GST !== "0.00") {
                $.ajax({
                    url: urlRequestCFS,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(model),
                    success: function (data) {
                        if (data.Status === true) {
                            alert('✅ Record Inserted Successfully.');

                            $('#AddTransportdiv').show();
                            $('#logaddtraEmployeeName').text('@Session["UserName"]');
                            const now = new Date();
                            const formattedDate = formatJSDate(now);
                            $('#addTransportLogDate').text(formattedDate);
                            const panel = document.getElementById('addtransporter');
                            if (panel) {
                                const heading = panel.querySelector('.panel-heading');
                                if (heading) {
                                    heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                }
                            }
                        } else {
                            alert('⚠️ Failed to insert record.');
                        }
                    },
                    error: function (xhr, ret, e) {
                        alert('🚨 Error inserting record: ' + xhr.responseText);
                    }
                });
            }
            else {
                alert("Please enter the value ....");
            }


        } else {
            alert("❗Please insert the invoice details first before adding charges.");
        }
    },
    error: function () {
        alert("🚨 Error checking invoice record.");
    }
});

              });


        $('#lnkUpdateOC').click(function (e) {
    e.preventDefault();

            InsertOCDetails();
        });
              $('#lnkUpdateBLOC').click(function (e) {
    e.preventDefault();

            InsertOCBLDetails();
        });

        $('#lnkUpdateCOO').click(function (e) {
    e.preventDefault();

      calculateGSTAndTotal();
    var invoice_no = $('#invoiceDropdown').val();
    var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';


    $.ajax({
        type: "POST",
        url: urlRequest1,
        data: { invNo: invoice_no },
        success: function (response) {

            if (response.exists) {

                calculateGSTAndTotal();

                var model = {
                    "Invoice_No": invoice_no,
                    "COO_Vendor": $('#COO_Vendor').val(),
                    "COO_Invoice_No": $('#COO_Invoice_No').val(),
                    "COO_InvDate": $('#COO_InvDate').val(),
                    "COO_Particulars": $('#COO_Particulars').val(),
                    "COO_Amt_Before_GST": $('#COO_Amt_Before_GST').val(),
                    "COOGSTPercentage": $('#COOGSTPercentage').val(),
                    "COO_GST": $('#COO_GST').val(),
                    "COO_Total": $('#COO_Total').val(),
                    "FinalAmtbeforegst": parseFloat($('#td_amt_before_gst').text()) || 0,
                    "FinalTotal": parseFloat($('#td_Total').text()) || 0,
                    "Finalgstamount": parseFloat($('#td_GST').text()) || 0,



                };

                var urlRequestCFS = '@Url.Action("GetDataUpdateCOO", "ExportTracker")';

                $.ajax({
                    url: urlRequestCFS,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(model),
                    success: function (data) {
                        if (data.Status === true) {
                            alert('✅ Record Inserted Successfully.');
                            $('#COO').show();
                            $('#logcooEmployeeName').text('@Session["UserName"]');
                               const now = new Date();
                               const formattedDate = formatJSDate(now);
                            $('#cooLogDate').text(formattedDate);
                            const panel = document.getElementById('COODetailsPanel');
                            if (panel) {
                                const heading = panel.querySelector('.panel-heading');
                                if (heading) {
                                    heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                }
                            }
                        } else {
                            alert('⚠️ Failed to insert record.');
                        }
                    },
                    error: function (xhr, ret, e) {
                        alert('🚨 Error inserting record: ' + xhr.responseText);
                    }
                });

            } else {
                alert("❗Please insert the invoice details first before adding charges.");
            }
        },
        error: function () {
            alert("🚨 Error checking invoice record.");
        }
    });

        });
        $('#lnkUpdateEIA').click(function (e) {
    e.preventDefault();

      calculateGSTAndTotal();
    var invoice_no = $('#invoiceDropdown').val();
    var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';


    $.ajax({
        type: "POST",
        url: urlRequest1,
        data: { invNo: invoice_no },
        success: function (response) {

            if (response.exists) {


                calculateGSTAndTotal();

                var model = {
                    "Invoice_No": invoice_no,
                    "EIA_Vendor": $('#EIA_Vendor').val(),
                    "EIA_Invoice_No": $('#EIA_Invoice_No').val(),
                    "EIA_InvDate": $('#EIA_InvDate').val(),
                    "EIA_Particulars": $('#EIA_Particulars').val(),
                    "EIA_Amt_Before_GST": $('#EIA_Amt_Before_GST').val(),
                    "EIAGSTPercentage": $('#EIAGSTPercentage').val(),
                    "EIA_GST": $('#EIA_GST').val(),
                    "EIA_Total": $('#EIA_Total').val(),
                    "FinalAmtbeforegst": parseFloat($('#td_amt_before_gst').text()) || 0,
                    "FinalTotal": parseFloat($('#td_Total').text()) || 0,
                    "Finalgstamount": parseFloat($('#td_GST').text()) || 0,


                };

                var urlRequestCFS = '@Url.Action("GetDataUpdateEIA", "ExportTracker")';
                if (model.EIA_Amt_Before_GST !== "0.00") {
                    $.ajax({
                        url: urlRequestCFS,
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(model),
                        success: function (data) {
                            if (data.Status === true) {
                                alert('✅ Record Inserted Successfully.');
                                $('#EIADIV').show();
                                $('#logForEmployeeName').text('@Session["UserName"]');
                                const now = new Date();
                                const formattedDate = formatJSDate(now);
                                $('#eiaLogDate').text(formattedDate);
                                const panel = document.getElementById('EIADetailsPanel');
                                if (panel) {
                                    const heading = panel.querySelector('.panel-heading');
                                    if (heading) {
                                        heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                    }
                                }
                            } else {
                                alert('⚠️ Failed to insert record.');
                            }
                        },
                        error: function (xhr, ret, e) {
                            alert('🚨 Error inserting record: ' + xhr.responseText);
                        }
                    });
                }
                else {
                    alert("Please enter the value ....");
                }

            } else {
                alert("❗Please insert the invoice details first before adding charges.");
            }
        },
        error: function () {
            alert("🚨 Error checking invoice record.");
        }
    });

        });
              $('#chargesTable').on('input', '.oc-amt-before-gst,.oc-gstPercentage', function () {

                  var $row = $(this).closest('tr'); // get the current row


                  const amountBeforeGST = parseFloat($row.find('.oc-amt-before-gst').val().replace(/,/g, '')) || 0;
                  const gstPercentage = parseFloat($row.find('.oc-gstPercentage').val()) || 0;

                  var gst = (amountBeforeGST * gstPercentage)/100;
                  var total = amountBeforeGST + gst;

                  $row.find('.oc-gstAmount').val(gst.toFixed(2));
                  $row.find('.oc-total').val(total.toFixed(2));
              });
              $('#BLchargesTable').on('input', '.oc-BLamt-before-gst,.oc-BLgstPercentage', function () {

                  var $row = $(this).closest('tr'); // get the current row


                  const amountBeforeGST = parseFloat($row.find('.oc-BLamt-before-gst').val().replace(/,/g, '')) || 0;
                  const gstPercentage = parseFloat($row.find('.oc-BLgstPercentage').val()) || 0;

                  var gst = (amountBeforeGST * gstPercentage)/100;
                  var total = amountBeforeGST + gst;

                  $row.find('.oc-BLgstAmount').val(gst.toFixed(2));
                  $row.find('.oc-BLtotal').val(total.toFixed(2));
              });
              $('#CfschargesTable').on('input', '.cfs_amtbeforegst,.cfs_gstpercentage', function () {


                  const rowElement = $(this).closest('tr');


                  const amt = parseFloat(rowElement.find('.cfs_amtbeforegst').val()) || 0;
                  const gstPercent = parseFloat(rowElement.find('.cfs_gstpercentage').val()) || 0;


                  const gst = (amt * gstPercent) / 100;
                  const total = amt + gst;


                  rowElement.find('.cfs_gstAmount').val(gst.toFixed(2));
                  rowElement.find('.cfs_total').val(total.toFixed(2));
                  calculateCfsGrandTotals();

              });
              $('#lnkUpdateFCS, #lnkUpdateFCA').click(function (e) {
                  e.preventDefault();
                  calculateGSTAndTotal();
                  var invoice_no = $('#invoiceDropdown').val();

                  var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';
                  var clickedButtonId = $(this).attr('id');
                  $.ajax({
                    type: "POST",
                    url: urlRequest1,
                    data: { invNo: invoice_no },
                    success: function (response) 
                    {
                        if (response.exists)
                        {
                            calculateGSTAndTotal();
                            var isSea = clickedButtonId === 'lnkUpdateFCS';
                            var forwarderType = isSea ? 'Sea' : 'Air';


                            var model = {
                                Invoice_No: invoice_no,
                                Forwarder_Details: forwarderType,

                                FCForwarder: $('#FCForwarder').val(),
                                FCInvoice_No: $('#FCInvoice_No').val(),
                                FCInvDate: $('#FCInvDate').val(),
                                PaymentDate: $('#PaymentDate').val(),
                                AdvPaymenton: $('#AdvPaymenton').val(),

                                FCSFreight: ($('#FCSFreight').val() || '0').replace(/,/g, ''),
                                FCSFreight_GST: $('#FCSFreight_GST').val(),
                                FCSFreight_GSTAmount: $('#FCSFreight_GSTAmount').val(),
                                FCSFreight_Total: $('#FCSFreight_Total').val(),

                                FCSTHC: ($('#FCSTHC').val() || '0').replace(/,/g, ''),
                                FCSTHC_GST: $('#FCSTHC_GST').val(),
                                FCSTHC_GSTAmount: $('#FCSTHC_GSTAmount').val(),
                                FCSTHC_Total: $('#FCSTHC_Total').val(),

                                FCSBL: ($('#FCSBL').val() || '0').replace(/,/g, ''),
                                FCSBL_GST: $('#FCSBL_GST').val(),
                                FCSBL_GSTAmount: $('#FCSBL_GSTAmount').val(),
                                FCSBL_Total: $('#FCSBL_Total').val(),

                                FCSSeal: ($('#FCSSeal').val() || '0').replace(/,/g, ''),
                                FCSSEAL_GST: $('#FCSSEAL_GST').val(),
                                FCSSEAL_GSTAmount: $('#FCSSEAL_GSTAmount').val(),
                                FCSSEAL_Total: $('#FCSSEAL_Total').val(),

                                FCSVGM: ($('#FCSVGM').val() || '0').replace(/,/g, ''),
                                FCSVGM_GST: $('#FCSVGM_GST').val(),
                                FCSVGM_GSTAmount: $('#FCSVGM_GSTAmount').val(),
                                FCSVGM_Total: $('#FCSVGM_Total').val(),

                                FCSMUC: ($('#FCSMUC').val() || '0').replace(/,/g, ''),
                                FCSMUC_GST: $('#FCSMUC_GST').val(),
                                FCSMUC_GSTAmount: $('#FCSMUC_GSTAmount').val(),
                                FCSMUC_Total: $('#FCSMUC_Total').val(),

                                FCSITHC: ($('#FCSITHC').val() || '0').replace(/,/g, ''),
                                FCSITHC_GST: $('#FCSITHC_GST').val(),
                                FCSITHC_GSTAmount: $('#FCSITHC_GSTAmount').val(),
                               FCSITHC_Total: $('#FCSITHC_Total').val(),

                                FCSDry_Port_charges: ($('#FCSDry_Port_charges').val() || '0').replace(/,/g, ''),
                                FCSDry_Port_charges_GST: $('#FCSDry_Port_charges_GST').val(),
                                FCSDry_Port_charges_GSTAmount: $('#FCSDry_Port_charges_GSTAmount').val(),
                                FCSDry_Port_charges_Total: $('#FCSDry_Port_charges_Total').val(),

                                FCSAdministrative_charges: ($('#FCSAdministrative_charges').val() || '0').replace(/,/g, ''),
                                FCSAdministrative_charges_GST: $('#FCSAdministrative_charges_GST').val(),
                                FCSAdministrative_charges_GSTAmount: $('#FCSAdministrative_charges_GSTAmount').val(),
                                FCSAdministrative_charges_Total: $('#FCSAdministrative_charges_Total').val(),

                                FCSSecurity_filling_fees: ($('#FCSSecurity_filling_fees').val() || '0').replace(/,/g, ''),
                                FCSSecurity_filling_fees_GST: $('#FCSSecurity_filling_fees_GST').val(),
                                FCSSecurity_filling_fees_GSTAmount: $('#FCSSecurity_filling_fees_GSTAmount').val(),
                                FCSSecurity_filling_fees_Total: $('#FCSSecurity_filling_fees_Total').val(),

                                FCSOther: ($('#FCSOther').val() || '0').replace(/,/g, ''),
                                FCSOther_GST: $('#FCSOther_GST').val(),
                                FCSOther_GSTAmount: $('#FCSOther_GSTAmount').val(),
                                FCSOther_Total: $('#FCSOther_Total').val(),

                                FCSAmt_Before_GST: $('#FCSAmt_Before_GST').val(),
                                FCSGST: $('#FCSGST').val(),
                                FCSTotal: $('#FCSTotal').val(),

                                FCAAir_Freight: ($('#FCAAir_Freight').val() || '0').replace(/,/g, ''),
                                "FCAAir_Freight_GST": $('#FCAAir_Freight_GST').val(),
                                "FCAAir_Freight_GSTAmount": $('#FCAAir_Freight_GSTAmount').val(),
                                "FCAAir_Freight_Total": $('#FCAAir_Freight_Total').val(),

                                "FCAMCC": ($('#FCAMCC').val() || '0').replace(/,/g, ''),
                                "FCAMCC_GST": $('#FCAMCC_GST').val(),
                                "FCAMCC_GSTAmount": $('#FCAMCC_GSTAmount').val(),
                                "FCAMCC_Total": $('#FCAMCC_Total').val(),

                                "FCAX_Ray": ($('#FCAX_Ray').val() || '0').replace(/,/g, ''),
                                "FCAX_Ray_GST": $('#FCAX_Ray_GST').val(),
                                "FCAX_Ray_GSTAmount": $('#FCAX_Ray_GSTAmount').val(),
                                "FCAX_Ray_Total": $('#FCAX_Ray_Total').val(),

                                "FCAMYC_Fuel": ($('#FCAMYC_Fuel').val() || '0').replace(/,/g, ''),
                                "FCAMYC_Fuel_GST": $('#FCAMYC_Fuel_GST').val(),
                                "FCAMYC_Fuel_GSTAmount": $('#FCAMYC_Fuel_GSTAmount').val(),
                                "FCAMYC_Fuel_Total": $('#FCAMYC_Fuel_Total').val(),

                                "FCAAMS": ($('#FCAAMS').val() || '0').replace(/,/g, ''),
                                "FCAAMS_GST": $('#FCAAMS_GST').val(),
                                "FCAAMS_GSTAmount": $('#FCAAMS_GSTAmount').val(),
                                "FCAAMS_Total": $('#FCAAMS_Total').val(),

                                "FCAAWB": ($('#FCAAWB').val() || '0').replace(/,/g, ''),
                                "FCAAWB_GST": $('#FCAAWB_GST').val(),
                                "FCAAWB_GSTAmount": $('#FCAAWB_GSTAmount').val(),
                                "FCAAWB_Total": $('#FCAAWB_Total').val(),

                                "FCAPCA": ($('#FCAPCA').val() || '0').replace(/,/g, ''),
                                "FCAPCA_GST": $('#FCAPCA_GST').val(),
                                "FCAPCA_GSTAmount": $('#FCAPCA_GSTAmount').val(),
                                "FCAPCA_Total": $('#FCAPCA_Total').val(),

                                "FCAOthers": ($('#FCAOthers').val() || '0').replace(/,/g, ''),
                                "FCAOthers_GST": $('#FCAOthers_GST').val(),
                                "FCAOthers_GSTAmount": $('#FCAOthers_GSTAmount').val(),
                                "FCAOthers_Total": $('#FCAOthers_Total').val(),

                                "FCAAMT_before_GST": $('#FCAAMT_before_GST').val(),
                                "FCAGST": $('#FCAGST').val(),
                                "FinalAmtbeforegst": parseFloat($('#td_amt_before_gst').text()) || 0,
                                "FinalTotal": parseFloat($('#td_Total').text()) || 0,
                                "Finalgstamount": parseFloat($('#td_GST').text()) || 0,
                                "FCATotal": $('#FCATotal').val(),

                            };
                            console.log(model);
                            if (model.FCSAmt_Before_GST !== "0.00" || model.FCAAMT_before_GST!=="0.00") {
                                $.ajax({
                                    url: '@Url.Action("GetDataUpdateForwarderCharges", "ExportTracker")',
                                    type: 'POST',
                                    contentType: 'application/json',
                                    data: JSON.stringify(model),
                                    success: function (data) {
                                        if (data.Status === true) {
                                            alert('✅ Forwarder Charges Updated Successfully (' + forwarderType + ').');
                                            $('#forwerdiv').show();
                                            $('#logForEmployeeName').text('@Session["UserName"]');
                                            const now = new Date();
                                            const formattedDate = formatJSDate(now);
                                            $('#fcLogDate').text(formattedDate);
                                            const panel = document.getElementById('forwerderDetailsPanel');
                                            if (panel) {
                                                const heading = panel.querySelector('.panel-heading');
                                                if (heading) {
                                                    heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                                }
                                            }
                                        } else {
                                            alert('⚠️ Update failed for ' + forwarderType + '.');
                                        }
                                    },
                                    error: function (xhr) {
                                        alert('🚨 Error: ' + xhr.responseText);
                                    }
                                });

                            }
                            else {
                                alert("Plese enter the value ....");
                            }
                        }
                        else
                        {
                            alert("❗Please insert the invoice details first before adding charges.");
                        }
                    },
                    error: function () {
                        alert("🚨 Error checking invoice record.");
                    }
                });

            });

              $('#CCClearance_agency_charges, #CCEDI_Xeam_charges, #CCVGM, #CCGSEC, #CCCOO, #CCExamination_CFS, #CCLift_on_Lift_off, #CCOthers, #CCCFS,#CCCFSGST,#CCCFSGSTAmount,#CCCFSTotal,#Insurarnce_charged')
            .on('keyup change', function () {
                    calculateGSTAndTotal();
            });
              $('#CFS_Amt_Before_GST,#CFS_GST,#CFS_Total,#TC_VGM,#TC_Charges,#TC_Other,#AddTC_VGM,#AddTC_Charges,#AddTC_Other,#COO_Amt_Before_GST, #COO_GST, #COO_Total, #EIA_Amt_Before_GST, #EIA_GST, #EIA_Total, #OC_Amt_Before_GST,#OC_GSTPercentage, #OC_GSTAmount, #OC_Total').on('keyup change', function () {
            calculateGSTAndTotal();
              });
              $('#FCSFreight,#FCSFreight_GST,#FCSFreight_GSTAmount,#FCSFreight_Total,#FCSTHC,#FCSTHC_GST,#FCSTHC_GSTAmount,#FCSTHC_Total,#FCSBL,#FCSBL_GST, #FCSBL_GSTAmount, #FCSBL_Total, #FCSSeal, #FCSSEAL_GST, #FCSSEAL_GSTAmount, #FCSSEAL_Total,#FCSVGM, #FCSVGM_GST, #FCSVGM_GSTAmount,#FCSVGM_Total,#FCSMUC,#FCSMUC_GST,#FCSMUC_GSTAmount,#FCSMUC_Total,#FCSITHC,#FCSITHC_GST,#FCSITHC_GSTAmount,#FCSITHC_Total,#FCSDry_Port_charges,#FCSDry_Port_charges_GST,#FCSDry_Port_charges_GSTAmount,#FCSDry_Port_charges_Total').on('keyup change', function () {
                  calculateGSTAndTotal();
              });
              $('#FCSAdministrative_charges,#FCSAdministrative_charges_GST,#FCSAdministrative_charges_GSTAmount,#FCSAdministrative_charges_Total,#FCSSecurity_filling_fees,#FCSSecurity_filling_fees_GST,#FCSSecurity_filling_fees_GSTAmount,#FCSSecurity_filling_fees_Total,#FCSOther,#FCSOther_GST, #FCSOther_GSTAmount, #FCSOther_Total, #FCSAmt_Before_GST, #FCSGST, #FCSTotal').on('keyup change', function () {
                  calculateGSTAndTotal();
              });
              $('#FCAAir_Freight,#FCAAir_Freight_GST,#FCAAir_Freight_GSTAmount,#FCAAir_Freight_Total,#FCAMCC,#FCAMCC_GST,#FCAMCC_GSTAmount,#FCAMCC_Total,#FCAX_Ray,#FCAX_Ray_GST, #FCAX_Ray_GSTAmount, #FCAX_Ray_Total, #FCAMYC_Fuel, #FCAMYC_Fuel_GST, #FCAMYC_Fuel_GSTAmount,#FCAMYC_Fuel_Total,#FCAAMS,#FCAAMS_GST,#FCAAMS_GSTAmount,#FCAAMS_Total,#FCAAWB,#FCAAWB_GST,#FCAAWB_GSTAmount,#FCAAWB_Total,#FCAPCA,#FCAPCA_GST,#FCAPCA_GSTAmount,#FCAPCA_Total,#FCAOthers,#FCAOthers_GST,#FCAOthers_GSTAmount,#FCAOthers_Total,#FCAAMT_before_GST,#FCAGST,#FCATotal').on('keyup change', function () {
                  calculateGSTAndTotal();
              });
              $('#CCEdi_Xeam_ChargesGST,#CCEdi_Xeam_ChargesGSTAmount,#FCAAir_Freight_GSTAmount,#FCAAir_Freight_Total,#FCAMCC,#FCAMCC_GST,#FCAMCC_GSTAmount,#FCAMCC_Total,#FCAX_Ray,#FCAX_Ray_GST, #FCAX_Ray_GSTAmount, #FCAX_Ray_Total, #FCAMYC_Fuel, #FCAMYC_Fuel_GST, #FCAMYC_Fuel_GSTAmount,#FCAMYC_Fuel_Total,#FCAAMS,#FCAAMS_GST,#FCAAMS_GSTAmount,#FCAAMS_Total,#FCAAWB,#FCAAWB_GST,#FCAAWB_GSTAmount,#FCAAWB_Total,#FCAPCA,#FCAPCA_GST,#FCAPCA_GSTAmount,#FCAPCA_Total,#FCAOthers,#FCAOthers_GST,#FCAOthers_GSTAmount,#FCAOthers_Total,#FCAAMT_before_GST,#FCAGST,#FCATotal').on('keyup change', function () {
                  calculateGSTAndTotal();
              });
              $('#CCEdi_Xeam_ChargesGST, #CCEdi_Xeam_ChargesGSTAmount, #FCAAir_Freight_GSTAmount, #FCAAir_Freight_Total, #FCAMCC, #FCAMCC_GST, #FCAMCC_GSTAmount, #FCAMCC_Total, #FCAX_Ray, #FCAX_Ray_GST, #FCAX_Ray_GSTAmount, #FCAX_Ray_Total, #FCAMYC_Fuel, #FCAMYC_Fuel_GST, #FCAMYC_Fuel_GSTAmount, #FCAMYC_Fuel_Total, #FCAAMS, #FCAAMS_GST, #FCAAMS_GSTAmount, #FCAAMS_Total, #FCAAWB, #FCAAWB_GST, #FCAAWB_GSTAmount, #FCAAWB_Total, #FCAPCA, #FCAPCA_GST, #FCAPCA_GSTAmount, #FCAPCA_Total, #FCAOthers, #FCAOthers_GST, #FCAOthers_GSTAmount, #FCAOthers_Total, #FCAAMT_before_GST, #FCAGST, #FCATotal,' +
                  '#CCEDI_Xeam_Charges, #CCEDI_Xeam_ChargesGST, #CCEDI_Xeam_ChargesGSTAmount, #CCEdi_Xeam_Charges_Total, #CCClearance_agency_charges, #CCClearance_Agency_chargesGST, #CCClearance_Agency_chargesGSTAmount, #CCClearance_Agency_charges_Total, #CCVGM, #CCVGMGST, #CCVGMGSTAmount, #CCVGM_Total, #CCGSEC, #CCGSECGST, #CCGSECGSTAmount, #CCGSEC_Total, #CCCOO, #CCCOOGST, #CCCOOGSTAmount, #CCCOO_Total, #CCExamination_CFS, #CCExamination_CFSGST, #CCExamination_CFSGSTAmount, #CCExamination_CFS_Total, #CCLift_on_Lift_off, #CCLift_on_Lift_offGST, #CCLift_on_Lift_offGSTAmount, #CCLift_on_Lift_off_Total, #CCOthers, #CCOthersGST, #CCOthersGSTAmount, #CCOthers_Total, #CCAmt_Before_GST, #CCGST, #CC_total,' +
                  '#TC_Charges, #TCChargesGST, #TCChargesGSTAmount, #TCCharges_Total, #TC_VGM, #TCVGMGST, #TCVGMGSTAmount, #TCVGM_Total, #TC_Other, #TCOtherGST, #TCOtherGSTAmount, #TCOther_Total, #TC_AMT_Before_GST, #TC_GST, #TC_Total,' +
                  '#AddTC_Charges, #AddTCChargesGST, #AddTCChargesGSTAmount, #AddTCCharges_Total, #AddTC_VGM, #AddTCVGMGST, #AddTCVGMGSTAmount, #AddTCVGM_Total, #AddTC_Other, #AddTCOtherGST, #AddTCOtherGSTAmount, #AddTCOther_Total, #AddTC_AMT_Before_GST, #AddTC_GST, #AddTC_Total,' +
                  '#COO_Amt_Before_GST, #COO_GST, #COOGSTPercentage, #COO_Total,' +
                  '#EIA_Amt_Before_GST, #EIA_GST, #EIAGSTPercentage, #EIA_Total')
                  .on('keyup change', function () {
                      calculateGSTAndTotal();
                  });

        $('#lnkSave').click(function (e) {


            e.preventDefault();
            insertInvoiceDetails();

                });
          });
          function loadFCLByMode(mode) {
              var typeDropdown = $('#Type');


    $.ajax({
        url: '@Url.Action("GetFCLByMode", "Common")',
        type: 'GET',
        data: { mode: mode },
        success: function (data) {


            var currentSelectedText = typeDropdown.find("option:selected").text().trim();
            var currentSelectedVal  = typeDropdown.val();

            typeDropdown.empty();


            $.each(data, function (index, item) {
                typeDropdown.append($('<option>').val(item.RowId).text(item.Name));
            });


            if (currentSelectedVal) {
                typeDropdown.val(currentSelectedVal);
            } else if (currentSelectedText) {
                typeDropdown.find('option').filter(function () {
                    return $(this).text().trim() === currentSelectedText;
                }).prop('selected', true);
            }
            toggleNoOfFCL();


            typeDropdown.off('change').on('change', toggleNoOfFCL);

            function toggleNoOfFCL() {
                var selectedText = typeDropdown.find('option:selected').text().trim();
                if (selectedText === 'FCL') {
                    $('#No_of_FCL').prop('disabled', false);
                    $('#No_of_FCL').removeClass("readonly");
                    $('#No_of_FCL').css({ "filter": "none", "background-color": "" });
                    $('#No_of_FCL').closest('.form-group').find('span.required-star').show();
                } else {
                    $('#No_of_FCL').prop('disabled', true);
                    $('#No_of_FCL').addClass("readonly");
                    $('#No_of_FCL').css({ "filter": "grayscale(1)", "background-color": "#e9ecef" });
                    $('#No_of_FCL').closest('.form-group').find('span.required-star').hide();
                }
            }



        }
    });
}



    function calculateCfsGrandTotals() {
        let grandAmt = 0;
        let grandGst = 0;
        let grandTotal = 0;



        $('#CfschargesTable tbody tr').each(function () {

            //const amt = parseFloat($(this).find('.cfs_amtbeforegst').val().trim()) || 0;
            //const gst = parseFloat($(this).find('.cfs_gstAmount').val().trim()) || 0;
            //const total = parseFloat($(this).find('.cfs_total').val().trim()) || 0;

            //grandAmt += amt;
            //grandGst += gst;
            //grandTotal += total;
            const $row = $(this);

            const amtInput = $row.find('.cfs_amtbeforegst');
            const gstInput = $row.find('.cfs_gstAmount');
            const totalInput = $row.find('.cfs_total');

            if (amtInput.length && gstInput.length && totalInput.length) {
                const amt = parseFloat(amtInput.val()?.trim() || '0') || 0;
                const gst = parseFloat(gstInput.val()?.trim() || '0') || 0;
                const total = parseFloat(totalInput.val()?.trim() || '0') || 0;

                grandAmt += amt;
                grandGst += gst;
                grandTotal += total;
            }
        });


        $('#CFS_Amt_Before_GST').val(grandAmt.toFixed(2));
        $('#CFS_GST').val(grandGst.toFixed(2));
        $('#CFS_Total').val(grandTotal.toFixed(2));
    }
    $(document).on('input', '.cfs_amtbeforegst, .cfs_gstpercentage', function () {
s
        calculateCfsGrandTotals();
    });
            function InsertcfsOCDetails() {

  var invoice_no = $('#invoiceDropdown').val();
  var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';

  $.ajax({
      type: "POST",
      url: urlRequest1,
      data: { invNo: invoice_no },
      success: function (response) {

          if (response.exists) {



              var charges = [];
              var isValid = true;
              var missingFieldsMsg = "";

              $('#CfschargesTable tbody tr').each(function (index) {

                  var Nature_of_Service = ($(this).find('.cfs-nature_of_service').val() || "").trim();
                  var AmtBeforeGST = ($(this).find('.cfs_amtbeforegst').val() || "").trim();
                  var GstPercentage = ($(this).find('.cfs_gstpercentage').val() || "").trim();


                 /* let missing = [];

                  if (!Nature_of_Service) missing.push("Nature of Service");
                  if (!AmtBeforeGST) missing.push("Amt Before GST");
                  if (!GstPercentage) missing.push("Gst Percentage");
               */

               /*   if (missing.length > 0) {
                      isValid = false;
                      missingFieldsMsg += `⚠️ Row ${index + 1} is missing: ${missing.join(", ")}.\n`;
                  } else {*/
                      charges.push({
                          Nature_of_Service: $(this).find('.cfs-nature_of_service').val(),
                          AmtBeforeGST: $(this).find('.cfs_amtbeforegst').val(),
                          GstPercentage: $(this).find('.cfs_gstpercentage').val(),
                          GstAmount: $(this).find('.cfs_gstAmount').val(),
                          Total: $(this).find('.cfs_total').val(),
                          Cfs_RowId: $(this).find('.cfs_rowid').val()
                      });

              });


              var model = {
                  Invoice_No: invoice_no,
                  CFSOtherCharges: charges
              };

              var urlRequestCFS = '@Url.Action("GetDataUpdateCFSOtherCharges", "ExportTracker")';

              $.ajax({
                  url: urlRequestCFS,
                  type: 'POST',
                  contentType: 'application/json',
                  data: JSON.stringify(model),
                  success: function (data) {

                      if (data.Status === true)
                      {

                          alert(`✅ ${data.InsertedCount} Record Save  Successfully.`);
                       //   $('#invoiceDropdown,#Date1,#Division,#Mfr_Out,#Bill_to_Name,#Ship_to_Name,#Shipping_Bill_No,#Date2,#EPCG_Licence_No,#Currency,#Basic_Amt_Charges,#Sea_Freight_Air_Freight,#Insurarnce_charged,#Invoice_Value,#AirWay_BillNo_Bill_of_LodingNo,#AirWay_BillDate_Bill_of_LodingDate,#Clearing_Point,#Port_of_Loading,#Port_of_Discharge,#Mode,#Country,#Inco_Terms,#Payment_Terms,#Remarks ,#OC_Vendor,#OC_Invoice_No,#OC_InvDate,#OC_Particulars,#OC_Amt_Before_GST,#OC_GST, #OC_Total').val('');

                      } else {
                          alert('⚠️ Failed to save record.', + data.Message);
                      }
                  },
                  error: function (xhr, ret, e) {
                      alert('🚨 Error inserting record: ' + xhr.responseText);
                  }
              });

          } else {
              alert("❗Please insert the invoice details first before adding charges.");
          }
      },
      error: function () {
          alert("🚨 Error checking invoice record.");
      }
  });

    }
    $(document).on('input', '.cfs_amtbeforegst, .cfs_gstpercentage', function () {
        const rowElement = $(this).closest('tr');
        const amt = parseFloat(rowElement.find('.cfs_amtbeforegst').val()) || 0;
        const gstPercent = parseFloat(rowElement.find('.cfs_gstpercentage').val()) || 0;
        const gst = (amt * gstPercent) / 100;
        const total = amt + gst;

        rowElement.find('.cfs_gstAmount').val(gst.toFixed(2));
        rowElement.find('.cfs_total').val(total.toFixed(2));
    });
    function InsertOCDetails() {

    var invoice_no = $('#invoiceDropdown').val();
        var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';


    $.ajax({
        type: "POST",
        url: urlRequest1,
        data: { invNo: invoice_no },
        success: function (response) {

            if (response.exists) {



                var charges = [];
                var isValid = true;
                var missingFieldsMsg = "";

                let advPaymentOn = formatDateToShortDMY($('.oc-advpaymenton').val());
                let paymentDate = formatDateToShortDMY($('.oc-paymentdate').val());
                let BLadvPaymentOn ='';
                let BLpaymentDate = '';
                $('#chargesTable tbody tr').each(function (index) {

                    var vendor = ($(this).find('.oc-vendor').val() || "").trim();
                    var invNo = ($(this).find('.oc-invoice-no').val() || "").trim();
                    var invDate = ($(this).find('.oc-invdate').val() || "").trim();
                    var amtBeforeGst = ($(this).find('.oc-amt-before-gst').val().replace(/,/g, '') || "").trim();

                    let missing = [];

                    if (!vendor) missing.push("Vendor");
                    if (!invNo) missing.push("Invoice No");
                    if (!invDate) missing.push("Invoice Date");
                    if (!amtBeforeGst) missing.push("Amount Before GST");

                    if (missing.length > 0) {
                        isValid = false;
                        missingFieldsMsg += `⚠️ Row ${index + 1} is missing: ${missing.join(", ")}.\n`;
                    } else {
                        charges.push({
                            OC_Vendor: $(this).find('.oc-vendor').val(),
                            OC_Invoice_No: $(this).find('.oc-invoice-no').val(),
                            OC_InvDate: formatDateToShortDMY($(this).find('.oc-invdate').val()),
                            OC_BLAdvPaymenton: formatDateToShortDMY(BLadvPaymentOn),

                            OC_BLPaymentDate: formatDateToShortDMY(BLpaymentDate),
                            OCAdvPaymenton: formatDateToShortDMY(advPaymentOn),

                            OCPaymentDate: formatDateToShortDMY(paymentDate),
                            OC_Particulars: $(this).find('.oc-particulars').val(),
                            OC_Amt_Before_GST: $(this).find('.oc-amt-before-gst').val(),
                            OC_GSTPercentage: $(this).find('.oc-gstPercentage').val(),
                            OC_GSTAmount: $(this).find('.oc-gstAmount').val(),
                            OC_Total: $(this).find('.oc-total').val(),
                            OC_RowId: $(this).find('.oc-rowid').val()
                        });
                    }
                });

                if (!isValid) {
                    alert("❗ Please complete the required fields:\n\n" + missingFieldsMsg);
                    return;
                }

                var model = {
                    Invoice_No: invoice_no,
                    OtherCharges: charges
                };

                var urlRequestCFS = '@Url.Action("GetDataUpdateOtherCharges", "ExportTracker")';

                $.ajax({
                    url: urlRequestCFS,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(model),
                    success: function (data) {
                        if (data.Status === true)
                        {

                            alert(`✅ ${data.InsertedCount} Record Save  Successfully.`);

                            $('#logDiv').show();
                            $('#logotherEmployeeName').text('@Session["UserName"]');
                               const now = new Date();
                               const formattedDate = formatJSDate(now);
                            $('#otherChargesLogDate').text(formattedDate);
                            const panel = document.getElementById('OtherDetailsPanel');
                            if (panel) {
                                const heading = panel.querySelector('.panel-heading');
                                if (heading) {
                                    heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                }
                            }
                            //   $('#invoiceDropdown,#Date1,#Division,#Mfr_Out,#Bill_to_Name,#Ship_to_Name,#Shipping_Bill_No,#Date2,#EPCG_Licence_No,#Currency,#Basic_Amt_Charges,#Sea_Freight_Air_Freight,#Insurarnce_charged,#Invoice_Value,#AirWay_BillNo_Bill_of_LodingNo,#AirWay_BillDate_Bill_of_LodingDate,#Clearing_Point,#Port_of_Loading,#Port_of_Discharge,#Mode,#Country,#Inco_Terms,#Payment_Terms,#Remarks ,#OC_Vendor,#OC_Invoice_No,#OC_InvDate,#OC_Particulars,#OC_Amt_Before_GST,#OC_GST, #OC_Total').val('');

                        } else {
                            alert('⚠️ Failed to save record.', + data.Message);
                        }
                    },
                    error: function (xhr, ret, e) {
                        alert('🚨 Error inserting record: ' + xhr.responseText);
                    }
                });

            } else {
                alert("❗Please insert the invoice details first before adding charges.");
            }
        },
        error: function () {
            alert("🚨 Error checking invoice record.");
        }
    });

    }
    function InsertOCBLDetails() {
        
        var invoice_no = $('#invoiceDropdown').val();

        var finalsave = $('#hdnFinalSave').val() === "true";
        // Check if the button is disabled or not


        var urlRequest1 = '@Url.Action("CheckRecordExists", "ExportTracker")';

        var  FinalAmtbeforegst= parseFloat($('#td_amt_before_gst').text()) || 0;
        var FinalTotal = parseFloat($('#td_Total').text()) || 0;
        var Finalgstamount = parseFloat($('#td_GST').text()) || 0;
    $.ajax({
        type: "POST",
        url: urlRequest1,
        data: { invNo: invoice_no },
        success: function (response) {

            if (response.exists) {


                
                var charges = [];
                var isValid = true;
                var missingFieldsMsg = "";

                let advPaymentOn = '';
                let paymentDate = '';
                let BLadvPaymentOn = formatDateToShortDMY($('.oc-bladvpaymenton').val());
                let BLpaymentDate = formatDateToShortDMY($('.oc-blpaymentdate').val());
                $('#BLchargesTable tbody tr').each(function (index) {

                    var vendor = ($(this).find('.oc-BLvendor').val() || "").trim();
                    var invNo = ($(this).find('.oc-BLinvoice-no').val() || "").trim();
                    var invDate = ($(this).find('.oc-BLinvdate').val() || "").trim();
                   // var amtBeforeGst = ($(this).find('.oc-BLamt-before-gst').val().replace(/,/g, '') || "").trim();
                    var amtBeforeGst = ($(this).find('.oc-BLamt-before-gst').val() || "").toString().replace(/,/g, '').trim();

                    let missing = [];

                    if (!vendor) missing.push("Vendor");
                    if (!invNo) missing.push("Invoice No");
                    if (!invDate) missing.push("Invoice Date");
                    if (!amtBeforeGst) missing.push("Amount Before GST");

                    if (missing.length > 0) {
                        isValid = false;
                        missingFieldsMsg += `⚠️ Row ${index + 1} is missing: ${missing.join(", ")}.\n`;
                    } else {
                        charges.push({
                            OC_Vendor: $(this).find('.oc-BLvendor').val(),
                            OC_Invoice_No: $(this).find('.oc-BLinvoice-no').val(),
                            OC_InvDate: formatDateToShortDMY($(this).find('.oc-BLinvdate').val()),
                            OC_BLAdvPaymenton: formatDateToShortDMY(BLadvPaymentOn),

                            OC_BLPaymentDate: formatDateToShortDMY(BLpaymentDate),
                            OCAdvPaymenton: formatDateToShortDMY(advPaymentOn),

                            OCPaymentDate: formatDateToShortDMY(paymentDate),
                            OC_Particulars: $(this).find('.oc-BLparticulars').val(),
                            OC_Amt_Before_GST: $(this).find('.oc-BLamt-before-gst').val(),
                            OC_GSTPercentage: $(this).find('.oc-BLgstPercentage').val(),
                            OC_GSTAmount: $(this).find('.oc-BLgstAmount').val(),
                            OC_Total: $(this).find('.oc-BLtotal').val(),
                            OC_RowId: $(this).find('.oc-BLrowid').val()
                        });
                    }
                });

                if (!isValid) {
                    alert("❗ Please complete the required fields:\n\n" + missingFieldsMsg);
                    return;
                }

                var model = {
                    Invoice_No: invoice_no,
                    OtherCharges: charges,
                    "finalsave": finalsave,
                    "FinalAmtbeforegst": FinalAmtbeforegst,
                    "FinalTotal": FinalTotal,
                    "Finalgstamount": Finalgstamount,
                };

                var urlRequestCFS = '@Url.Action("GetDataUpdateOtherCharges", "ExportTracker")';

                $.ajax({
                    url: urlRequestCFS,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(model),
                    success: function (data) {
                        if (data.Status === true)
                        {

                            alert(`✅ ${data.InsertedCount} Record Save  Successfully.`);
                            if ((BLadvPaymentOn && BLadvPaymentOn.trim() !== '') ||
                                (BLpaymentDate && BLpaymentDate.trim() !== '')) {

                                $('#logOtherBLdiv').show();
                                $('#logotherBLEmployeeName').text('@Session["UserName"]');

                                const now = new Date();
                                const formattedDate = formatJSDate(now);
                                $('#otherBLChargesLogDate').text(formattedDate);

                                const panel = document.getElementById('OtherBLDetailsPanel');
                                if (panel) {
                                    const heading = panel.querySelector('.panel-heading');
                                    if (heading) {
                                        heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                    }
                                }
                            }

                            //   $('#invoiceDropdown,#Date1,#Division,#Mfr_Out,#Bill_to_Name,#Ship_to_Name,#Shipping_Bill_No,#Date2,#EPCG_Licence_No,#Currency,#Basic_Amt_Charges,#Sea_Freight_Air_Freight,#Insurarnce_charged,#Invoice_Value,#AirWay_BillNo_Bill_of_LodingNo,#AirWay_BillDate_Bill_of_LodingDate,#Clearing_Point,#Port_of_Loading,#Port_of_Discharge,#Mode,#Country,#Inco_Terms,#Payment_Terms,#Remarks ,#OC_Vendor,#OC_Invoice_No,#OC_InvDate,#OC_Particulars,#OC_Amt_Before_GST,#OC_GST, #OC_Total').val('');

                        } else {
                            alert('⚠️ Failed to save record.', + data.Message);
                        }
                    },
                    error: function (xhr, ret, e) {
                        alert('🚨 Error inserting record: ' + xhr.responseText);
                    }
                });

            } else {
                alert("❗Please insert the invoice details first before adding charges.");
            }
        },
        error: function () {
            alert("🚨 Error checking invoice record.");
        }
    });

    }
    function formatJSDate(dateObj) {
        let day = String(dateObj.getDate()).padStart(2, "0");
        let month = String(dateObj.getMonth() + 1).padStart(2, "0");
        let year = String(dateObj.getFullYear()).slice(-2);

        let hours24 = dateObj.getHours();
        let minutes = String(dateObj.getMinutes()).padStart(2, "0");

        let ampm = hours24 >= 12 ? "PM" : "AM";
        let hours12 = hours24 % 12 || 12;
        hours12 = String(hours12).padStart(2, "0");

        return `${day}/${month}/${year} ${hours12}:${minutes} ${ampm}`;
    }
    function insertInvoiceDetails() {
        var typeText = $('#Type option:selected').text();
        var noOfFCL = $('#No_of_FCL').val().trim();
        var mode = $('#Mode').val();
        if (!mode || mode.trim() === "") {
            $('#Type').prop('disabled', true);
            $('#Type').addClass("readonly");
            $('#Type').css({ "filter": "grayscale(1)", "background-color": "#e9ecef" });
        } else {
            $('#Type').prop('disabled', false);
            $('#Type').removeClass("readonly");
            $('#Type').css({ "filter": "none", "background-color": "" });
        }

        if (mode.toLowerCase() === "sea" || mode.toLowerCase() === "air") {
            $('#Type').prop('disabled', false);
        } else {
            $('#Type').prop('disabled', true);
        }
        if (!$('#Type').prop('disabled') && $('#Type') === "-- Select --") {
            alert("Please select at least one Type");
            return false;
        }
        if (typeText === "FCL") {

          if (noOfFCL === "" || noOfFCL === null) {
            alert("Please enter the value for No of FCL");
            return false;
           }
        }

    var model = {
        "Invoice_No": $('#invoiceDropdown').val(),
        "InvDate": $('#Date1').val(),
        "Division": $('#Division').val(),
        "Mfr_Out": $('#Mfr_Out').val(),
        "Bill_to_Name": $('#Bill_to_Name').val(),
        "Ship_to_Name": $('#Ship_to_Name').val(),
        "Shipping_Bill_No": $('#Shipping_Bill_No').val(),
        "Shipping_Bill_Date": $('#Date2').val(),
        "EPCG_Licence_No": $('#EPCG_Licence_No').val(),
        "Currency": $('#Currency').val(),
        "Basic_Amt_Charges": $('#Basic_Amt_Charges').val(),
        "Sea_Freight_Air_Freight": $('#Sea_Freight_Air_Freight').val(),
        "Insurarnce_charged": $('#Insurarnce_charged').val(),
        "Other_Charges": $('#Other_Charges').val(),
        "Invoice_Value": $('#Invoice_Value').val(),
        "AirWay_BillNo_Bill_of_LodingNo": $('#AirWay_BillNo_Bill_of_LodingNo').val(),
        "AirWay_BillDate_Bill_of_LodingDate": $('#AirWay_BillDate_Bill_of_LodingDate').val(),
        "Mode": $('#Mode').val(),
        "Country": $('#Country').val(),
        "Port_of_Discharge": $('#Port_of_Discharge').val(),
        "Port_of_Loading": $('#Port_of_Loading').val(),
        "Payment_Terms": $('#Payment_Terms').val(),
        "Due_Date": $('#Due_Date').val(),
        "Clearing_Point": $('#Clearing_Point').val(),
       /* "Clearing_Point": $('#Clearing_Point option:selected').Text(),*/
 /*       "Clearing_Point": $('#Clearing_Point').val(),*/
        "Inco_Terms": $('#Inco_Terms option:selected').text(),
        "Remarks": $('#Remarks').val(),
        "Weight": $('#Weight').val(),
        "Quntity_SQM": $('#Quntity_SQM').val(),
        "No_of_FCL": noOfFCL,
        "Type":typeText ,
    };

    var urlRequest = '@Url.Action("GetDataInsertdetails", "ExportTracker")';

    $.ajax({
        url: urlRequest,
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(model),
        success: function (data) {
            if (data.Status == true) {

                alert('🟢 Invoice Record Inserted Successfully.');
                $('#loginvDiv').show();
                $('#logEmployeeName').text('@Session["UserName"]');
                const now = new Date();
                const formattedDate = formatJSDate(now);
                $('#logDate').text(formattedDate);
                const panel = document.getElementById('InvoiceDetailsPanel');
                if (panel) {
                    const heading = panel.querySelector('.panel-heading');
                    if (heading) {
                        heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                    }
                }
                } else {
                alert('❌ Failed to insert invoice.');
            }
        },
        error: function (xhr) {
            alert('🚨 Error inserting invoice: ' + xhr.responseText);
        }
    });

}
    function calculateCharge(beforeGSTSelector, gstSelector, gstAmountSelector, totalSelector) {
        var amtBeforeGST = $(beforeGSTSelector).val() || '0';
        var percentage = parseFloat($(gstSelector).val()) || 0;

        var totalBeforeGST = parseFloat(amtBeforeGST.replace(/,/g, '')) || 0;
        var gstAmount = (totalBeforeGST * percentage) / 100;
        var totalWithGST = totalBeforeGST + gstAmount;

        $(gstAmountSelector).val(gstAmount.toFixed(2));
        $(totalSelector).val(totalWithGST.toFixed(2));
        if (beforeGSTSelector == "#FCSDry_Port_charges") {
            console.log(totalBeforeGST);
            console.log(gstAmount);
            console.log(totalWithGST);
        }
        return { totalBeforeGST, gstAmount, totalWithGST };
    }
    function calculateGSTAndTotal() {

        var CCClearance_agency_charges = calculateCharge('#CCClearance_agency_charges', '#CCClearance_Agency_chargesGST', '#CCClearance_Agency_chargesGSTAmount', '#CCClearance_Agency_charges_Total');
        var CCEDI_Xeam_charges = calculateCharge('#CCEDI_Xeam_charges', '#CCEdi_Xeam_ChargesGST', '#CCEdi_Xeam_ChargesGSTAmount', '#CCEdi_Xeam_Charges_Total');
        var CCVGM = calculateCharge('#CCVGM', '#CCVGMGST', '#CCVGMGSTAmount', '#CCVGM_Total');
        var CCGSEC = calculateCharge('#CCGSEC', '#CCGSECGST', '#CCGSECGSTAmount', '#CCGSEC_Total');
        var CCCOO = calculateCharge('#CCCOO', '#CCCOOGST', '#CCCOOGSTAmount', '#CCCOO_Total');
        var CCExamination_CFS = calculateCharge('#CCExamination_CFS', '#CCExamination_CFSGST', '#CCExamination_CFSGSTAmount', '#CCExamination_CFS_Total');
        var CCLift_on_Lift_off = calculateCharge('#CCLift_on_Lift_off', '#CCLift_on_Lift_offGST', '#CCLift_on_Lift_offGSTAmount', '#CCLift_on_Lift_off_Total');
        var CCCFS = calculateCharge('#CCCFS', '#CCCFSGST', '#CCCFSGSTAmount', '#CCCFSTotal');
        var CCOthers = calculateCharge('#CCOthers', '#CCOthersGST', '#CCOthersGSTAmount', '#CCOthers_Total');




        var totalBeforeGSTClerance = CCClearance_agency_charges.totalBeforeGST + CCEDI_Xeam_charges.totalBeforeGST + CCVGM.totalBeforeGST + CCGSEC.totalBeforeGST + CCCOO.totalBeforeGST +
            CCExamination_CFS.totalBeforeGST + CCLift_on_Lift_off.totalBeforeGST + CCCFS.totalBeforeGST + CCOthers.totalBeforeGST;

        var Clerancegst = CCClearance_agency_charges.gstAmount + CCEDI_Xeam_charges.gstAmount + CCVGM.gstAmount + CCGSEC.gstAmount + CCCOO.gstAmount + CCExamination_CFS.gstAmount
            + CCLift_on_Lift_off.gstAmount + CCCFS.gstAmount +  CCOthers.gstAmount;

        var totalWithGSTClerance = CCClearance_agency_charges.totalWithGST +CCEDI_Xeam_charges.totalWithGST +CCVGM.totalWithGST +CCGSEC.totalWithGST +CCCOO.totalWithGST +
            CCExamination_CFS.totalWithGST + CCLift_on_Lift_off.totalWithGST + CCCFS.totalWithGST+CCOthers.totalWithGST;

        $('#CCAmt_Before_GST').val(totalBeforeGSTClerance.toFixed(2));
        $('#CCGST').val(Clerancegst.toFixed(2));
        $('#CC_total').val(totalWithGSTClerance.toFixed(2));


        var FCSFreight = calculateCharge('#FCSFreight', '#FCSFreight_GST', '#FCSFreight_GSTAmount', '#FCSFreight_Total');
        var FCSTHC = calculateCharge('#FCSTHC', '#FCSTHC_GST', '#FCSTHC_GSTAmount', '#FCSTHC_Total');
        var FCSBL = calculateCharge('#FCSBL', '#FCSBL_GST', '#FCSBL_GSTAmount', '#FCSBL_Total');
        var FCSAMS = calculateCharge('#FCSSeal', '#FCSSEAL_GST', '#FCSSEAL_GSTAmount', '#FCSSEAL_Total');
        var FCSVGM = calculateCharge('#FCSVGM', '#FCSVGM_GST', '#FCSVGM_GSTAmount', '#FCSVGM_Total');
        var FCSMUC = calculateCharge('#FCSMUC', '#FCSMUC_GST', '#FCSMUC_GSTAmount', '#FCSMUC_Total');
        var FCSITHC = calculateCharge('#FCSITHC', '#FCSITHC_GST', '#FCSITHC_GSTAmount', '#FCSITHC_Total');
        var Dry_Port_charges = calculateCharge('#FCSDry_Port_charges', '#FCSDry_Port_charges_GST', '#FCSDry_Port_charges_GSTAmount', '#FCSDry_Port_charges_Total');
        console.log(Dry_Port_charges);
        var FCSAdministrative_charges = calculateCharge('#FCSAdministrative_charges', '#FCSAdministrative_charges_GST', '#FCSAdministrative_charges_GSTAmount', '#FCSAdministrative_charges_Total');
        var FCSSecurity_filling_fees = calculateCharge('#FCSSecurity_filling_fees', '#FCSSecurity_filling_fees_GST', '#FCSSecurity_filling_fees_GSTAmount', '#FCSSecurity_filling_fees_Total');
        var FCSOther = calculateCharge('#FCSOther', '#FCSOther_GST', '#FCSOther_GSTAmount', '#FCSOther_Total');

        var totalBeforeGSTFCS = FCSFreight.totalBeforeGST + FCSTHC.totalBeforeGST + FCSBL.totalBeforeGST + FCSAMS.totalBeforeGST + FCSVGM.totalBeforeGST + FCSMUC.totalBeforeGST +
            FCSITHC.totalBeforeGST + FCSAdministrative_charges.totalBeforeGST + FCSSecurity_filling_fees.totalBeforeGST + FCSOther.totalBeforeGST+
            Dry_Port_charges.totalBeforeGST;

        var totalGSTFCS = FCSFreight.gstAmount + FCSTHC.gstAmount + FCSBL.gstAmount + FCSAMS.gstAmount + FCSVGM.gstAmount + FCSMUC.gstAmount + FCSITHC.gstAmount +
            Dry_Port_charges.gstAmount + FCSAdministrative_charges.gstAmount + FCSSecurity_filling_fees.gstAmount + FCSOther.gstAmount;

        var totalWithGSTFCS = FCSFreight.totalWithGST + FCSTHC.totalWithGST + FCSBL.totalWithGST + FCSAMS.totalWithGST + FCSVGM.totalWithGST + FCSMUC.totalWithGST + FCSITHC.totalWithGST +
            Dry_Port_charges.totalWithGST + FCSAdministrative_charges.totalWithGST + FCSSecurity_filling_fees.totalWithGST + FCSOther.totalWithGST;




        $('#FCSAmt_Before_GST').val(totalBeforeGSTFCS.toFixed(2));
        $('#FCSGST').val(totalGSTFCS.toFixed(2));
        $('#FCSTotal').val(totalWithGSTFCS.toFixed(2));
        var airFreight = calculateCharge('#FCAAir_Freight', '#FCAAir_Freight_GST', '#FCAAir_Freight_GSTAmount', '#FCAAir_Freight_Total');

        var mcc = calculateCharge('#FCAMCC', '#FCAMCC_GST', '#FCAMCC_GSTAmount', '#FCAMCC_Total');

        var xray = calculateCharge('#FCAX_Ray', '#FCAX_Ray_GST', '#FCAX_Ray_GSTAmount', '#FCAX_Ray_Total');


        var mycFuel = calculateCharge('#FCAMYC_Fuel', '#FCAMYC_Fuel_GST', '#FCAMYC_Fuel_GSTAmount', '#FCAMYC_Fuel_Total');

        var ams = calculateCharge('#FCAAMS', '#FCAAMS_GST', '#FCAAMS_GSTAmount', '#FCAAMS_Total');



        var awb = calculateCharge('#FCAAWB', '#FCAAWB_GST', '#FCAAWB_GSTAmount', '#FCAAWB_Total');


        var pca = calculateCharge('#FCAPCA', '#FCAPCA_GST', '#FCAPCA_GSTAmount', '#FCAPCA_Total');


        var others = calculateCharge('#FCAOthers', '#FCAOthers_GST', '#FCAOthers_GSTAmount', '#FCAOthers_Total');


        var totalBeforeGSTFCA =
            airFreight.totalBeforeGST +
            mcc.totalBeforeGST +
            xray.totalBeforeGST +
            mycFuel.totalBeforeGST +
            ams.totalBeforeGST +

            awb.totalBeforeGST +
            pca.totalBeforeGST +
            others.totalBeforeGST;

        var totalGSTFCA =
            airFreight.gstAmount +
            mcc.gstAmount +
            xray.gstAmount +
            mycFuel.gstAmount +

            ams.gstAmount +
            awb.gstAmount +
            pca.gstAmount +
            others.gstAmount;

        var totalWithGSTFCA =
            airFreight.totalWithGST +
            mcc.totalWithGST +
            xray.totalWithGST +
            mycFuel.totalWithGST +

            ams.totalWithGST +
            awb.totalWithGST +
            pca.totalWithGST +
            others.totalWithGST;

        $('#FCAAMT_before_GST').val(totalBeforeGSTFCA.toFixed(2));
        $('#FCAGST').val(totalGSTFCA.toFixed(2));
        $('#FCATotal').val(totalWithGSTFCA.toFixed(2));



        var TC_Charges = calculateCharge('#TC_Charges', '#TCChargesGST', '#TCChargesGSTAmount', '#TCCharges_Total');
        var TC_VGM = calculateCharge('#TC_VGM', '#TCVGMGST', '#TCVGMGSTAmount', '#TCVGM_Total');
        var TC_Other = calculateCharge('#TC_Other', '#TCOtherGST', '#TCOtherGSTAmount', '#TCOther_Total');

        var totalBeforeGST_TC = TC_Charges.totalBeforeGST + TC_VGM.totalBeforeGST + TC_Other.totalBeforeGST;
        var totalGST_TC = TC_Charges.gstAmount + TC_VGM.gstAmount + TC_Other.gstAmount;
        var totalWithGST_TC = TC_Charges.totalWithGST + TC_VGM.totalWithGST + TC_Other.totalWithGST;

        $('#TC_AMT_Before_GST').val(totalBeforeGST_TC.toFixed(2));
        $('#TC_GST').val(totalGST_TC.toFixed(2));
        $('#TC_Total').val(totalWithGST_TC.toFixed(2));

        var AddTC_Charges = calculateCharge('#AddTC_Charges', '#AddTCChargesGST', '#AddTCChargesGSTAmount', '#AddTCCharges_Total');
        var AddTC_VGM = calculateCharge('#AddTC_VGM', '#AddTCVGMGST', '#AddTCVGMGSTAmount', '#AddTCVGM_Total');
        var AddTC_Other = calculateCharge('#AddTC_Other', '#AddTCOtherGST', '#AddTCOtherGSTAmount', '#AddTCOther_Total');

        var totalBeforeGST_AddTC = AddTC_Charges.totalBeforeGST + AddTC_VGM.totalBeforeGST + AddTC_Other.totalBeforeGST;
        var totalGST_AddTC = AddTC_Charges.gstAmount + AddTC_VGM.gstAmount + AddTC_Other.gstAmount;
        var totalWithGST_AddTC = AddTC_Charges.totalWithGST + AddTC_VGM.totalWithGST + AddTC_Other.totalWithGST;

        $('#AddTC_AMT_Before_GST').val(totalBeforeGST_AddTC.toFixed(2));
        $('#AddTC_GST').val(totalGST_AddTC.toFixed(2));
        $('#AddTC_Total').val(totalWithGST_AddTC.toFixed(2));



        var COOCbeforeGST = 0;
        var cooAmtBeforeGST = $('#COO_Amt_Before_GST').val() || '0';
        COOCbeforeGST += parseFloat(cooAmtBeforeGST.replace(/,/g, '')) || 0;
        var percentagecoo = parseFloat($('#COOGSTPercentage').val()) || 0;

        var gstamount = (COOCbeforeGST * percentagecoo) / 100;
        var totalWithGSTCOO = COOCbeforeGST + gstamount;

        $('#COO_GST').val(gstamount.toFixed(2));
        $('#COO_Total').val(totalWithGSTCOO.toFixed(2));
        console.log(gstamount);
        console.log(totalWithGSTCOO);
        var EIACbeforeGST = 0;
        var EIAAmtBeforeGST = $('#EIA_Amt_Before_GST').val() || '0';
       EIACbeforeGST += parseFloat(EIAAmtBeforeGST.replace(/,/g, '')) || 0;
        var percentageEIA = parseFloat($('#EIAGSTPercentage').val()) || 0;

        var gstamountEIA = (EIACbeforeGST * percentageEIA) / 100;
        var totalWithGSTEIA = EIACbeforeGST + gstamountEIA;

        $('#EIA_GST').val(gstamountEIA.toFixed(2));
        $('#EIA_Total').val(totalWithGSTEIA.toFixed(2));

        totalBeforeGSTOC = 0;
        var ocAmtBeforeGST = $('#OC_Amt_Before_GST').val() || '0';
        totalBeforeGSTOC += parseFloat(ocAmtBeforeGST.replace(/,/g, '')) || 0;

        var percentage = parseFloat($('#OC_GSTPercentage').val()) || 0;


        var gst7 = (totalBeforeGSTOC * percentage) / 100;

        var totalWithGSTOC = totalBeforeGSTOC + gst7;


        $('#OC_GSTAmount').val(gst7.toFixed(2));
        $('#OC_Total').val(totalWithGSTOC.toFixed(2));

    }
    function formatDateToShortDMY(dateString) {
        if (!dateString) return '';

        const parts = dateString.split('/');
        if (parts.length !== 3) return '';

        const day = String(parseInt(parts[0], 10)).padStart(2, '0');
        const month = String(parseInt(parts[1], 10)).padStart(2, '0');
        const year = parts[2].length === 4 ? parts[2].slice(-2) : parts[2];

        return `${day}/${month}/${year}`;
    }
    function parseNetDate(netDateString) {
        if (!netDateString) return "";

        // Extract the number between /Date( and )/
        const timestampMatch = /\/Date\((\d+)\)\//.exec(netDateString);
        if (!timestampMatch) return "";

        const timestamp = parseInt(timestampMatch[1], 10);
        const dateObj = new Date(timestamp);

        // Format date (DD/MM/YY HH:MM AM/PM)
        let day = String(dateObj.getDate()).padStart(2, "0");
        let month = String(dateObj.getMonth() + 1).padStart(2, "0");
        let year = String(dateObj.getFullYear()).slice(-2);

        let hours24 = dateObj.getHours();
        let minutes = String(dateObj.getMinutes()).padStart(2, "0");

        let ampm = hours24 >= 12 ? "PM" : "AM";
        let hours12 = hours24 % 12 || 12;
        hours12 = String(hours12).padStart(2, "0");

        return `${day}/${month}/${year} ${hours12}:${minutes} ${ampm}`;
    }
    function resetAllPanelColors() {
        $('.panel-heading').css({
            'background': 'linear-gradient(to right, #032962, #24aff1)'
        });
    }
    function loadInvoiceDetails(invoiceNo) {

        $('#loadingSpinner').show();
        var urlRequest = '@Url.Action("GetpanelExportForList", "Common")';

        $.ajax({
            url: urlRequest,
            type: 'GET',
            data: { invoiceNo: invoiceNo },
            success: function (data) {


                if (data.length > 0) {
                    //reset color in all panel.
                    resetAllPanelColors();
                    let d = data[0];
                    

                    let LogArray = (d.ExporttrackerLogDetails && Array.isArray(d.ExporttrackerLogDetails)) ? d.ExporttrackerLogDetails : [];
                    const sectionDivMap = {
                        "OtherCharges": "#logDiv",
                        "OtherCharges": "#logDiv",
                        "EIA": "#EIADIV",
                        "Invoice": "#loginvDiv",
                        "Clearance": "#cleardiv",
                        "FCS": "#forwerdiv",
                        "FCA": "#forwerdiv",
                        "Transport": "#transdiv",
                        "CFS": "#CFSvDiv",
                        "AddTransport": "#AddTransportdiv",
                        "COO": "#COO",
                        "Document": "#DocumentDiv",
                        "BLCharges": "#logOtherBLdiv",
                        "Finalsave": "#FinalsaveDiv"
                    };
                    Object.values(sectionDivMap).forEach(divId => $(divId).hide());

                    if (LogArray.length > 0) {



                        const sectionMap = {
                            "Invoice": { dateId: "logDate", empSpan: "logEmployeeName", panel: "InvoiceDetailsPanel" },
                            "Clearance": { dateId: "clearanceLogDate", empSpan: "logccEmployeeName", panel: "ClearanceDetailsPanel" },
                            "FCS": { dateId: "fcLogDate", empSpan: "logForEmployeeName", panel: "forwerderDetailsPanel" },
                            "FCA": { dateId: "fcLogDate", empSpan: "logForEmployeeName", panel: "forwerderDetailsPanel" },
                            "Transport": { dateId: "transportLogDate", empSpan: "logTraEmployeeName", panel: "TransporterDetailsPanel" },
                            "CFS": { dateId: "cfsLogDate", empSpan: "logCFSEmployeeName", panel: "cfsChargesPanel" },
                            "AddTransport": { dateId: "addTransportLogDate", empSpan: "logaddtraEmployeeName", panel: "addtransporter" },
                            "COO": { dateId: "cooLogDate", empSpan: "logcooEmployeeName", panel: "COODetailsPanel" },
                            "EIA": { dateId: "eiaLogDate", empSpan: "logeiaEmployeeName", panel: "EIADetailsPanel" },
                            "OtherCharges": { dateId: "otherChargesLogDate", empSpan: "logotherEmployeeName", panel: "OtherDetailsPanel" },
                            "Document": { dateId: "documentLogDate", empSpan: "logdocEmployeeName", panel: "DocumentDetailsPanel" },
                            "BLCharges": { dateId: "otherBLChargesLogDate", empSpan: "logotherBLEmployeeName", panel: "OtherBLDetailsPanel" },
                            "Finalsave": { dateId: "FianlsaveLogDate", empSpan: "logFinalsaveEmployeeName", panel: "FinalsavePanel" }
                        };


                        LogArray.forEach(log => {
                            const divSelector = sectionDivMap[log.SectionName];
                            const formattedDate = parseNetDate(log.LogDate);
                            if (divSelector && formattedDate) {
                                $(divSelector).show();

                            const map = sectionMap[log.SectionName];
                            if (map) {


                                const dateElement = document.getElementById(map.dateId);
                                if (dateElement) dateElement.textContent = formattedDate;

                                const empElement = document.getElementById(map.empSpan);
                                if (empElement) empElement.textContent = log.EmployeeName || "";


                                    const panel = document.getElementById(map.panel);
                                    if (panel) {
                                        const heading = panel.querySelector('.panel-heading');
                                        if (heading) heading.style.background = 'linear-gradient(to right, #11451f, #327845)';
                                    }
                                    //if (log.SectionName === "OtherCharges") {
                                    //    $('#logDiv').show();
                                    //} else if (log.SectionName === "EIA") {
                                    //    $('#eiadiv').show();
                                    //} else if (log.SectionName === "Invoice") {
                                    //    $('#loginvDiv').show();
                                    //} else if (log.SectionName === "Clearance") {
                                    //    $('#cleardiv').show();
                                    //} else if (log.SectionName === "FCS") {
                                    //    $('#forwerdiv').show();
                                    //} else if (log.SectionName === "FCA") {
                                    //    $('#forwerdiv').show();
                                    //} else if (log.SectionName === "Clearance") {
                                    //    $('#cleardiv').show();
                                    //} else if (log.SectionName === "Transport") {
                                    //    $('#transdiv').show();
                                    //} else if (log.SectionName === "CFS") {
                                    //    $('#CFSvDiv').show();
                                    //} else if (log.SectionName === "AddTransport") {
                                    //    $('AddTransportdiv').show();
                                    //} else if (log.SectionName === "COO") {
                                    //    $('#COO').show();
                                    //} else if (log.SectionName === "Document") {
                                    //    ('#DocumentDiv').show();
                                    //} else {
                                    //    console.log("no data updated");
                                    //}
                                }
                            }
                        });
                    }


                    $('#Date1').val(d.InvDate);
                    $('#Division').val(d.Division);
                    $('#Mfr_Out').val(d.Mfr_Out);
                    $('#Bill_to_Name').val(d.Bill_to_Name);
                    $('#Ship_to_Name').val(d.Ship_to_Name);
                    $('#Shipping_Bill_No').val(d.Shipping_Bill_No);
                    $('#Date2').val(d.Shipping_Bill_Date);
                    $('#Currency').val(d.Currency);
                    function formatAmount(val) {
                        return (val && parseFloat(val) !== 0) ? parseFloat(val).toFixed(2) : "0.00";
                    }

                    $('#Basic_Amt_Charges').val(formatAmount(d.Basic_Amt_Charges));
                    $('#Sea_Freight_Air_Freight').val(formatAmount(d.Sea_Freight_Air_Freight));
                    $('#Insurarnce_charged').val(formatAmount(d.Insurarnce_charged));
                    $('#Other_Charges').val(formatAmount(d.Other_Charges));
                    $('#Invoice_Value').val(formatAmount(d.Invoice_Value));

                    $('#Mode').val(d.Mode);




                    $('#Country').val(d.Country);
                    $('#Port_of_Discharge').val(d.Port_of_Discharge);
                    $('#Payment_Terms').val(d.Payment_Terms);
                    $('#Due_Date').val(d.Due_Date);
                    $('#Remarks').val(d.Remarks);
                    $("#Inco_Terms option").filter(function () {
                        return $(this).text() === d.Inco_Terms;
                    }).prop("selected", true);
                    $('#AirWay_BillNo_Bill_of_LodingNo').val(d.AirWay_BillNo_Bill_of_LodingNo);
                    $('#AirWay_BillDate_Bill_of_LodingDate').val(d.AirWay_BillDate_Bill_of_LodingDate);
                    $('#Port_of_Loading').val(d.Port_of_Loading);
                    $("#Clearing_Point option").filter(function () {
                        return $(this).text() === d.Clearing_Point;
                    }).prop("selected", true);

                    $('#EPCG_Licence_No').val(d.EPCG_Licence_No);
                    $('#CCClearance_Agent_Name').val(d.CCClearance_Agent_Name);
                    $('#CCInvoice_No').val(d.CCInvoice_No);
                    $('#Date3').val(d.CCInvDate);
                    $('#CCClearance_agency_charges').val(d.CCClearance_agency_charges);
                    $('#CCClearance_Agency_chargesGST').val(d.CCClearance_Agency_chargesGST);
                    $('#CCClearance_Agency_chargesGSTAmount').val(d.CCClearance_Agency_chargesGSTAmount);
                    $('#CCClearance_Agency_charges_Total').val(d.CCClearance_Agency_charges_Total);

                    $('#CCEDI_Xeam_charges').val(d.CCEDI_Xeam_charges);
                    $('#CCEdi_Xeam_ChargesGST').val(d.CCEdi_Xeam_ChargesGST);
                    $('#CCEdi_Xeam_ChargesGSTAmount').val(d.CCEdi_Xeam_ChargesGSTAmount);
                    $('#CCEdi_Xeam_Charges_Total').val(d.CCEdi_Xeam_Charges_Total);

                    $('#CCVGM').val(d.CCVGM);
                    $('#CCVGMGST').val(d.CCVGMGST);
                    $('#CCVGMGSTAmount').val(d.CCVGMGSTAmount);
                    $('#CCVGM_Total').val(d.CCVGM_Total);

                    $('#CCGSEC').val(d.CCGSEC);
                    $('#CCGSECGST').val(d.CCGSECGST);
                    $('#CCGSECGSTAmount').val(d.CCGSECGSTAmount);
                    $('#CCGSEC_Total').val(d.CCGSEC_Total);

                    $('#CCCOO').val(d.CCCOO);
                    $('#CCCOOGST').val(d.CCCOOGST);
                    $('#CCCOOGSTAmount').val(d.CCCOOGSTAmount);
                    $('#CCCOO_Total').val(d.CCCOO_Total);

                    $('#CCExamination_CFS').val(d.CCExamination_CFS);
                    $('#CCExamination_CFSGST').val(d.CCExamination_CFSGST);
                    $('#CCExamination_CFSGSTAmount').val(d.CCExamination_CFSGSTAmount);
                    $('#CCExamination_CFS_Total').val(d.CCExamination_CFS_Total);

                    $('#CCLift_on_Lift_off').val(d.CCLift_on_Lift_off);
                    $('#CCLift_on_Lift_offGST').val(d.CCLift_on_Lift_offGST);
                    $('#CCLift_on_Lift_offGSTAmount').val(d.CCLift_on_Lift_offGSTAmount);
                    $('#CCLift_on_Lift_off_Total').val(d.CCLift_on_Lift_off_Total);

                    $('#CCCFS').val(d.CCCFS);
                    $('#CCCFSGST').val(d.CCCFSGST);
                    $('#CCCFSGSTAmount').val(d.CCCFSGSTAmount);
                    $('#CCCFSTotal').val(d.CCCFSTotal);

                    $('#CCOthers').val(d.CCOthers);
                    $('#CCOthersGST').val(d.CCOthersGST);
                    $('#CCOthersGSTAmount').val(d.CCOthersGSTAmount);
                    $('#CCOthers_Total').val(d.CCOthers_Total);
                    $('#CCAmt_Before_GST').val(d.CCAmt_Before_GST);
                    $('#CCGST').val(d.CCGST);
                    $('#CC_total').val(d.CC_total);

                    // ================= FCS =================
                    // ================= FCS =================
                    $('#FCForwarder').val(d.FCForwarder);
                    $('#FCInvoice_No').val(d.FCInvoice_No);
                    $('#FCInvDate').val(d.FCInvDate);
                    $('#AdvPaymenton').val(d.AdvPaymenton);
                    $('#PaymentDate').val(d.PaymentDate);
                    $('#FCSFreight').val(d.FCSFreight);
                    $('#FCSFreight_GST').val(d.FCSFreight_GST);
                    $('#FCSFreight_GSTAmount').val(d.FCSFreight_GSTAmount);
                    $('#FCSFreight_Total').val(d.FCSFreight_Total);

                    $('#FCSTHC').val(d.FCSTHC);
                    $('#FCSTHC_GST').val(d.FCSTHC_GST);
                    $('#FCSTHC_GSTAmount').val(d.FCSTHC_GSTAmount);
                    $('#FCSTHC_Total').val(d.FCSTHC_Total);

                    $('#FCSBL').val(d.FCSBL);
                    $('#FCSBL_GST').val(d.FCSBL_GST);
                    $('#FCSBL_GSTAmount').val(d.FCSBL_GSTAmount);
                    $('#FCSBL_Total').val(d.FCSBL_Total);

                    $('#FCSSeal').val(d.FCSSeal);
                    $('#FCSSEAL_GST').val(d.FCSSEAL_GST);
                    $('#FCSSEAL_GSTAmount').val(d.FCSSEAL_GSTAmount);
                    $('#FCSSEAL_Total').val(d.FCSSEAL_Total);

                    $('#FCSVGM').val(d.FCSVGM);
                    $('#FCSVGM_GST').val(d.FCSVGM_GST);
                    $('#FCSVGM_GSTAmount').val(d.FCSVGM_GSTAmount);
                    $('#FCSVGM_Total').val(d.FCSVGM_Total);

                    $('#FCSMUC').val(d.FCSMUC);
                    $('#FCSMUC_GST').val(d.FCSMUC_GST);
                    $('#FCSMUC_GSTAmount').val(d.FCSMUC_GSTAmount);
                    $('#FCSMUC_Total').val(d.FCSMUC_Total);

                    $('#FCSITHC').val(d.FCSITHC);
                    $('#FCSITHC_GST').val(d.FCSITHC_GST);
                    $('#FCSITHC_GSTAmount').val(d.FCSITHC_GSTAmount);
                    $('#FCSITHC_Total').val(d.FCSITHC_Total);

                    $('#FCSDry_Port_charges').val(d.FCSDry_Port_charges);
                    $('#FCSDry_Port_charges_GST').val(d.FCSDry_Port_charges_GST);
                    $('#FCSDry_Port_charges_GSTAmount').val(d.FCSDry_Port_charges_GSTAmount);
                    $('#FCSDry_Port_charges_Total').val(d.FCSDry_Port_charges_Total);

                    $('#FCSAdministrative_charges').val(d.FCSAdministrative_charges);
                    $('#FCSAdministrative_charges_GST').val(d.FCSAdministrative_charges_GST);
                    $('#FCSAdministrative_charges_GSTAmount').val(d.FCSAdministrative_charges_GSTAmount);
                    $('#FCSAdministrative_charges_Total').val(d.FCSAdministrative_charges_Total);

                    $('#FCSSecurity_filling_fees').val(d.FCSSecurity_filling_fees);
                    $('#FCSSecurity_filling_fees_GST').val(d.FCSSecurity_filling_fees_GST);
                    $('#FCSSecurity_filling_fees_GSTAmount').val(d.FCSSecurity_filling_fees_GSTAmount);
                    $('#FCSSecurity_filling_fees_Total').val(d.FCSSecurity_filling_fees_Total);

                    $('#FCSOther').val(d.FCSOther);
                    $('#FCSOther_GST').val(d.FCSOther_GST);
                    $('#FCSOther_GSTAmount').val(d.FCSOther_GSTAmount);
                    $('#FCSOther_Total').val(d.FCSOther_Total);

                    $('#FCSAmt_Before_GST').val(d.FCSAmt_Before_GST);
                    $('#FCSGST').val(d.FCSGST);
                    $('#FCSTotal').val(d.FCSTotal);

                    // ================= FCA =================
                    $('#FCAAir_Freight').val(d.FCAAir_Freight);
                    $('#FCAAir_Freight_GST').val(d.FCAAir_Freight_GST);
                    $('#FCAAir_Freight_GSTAmount').val(d.FCAAir_Freight_GSTAmount);
                    $('#FCAAir_Freight_Total').val(d.FCAAir_Freight_Total);

                    $('#FCAMCC').val(d.FCAMCC);
                    $('#FCAMCC_GST').val(d.FCAMCC_GST);
                    $('#FCAMCC_GSTAmount').val(d.FCAMCC_GSTAmount);
                    $('#FCAMCC_Total').val(d.FCAMCC_Total);

                    $('#FCAX_Ray').val(d.FCAX_Ray);
                    $('#FCAX_Ray_GST').val(d.FCAX_Ray_GST);
                    $('#FCAX_Ray_GSTAmount').val(d.FCAX_Ray_GSTAmount);
                    $('#FCAX_Ray_Total').val(d.FCAX_Ray_Total);

                    $('#FCAMYC_Fuel').val(d.FCAMYC_Fuel);
                    $('#FCAMYC_Fuel_GST').val(d.FCAMYC_Fuel_GST);
                    $('#FCAMYC_Fuel_GSTAmount').val(d.FCAMYC_Fuel_GSTAmount);
                    $('#FCAMYC_Fuel_Total').val(d.FCAMYC_Fuel_Total);

                    $('#FCAAMS').val(d.FCAAMS);
                    $('#FCAAMS_GST').val(d.FCAAMS_GST);
                    $('#FCAAMS_GSTAmount').val(d.FCAAMS_GSTAmount);
                    $('#FCAAMS_Total').val(d.FCAAMS_Total);

                    $('#FCAAWB').val(d.FCAAWB);
                    $('#FCAAWB_GST').val(d.FCAAWB_GST);
                    $('#FCAAWB_GSTAmount').val(d.FCAAWB_GSTAmount);
                    $('#FCAAWB_Total').val(d.FCAAWB_Total);

                    $('#FCAPCA').val(d.FCAPCA);
                    $('#FCAPCA_GST').val(d.FCAPCA_GST);
                    $('#FCAPCA_GSTAmount').val(d.FCAPCA_GSTAmount);
                    $('#FCAPCA_Total').val(d.FCAPCA_Total);

                    $('#FCAOthers').val(d.FCAOthers);
                    $('#FCAOthers_GST').val(d.FCAOthers_GST);
                    $('#FCAOthers_GSTAmount').val(d.FCAOthers_GSTAmount);
                    $('#FCAOthers_Total').val(d.FCAOthers_Total);

                    $('#FCAAMT_before_GST').val(d.FCAAMT_before_GST);
                    $('#FCAGST').val(d.FCAGST);
                    $('#FCATotal').val(d.FCATotal);

                    // ================= TC =================
                    $('#TC_Transporter').val(d.TC_Transporter);
                    $('#TC_Invoice_No').val(d.TC_Invoice_No);
                    $('#TC_InvDate').val(d.TC_InvDate);
                    $('#TC_Charges').val(d.TC_Charges);
                    $('#TCChargesGST').val(d.TCChargesGST);
                    $('#TCChargesGSTAmount').val(d.TCChargesGSTAmount);
                    $('#TCCharges_Total').val(d.TCCharges_Total);

                    $('#TC_VGM').val(d.TC_VGM);
                    $('#TCVGMGST').val(d.TCVGMGST);
                    $('#TCVGMGSTAmount').val(d.TCVGMGSTAmount);
                    $('#TCVGM_Total').val(d.TCVGM_Total);

                    $('#TC_Other').val(d.TC_Other);
                    $('#TCOtherGST').val(d.TCOtherGST);
                    $('#TCOtherGSTAmount').val(d.TCOtherGSTAmount);
                    $('#TCOther_Total').val(d.TCOther_Total);
                    $('#TC_AMT_Before_GST').val(d.TC_AMT_Before_GST);
                    $('#TC_GST').val(d.TC_GST);
                    $('#TC_Total').val(d.TC_Total);

                    // ================= CFS =================
                    $('#CFS_Vendor').val(d.CFS_Vendor);
                    $('#CFS_Invoice_No').val(d.CFS_Invoice_No);
                    $('#CFS_InvDate').val(d.CFS_InvDate);
                    $('#CFS_Particulars').val(d.CFS_Particulars);
                    $('#CFS_Amt_Before_GST').val(d.CFS_Amt_Before_GST);
                    $('#CFS_GST').val(d.CFS_GST);
                    $('#CFS_Total').val(d.CFS_Total);

                    // ================= AddTC =================
                    $('#AddTC_Transporter').val(d.AddTC_Transporter);
                    $('#AddTC_Invoice_No').val(d.AddTC_Invoice_No);
                    $('#AddTC_InvDate').val(d.AddTC_InvDate);
                    $('#AddTCAdvPaymentOn').val(d.AddTCAdvPaymentOn);
                    $('#AddTCPaymentDate').val(d.AddTCPaymentDate);
                    $('#AddTC_Charges').val(d.AddTC_Charges);
                    $('#AddTCChargesGST').val(d.AddTCChargesGST);
                    $('#AddTCChargesGSTAmount').val(d.AddTCChargesGSTAmount);
                    $('#AddTCCharges_Total').val(d.AddTCCharges_Total);

                    $('#AddTC_VGM').val(d.AddTC_VGM);
                    $('#AddTCVGMGST').val(d.AddTCVGMGST);
                    $('#AddTCVGMGSTAmount').val(d.AddTCVGMGSTAmount);
                    $('#AddTCVGM_Total').val(d.AddTCVGM_Total);

                    $('#AddTC_Other').val(d.AddTC_Other);
                    $('#AddTCOtherGST').val(d.AddTCOtherGST);
                    $('#AddTCOtherGSTAmount').val(d.AddTCOtherGSTAmount);
                    $('#AddTCOther_Total').val(d.AddTCOther_Total);
                    $('#AddTC_AMT_Before_GST').val(d.AddTC_AMT_Before_GST);
                    $('#AddTC_GST').val(d.AddTC_GST);
                    $('#AddTC_Total').val(d.AddTC_Total);

                    // ================= COO =================
                    $('#COO_Vendor').val(d.COO_Vendor);
                    $('#COO_Invoice_No').val(d.COO_Invoice_No);
                    $('#COO_InvDate').val(d.COO_InvDate);
                    $('#COO_Particulars').val(d.COO_Particulars);
                    $('#COO_Amt_Before_GST').val(d.COO_Amt_Before_GST);
                    $('#COOGSTPercentage').val(d.COOGSTPercentage);
                    $('#COO_GST').val(d.COO_GST);
                    $('#COO_Total').val(d.COO_Total);

                    // ================= EIA =================
                    $('#EIA_Vendor').val(d.EIA_Vendor);
                    $('#EIA_Invoice_No').val(d.EIA_Invoice_No);
                    $('#EIA_InvDate').val(d.EIA_InvDate);
                    $('#EIA_Particulars').val(d.EIA_Particulars);
                    $('#EIA_Amt_Before_GST').val(d.EIA_Amt_Before_GST);
                    $('#EIAGSTPercentage').val(d.EIAGSTPercentage);
                    $('#EIA_GST').val(d.EIA_GST);
                    $('#EIA_Total').val(d.EIA_Total);

                    // ================= DOC =================
                    $('#Doc_ForwardedNo').val(d.Doc_ForwardedNo);
                    $('#Doc_Sent_Through').val(d.Doc_Sent_Through);
                    $('#Doc_Date').val(d.Doc_Date);
                    $('#Doc_Submitted_Account_On').val(d.Doc_Submitted_Account_On);
                    $('#Weight').val(d.Weight);
                    $('#Quntity_SQM').val(d.Quntity_SQM);
                    if (!d.Mode || d.Mode.trim() === "") {
                        $('#Type').prop('disabled', true);
                        $('#Type').addClass("readonly");
                        $('#Type').css({ "filter": "grayscale(1)", "background-color": "#e9ecef" });
                    } else {
                        $('#Type').prop('disabled', false);
                        $('#Type').removeClass("readonly");
                        $('#Type').css({ "filter": "none", "background-color": "" });
                    }



                    if (d.Type || d.Type.trim() !== "") {
                        if (d.Type === "COURIER" || d.Type === "CONSIGNMENT") {
                            $('#Type').prop('disabled', true).addClass("readonly").css({
                                "filter": "grayscale(1)",
                                "background-color": "#e9ecef"
                            });
                        }

                        $("#Type option").filter(function () {
                            return $(this).text().trim() === d.Type.trim();
                        }).prop("selected", true);
                        $('#Type').closest('.form-group').find('span.required-startype').show();
                    }
                    else {
                        if (d.Mode && d.Mode.trim().toUpperCase() === "ROAD") {
                            d.Type = "";
                            var typeDropdown = $('#Type');
                            typeDropdown.empty();// force null/empty value
                            typeDropdown.append($('<option>').val('').text(''));
                            $('#Type').closest('.form-group').find('span.required-startype').hide();
                        }
                        else {
                            loadFCLByMode(d.Mode);
                            $('#Type').closest('.form-group').find('span.required-startype').show();
                        }
                    }

                    if (d.Type && d.Type.trim() === "FCL") {
                        $('#No_of_FCL').prop('disabled', false);
                        $('#No_of_FCL').removeClass("readonly");
                        $('#No_of_FCL').css({ "filter": "none", "background-color": "" });
                        $('#No_of_FCL').closest('.form-group').find('span.required-star').show();
                    } else {
                        $('#No_of_FCL').prop('disabled', true);
                        $('#No_of_FCL').addClass("readonly");
                        $('#No_of_FCL').css({ "filter": "grayscale(1)", "background-color": "#e9ecef" });
                        $('#No_of_FCL').closest('.form-group').find('span.required-star').hide();
                    }
                    $('#No_of_FCL').val(d.No_of_FCL);

                    $('#hdnFinalSave').val(d.finalsave);


                    function toggleFieldBasedOnValue(selector) {

                        if ($(selector).val() === "" || $(selector).val() === undefined || $(selector).val() === null) {

                            $(selector).prop('disabled', false);
                            $(selector).removeClass("readonly");
                            $(selector).css({ "filter": "none", "background-color": "" });
                        } else {

                            $(selector).prop('disabled', true);
                            $(selector).addClass("readonly");
                            $(selector).css({
                                "filter": "grayscale(1)", "background-color": "#e9ecef"
                            });
                        }
                    }

                    toggleFieldBasedOnValue('#EPCG_Licence_No');
                    toggleFieldBasedOnValue('#Shipping_Bill_No');
                    toggleFieldBasedOnValue('#Date2');
                    toggleFieldBasedOnValue('#AirWay_BillNo_Bill_of_LodingNo');
                    toggleFieldBasedOnValue('#AirWay_BillDate_Bill_of_LodingDate');
                    toggleFieldBasedOnValue('#Port_of_Loading');
                    toggleFieldBasedOnValue('#Port_of_Discharge');
                    toggleFieldBasedOnValue('#Inco_Terms');
                    toggleFieldBasedOnValue('#Remarks');
                    toggleFieldBasedOnValue('#Clearing_Point');
                    let otherChargesArray = (d.OtherCharges && Array.isArray(d.OtherCharges)) ? d.OtherCharges : [];
                    
                    // ================= OTHER CHARGES TABLE =================
                    let tbody = $('#chargesTable tbody');
                    let tbody2 = $('#BLchargesTable tbody');
                    tbody.empty();
                    tbody2.empty();

                    if (otherChargesArray.length > 0) {
                        let hasBLSurrender = false;
                        let advPaymentOnSet = false;
                        let paymentDateSet = false;
                        let BLadvPaymentOnSet = false;
                        let BLpaymentDateSet = false;

                        let srNormal = 1; // ✅ Separate counter for normal other charges
                        let srBLSurrender = 1; // ✅ Separate counter for BL Surrender charges

                        otherChargesArray.forEach(function (item) {

                            // ✅ Check if this item is for BL Surrender
                            if (item.OC_Particulars && item.OC_Particulars.toLowerCase() === "bl surrender") {
                                hasBLSurrender = true;

                                // ✅ Set BL Surrender-specific fields
                                if (!BLadvPaymentOnSet && item.OC_BLAdvPaymenton) {
                                    $('.oc-bladvpaymenton').val(item.OC_BLAdvPaymenton);
                                    BLadvPaymentOnSet = true;
                                }
                                if (!BLpaymentDateSet && item.OC_BLPaymentDate) {
                                    $('.oc-blpaymentdate').val(item.OC_BLPaymentDate);
                                    BLpaymentDateSet = true;
                                }

                                // ✅ Append BL Surrender Row
                                let row = `
                <tr style="font-size: 15px;">
                    <td class="sr-no">${srBLSurrender++}</td>
                    <td><input type="text" class="form-control oc-BLvendor" value="${item.OC_Vendor || ''}" /></td>
                    <td><input type="text" class="form-control oc-BLinvoice-no" value="${item.OC_Invoice_No || ''}" /></td>
                    <td><input type="text" class="form-control oc-BLinvdate" value="${item.OC_InvDate || ''}" placeholder="dd/mm/yy" /></td>
                    <td><input type="text" class="form-control oc-BLparticulars" value="${item.OC_Particulars || ''}" /></td>
                    <td><input type="text" class="form-control oc-BLamt-before-gst" value="${item.OC_Amt_Before_GST || '0.00'}" placeholder="0.00" style="text-align:right;" /></td>
                    <td><input type="text" class="form-control oc-BLgstPercentage" value="${item.OC_GSTPercentage || '0.00'}" placeholder="0.00" style="text-align:right;" /></td>
                    <td><input type="text" class="form-control oc-BLgstAmount" value="${item.OC_GSTAmount || '0.00'}" placeholder="0.00" style="text-align:right;" readonly /></td>
                    <td><input type="text" class="form-control oc-BLtotal" value="${item.OC_Total || '0.00'}" placeholder="0.00" style="text-align:right;" readonly /></td>

                </tr>`;
                                /* <td><button type="button" class="btn btn-danger" onclick="removeRow3(this)" style="text-align:right;"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>*/
                                tbody2.append(row);

                            } else {
                                // ✅ Set Normal Other Charges fields
                                if (!advPaymentOnSet && item.OCAdvPaymenton) {
                                    $('.oc-advpaymenton').val(item.OCAdvPaymenton);
                                    advPaymentOnSet = true;
                                }
                                if (!paymentDateSet && item.OCPaymentDate) {
                                    $('.oc-paymentdate').val(item.OCPaymentDate);
                                    paymentDateSet = true;
                                }

                                // ✅ Append Normal Other Charges Row
                                let row = `
                <tr style="font-size: 15px;">
                    <td class="sr-no">${srNormal++}</td>
                    <td><input type="text" class="form-control oc-vendor" value="${item.OC_Vendor || ''}" /></td>
                    <td><input type="text" class="form-control oc-invoice-no" value="${item.OC_Invoice_No || ''}" /></td>
                    <td><input type="text" class="form-control oc-invdate" value="${item.OC_InvDate || ''}" placeholder="dd/mm/yy" /></td>
                    <td><input type="text" class="form-control oc-particulars" value="${item.OC_Particulars || ''}" /></td>
                    <td><input type="text" class="form-control oc-amt-before-gst" value="${item.OC_Amt_Before_GST || '0.00'}" placeholder="0.00" style="text-align:right;" /></td>
                    <td><input type="text" class="form-control oc-gstPercentage" value="${item.OC_GSTPercentage || '0.00'}" placeholder="0.00" style="text-align:right;" /></td>
                    <td><input type="text" class="form-control oc-gstAmount" value="${item.OC_GSTAmount || '0.00'}" placeholder="0.00" style="text-align:right;" readonly /></td>
                    <td><input type="text" class="form-control oc-total" value="${item.OC_Total || '0.00'}" placeholder="0.00" style="text-align:right;" readonly /></td>
                    <td><button type="button" class="btn btn-danger" onclick="removeRow(this)" style="text-align:right;"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
                </tr>`;
                                tbody.append(row);
                            }
                        });

                        // ✅ If there was no BL Surrender data at all
                        if (!hasBLSurrender) {
                            let emptyBLRow = `
            <tr style="font-size: 15px;">
                <td class="sr-no">1</td>
                <td><input type="text" class="form-control oc-BLvendor" /></td>
                <td><input type="text" class="form-control oc-BLinvoice-no" /></td>
                <td><input type="text" class="form-control oc-BLinvdate" placeholder="dd/mm/yy" /></td>
                <td><input type="text" class="form-control oc-BLparticulars" value="BL Surrender" /></td>
                <td><input type="text" class="form-control oc-BLamt-before-gst" value="0.00" placeholder="0.00" style="text-align:right;" /></td>
                <td><input type="text" class="form-control oc-BLgstPercentage" value="0.00" placeholder="0.00" style="text-align:right;" /></td>
                <td><input type="text" class="form-control oc-BLgstAmount" value="0.00" placeholder="0.00" style="text-align:right;" readonly /></td>
                <td><input type="text" class="form-control oc-BLtotal" value="0.00" placeholder="0.00" style="text-align:right;" readonly /></td>

            </tr>`;
                            /* <td><button type="button" class="btn btn-danger" onclick="removeRow3(this)" style="text-align:right;"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>*/
                            tbody2.append(emptyBLRow);
                        }
                    } else {
                        // ✅ When no data at all
                        let defaultRow = `
        <tr style="font-size: 15px;">
            <td class="sr-no">1</td>
            <td><input type="text" class="form-control oc-vendor" /></td>
            <td><input type="text" class="form-control oc-invoice-no" /></td>
            <td><input type="text" class="form-control oc-invdate" placeholder="dd/mm/yy" /></td>
            <td><input type="text" class="form-control oc-particulars" /></td>
            <td><input type="text" class="form-control oc-amt-before-gst" value="0.00" placeholder="0.00" style="text-align:right;" /></td>
            <td><input type="text" class="form-control oc-gstPercentage" value="0.00" placeholder="0.00" style="text-align:right;" /></td>
            <td><input type="text" class="form-control oc-gstAmount" value="0.00" placeholder="0.00" style="text-align:right;" readonly /></td>
            <td><input type="text" class="form-control oc-total" value="0.00" placeholder="0.00" style="text-align:right;" readonly /></td>
            <td><button type="button" class="btn btn-danger" onclick="removeRow(this)" style="text-align:right;"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
        </tr>`;
                        tbody.append(defaultRow);

                        let defaultBLRow = `
        <tr style="font-size: 15px;">
            <td class="sr-no">1</td>
            <td><input type="text" class="form-control oc-BLvendor" /></td>
            <td><input type="text" class="form-control oc-BLinvoice-no" /></td>
            <td><input type="text" class="form-control oc-BLinvdate" placeholder="dd/mm/yy" /></td>
            <td><input type="text" class="form-control oc-BLparticulars" value="BL Surrender" /></td>
            <td><input type="text" class="form-control oc-BLamt-before-gst" value="0.00" placeholder="0.00" style="text-align:right;" /></td>
            <td><input type="text" class="form-control oc-BLgstPercentage" value="0.00" placeholder="0.00" style="text-align:right;" /></td>
            <td><input type="text" class="form-control oc-BLgstAmount" value="0.00" placeholder="0.00" style="text-align:right;" readonly /></td>
            <td><input type="text" class="form-control oc-BLtotal" value="0.00" placeholder="0.00" style="text-align:right;" readonly /></td>

        </tr>`;
                        /*<td><button type="button" class="btn btn-danger" onclick="removeRow3(this)" style="text-align:right;"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>*/
                        tbody2.append(defaultBLRow);
                    }


               /*     if (otherChargesArray.length > 0) {

                        let row = `<tr style="font-size: 15px;">
                                        <td class="sr-no">1</td>
                                        <td><input type="text" class="form-control oc-BLvendor" name="OtherCharges[0].OC_Vendor" value="" /></td>
                                        <td><input type="text" class="form-control oc-BLinvoice-no" name="OtherCharges[0].OC_Invoice_No" value="" /></td>
                                        <td><input type="text" class="form-control oc-BLinvdate" name="OtherCharges[0].OC_InvDate" value="" placeholder="dd/mm/yy" /></td>
                                        <td><input type="text" class="form-control oc-BLparticulars" name="OtherCharges[0].OC_Particulars" value="" /></td>
                                        <td><input type="text" class="form-control oc-BLamt-before-gst" name="OtherCharges[0].OC_Amt_Before_GST" style = "text-align:right;" value="0.00" placeholder="0.00" /></td>
                                        <td><input type="text" class="form-control oc-BLgstPercentage" name="OtherCharges[0].OC_GSTPercentage" value="0.00" style = "text-align:right;" placeholder="0.00" /></td>
                                        <td><input type="text" class="form-control oc-BLgstAmount" name="OtherCharges[0].OC_GSTAmount" value="0.00" style = "text-align:right;" readonly placeholder="0.00" /></td>
                                        <td><input type="text" class="form-control oc-BLtotal" name="OtherCharges[0].OC_Total" value="0.00" style = "text-align:right;" readonly placeholder="0.00" /></td>
                                        <td style="display: none;"><input type="text" class="form-control oc-BLrowid" name="OtherCharges[0].OC_RowId" value="" readonly /></td>
                                        <td><button type="button" class="btn btn-danger" onclick="removeRow3(this)"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
                                    </tr>`;

                        tbody2.append(row);
                    }
                    else {


                    if (otherChargesArray.length > 0) {
                        otherChargesArray.forEach(function (item, index) {
                            debugger
                            if (item.OC_Particulars && item.OC_Particulars.toLowerCase() === "bl surrender") {
                                debugger
                                if (!BLadvPaymentOnSet && item.OC_BLAdvPaymenton) {
                                    $('.oc-bladvpaymenton').val(item.OC_BLAdvPaymenton);
                                    BLadvPaymentOnSet = true;
                                 hasBLSurrender = true;
                                }
                                if (!BLpaymentDateSet && item.OC_BLPaymentDate) {
                                    $('.oc-blpaymentdate').val(item.OC_BLPaymentDate);
                                    BLpaymentDateSet = true;
                                    hasBLSurrender = true;
                                }

                                let row = ` <tr style="font-size: 15px;">
                                            <td class="sr-no">${index + 1}</td>
                                            <td><input type="text" class="form-control oc-BLvendor" name="OtherCharges[${index}].OC_Vendor" value="${item.OC_Vendor || ''}" /></td>
                                            <td><input type="text" class="form-control oc-BLinvoice-no" name="OtherCharges[${index}].OC_Invoice_No" value="${item.OC_Invoice_No || ''}" /></td>
                                            <td><input type="text" class="form-control oc-BLinvdate" name="OtherCharges[${index}].OC_InvDate" value="${item.OC_InvDate || ''}" placeholder="dd/mm/yy" /></td>
                                            <td><input type="text" class="form-control oc-BLparticulars" name="OtherCharges[${index}].OC_Particulars" value="${item.OC_Particulars || ''}" /></td>
                                            <td><input type="text" class="form-control oc-BLamt-before-gst" name="OtherCharges[${index}].OC_Amt_Before_GST" style="text-align:right;" value="${item.OC_Amt_Before_GST || ''}" placeholder="0.00" /></td>
                                            <td><input type="text" class="form-control oc-BLgstPercentage" name="OtherCharges[${index}].OC_GSTPercentage" value="${item.OC_GSTPercentage || ''}" style="text-align:right;" placeholder="0.00" /></td>
                                            <td><input type="text" class="form-control oc-BLgstAmount" name="OtherCharges[${index}].OC_GSTAmount" value="${item.OC_GSTAmount || ''}" style="text-align:right;" readonly placeholder="0.00" /></td>
                                            <td><input type="text" class="form-control oc-BLtotal" name="OtherCharges[${index}].OC_Total" style="text-align:right;" value="${item.OC_Total || ''}" readonly placeholder="0.00" /></td>
                                            <td style="display:none;"><input type="text" class="form-control oc-BLrowid" name="OtherCharges[${index}].OC_RowId" value="${item.OC_RowId || ''}" readonly /></td>
                                            <td><button type="button" class="btn btn-danger" onclick="removeRow3(this)" style="text-align:right;"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
                                        </tr>`;

                                tbody2.append(row);
                            }

                            // ✅ Set the two date fields outside the table (only once for first item)

                        });
                        }

                    }
                    if (otherChargesArray.length === 0) {

                        let row = `<tr style="font-size: 15px;">
                                        <td class="sr-no">1</td>
                                        <td><input type="text" class="form-control oc-vendor" name="OtherCharges[0].OC_Vendor" value="" /></td>
                                        <td><input type="text" class="form-control oc-invoice-no" name="OtherCharges[0].OC_Invoice_No" value="" /></td>
                                        <td><input type="text" class="form-control oc-invdate" name="OtherCharges[0].OC_InvDate" value="" placeholder="dd/mm/yy" /></td>
                                        <td><input type="text" class="form-control oc-particulars" name="OtherCharges[0].OC_Particulars" value="" /></td>
                                        <td><input type="text" class="form-control oc-amt-before-gst" name="OtherCharges[0].OC_Amt_Before_GST" style = "text-align:right;" value="0.00" placeholder="0.00" /></td>
                                        <td><input type="text" class="form-control oc-gstPercentage" name="OtherCharges[0].OC_GSTPercentage" value="0.00" style = "text-align:right;" placeholder="0.00" /></td>
                                        <td><input type="text" class="form-control oc-gstAmount" name="OtherCharges[0].OC_GSTAmount" value="0.00" style = "text-align:right;" readonly placeholder="0.00" /></td>
                                        <td><input type="text" class="form-control oc-total" name="OtherCharges[0].OC_Total" value="0.00" style = "text-align:right;" readonly placeholder="0.00" /></td>
                                        <td style="display: none;"><input type="text" class="form-control oc-rowid" name="OtherCharges[0].OC_RowId" value="" readonly /></td>
                                        <td><button type="button" class="btn btn-danger" onclick="removeRow(this)"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
                                    </tr>`;

                        tbody.append(row);
                    }
                    else {


                    if (otherChargesArray.length > 0) {
                        otherChargesArray.forEach(function (item, index) {

                            // ✅ Set the two date fields outside the table (only once for first item)
                            if (!advPaymentOnSet && item.OCAdvPaymenton) {
                                $('.oc-advpaymenton').val(item.OCAdvPaymenton);
                                advPaymentOnSet = true;
                            }
                            if (!paymentDateSet && item.OCPaymentDate) {
                                $('.oc-paymentdate').val(item.OCPaymentDate);
                                paymentDateSet = true;
                            }

                            let row = ` <tr style="font-size: 15px;">
                                    <td class="sr-no">${index + 1}</td>
                                    <td><input type="text" class="form-control oc-vendor" name="OtherCharges[${index}].OC_Vendor" value="${item.OC_Vendor || ''}" /></td>
                                    <td><input type="text" class="form-control oc-invoice-no" name="OtherCharges[${index}].OC_Invoice_No" value="${item.OC_Invoice_No || ''}" /></td>
                                    <td><input type="text" class="form-control oc-invdate" name="OtherCharges[${index}].OC_InvDate" value="${item.OC_InvDate || ''}" placeholder="dd/mm/yy" /></td>
                                    <td><input type="text" class="form-control oc-particulars" name="OtherCharges[${index}].OC_Particulars" value="${item.OC_Particulars || ''}" /></td>
                                    <td><input type="text" class="form-control oc-amt-before-gst" name="OtherCharges[${index}].OC_Amt_Before_GST" style = "text-align:right;" value="${item.OC_Amt_Before_GST || ''}" placeholder="0.00" /></td>
                                    <td><input type="text" class="form-control oc-gstPercentage" name="OtherCharges[${index}].OC_GSTPercentage" value="${item.OC_GSTPercentage || ''}" style = "text-align:right;" placeholder="0.00" /></td>
                                    <td><input type="text" class="form-control oc-gstAmount" name="OtherCharges[${index}].OC_GSTAmount" value="${item.OC_GSTAmount || ''}" style = "text-align:right;" readonly placeholder="0.00" /></td>
                                    <td><input type="text" class="form-control oc-total" name="OtherCharges[${index}].OC_Total"  style = "text-align:right;" value="${item.OC_Total || ''}" readonly placeholder="0.00" /></td>
                                    <td style="display:none;"><input type="text" class="form-control oc-rowid" name="OtherCharges[${index}].OC_RowId" value="${item.OC_RowId || ''}" readonly /></td>
                                    <td><button type="button" class="btn btn-danger" onclick="removeRow(this)" style = "text-align:right;"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
                                </tr>`;

                            tbody.append(row);
                        });
                        }

                    }*/
       /*             if (!hasBLSurrender) {
                        let blankRow = `
        <tr style="font-size: 15px;">
            <td class="sr-no">1</td>
            <td><input type="text" class="form-control oc-vendor" name="OtherCharges[0].OC_Vendor" value="" /></td>
            <td><input type="text" class="form-control oc-invoice-no" name="OtherCharges[0].OC_Invoice_No" value="" /></td>
            <td><input type="text" class="form-control oc-invdate" name="OtherCharges[0].OC_InvDate" value="" placeholder="dd/mm/yy" /></td>
            <td><input type="text" class="form-control oc-particulars" name="OtherCharges[0].OC_Particulars" value="" /></td>
            <td><input type="text" class="form-control oc-amt-before-gst" name="OtherCharges[0].OC_Amt_Before_GST" style="text-align:right;" value="0.00" placeholder="0.00" /></td>
            <td><input type="text" class="form-control oc-gstPercentage" name="OtherCharges[0].OC_GSTPercentage" value="0.00" style="text-align:right;" placeholder="0.00" /></td>
            <td><input type="text" class="form-control oc-gstAmount" name="OtherCharges[0].OC_GSTAmount" value="0.00" style="text-align:right;" readonly placeholder="0.00" /></td>
            <td><input type="text" class="form-control oc-total" name="OtherCharges[0].OC_Total" value="0.00" style="text-align:right;" readonly placeholder="0.00" /></td>
            <td style="display:none;"><input type="text" class="form-control oc-rowid" name="OtherCharges[0].OC_RowId" value="" readonly /></td>
            <td><button type="button" class="btn btn-danger" onclick="removeRow3(this)"><i class="fa fa-minus"></i></button></td>
        </tr>`;
                        tbody2.append(blankRow);
                    }*/
                    let cfsotherChargesArray = (d.CFSOtherCharges && Array.isArray(d.CFSOtherCharges)) ? d.CFSOtherCharges : [];
                    // ================= OTHER CHARGES TABLE =================
                    let tbody1 = $('#CfschargesTable tbody');
                    tbody1.empty();

                   let fixedServices = [
                        "Other/Private Yard LoLo Charges",
                        "Terminal Handling Charges",
                        "Rail Freight Charges",
                        "Others Support Ser.Infrastructure & Devel.Charges"
                    ];

                    if (cfsotherChargesArray.length === 0) {
                        tbody1.empty();
                        fixedServices.forEach(function (serviceName, index) {
                            let row1 = ` <tr >
                                        <td class="sr-no">${index + 1}</td>
                                        <td><input class="form-control cfs-nature_of_service" name="CFSOtherCharges[0].Nature_of_Service"  value="${serviceName}" /></td>
                                        <td><input class="form-control cfs_amtbeforegst" name="CFSOtherCharges[0].AmtBeforeGST"  style = "text-align:right;" placeholder="0.00" /></td>
                                        <td><input class="form-control cfs_gstpercentage" name="CFSOtherCharges[0].GstPercentage" style = "text-align:right;" placeholder="0" /></td>
                                        <td><input class="form-control cfs_gstAmount" name="CFSOtherCharges[0].GstAmount" style = "text-align:right;" placeholder="0.00" readonly /></td>
                                        <td><input class="form-control cfs_total" name="CFSOtherCharges[0].Total" style = "text-align:right;" placeholder="0.00" readonly /></td>
                                        <td style="display:none"><input class="form-control cfs_rowid" name="CFSOtherCharges[0].Cfs_RowId" readonly /></td>
                                        <td><button type="button" class="btn btn-danger" onclick="removeRow2(this)" ><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
                                    </tr> `;
                            tbody1.append(row1);
                        });
                        let grandTotalRow = `<tr >
                                                <td></td>
                                                <td>Grand Total</td>
                                                <td><input class="form-control" id="CFS_Amt_Before_GST" name="CFS_Amt_Before_GST" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>
                                                <td></td>
                                                <td><input class="form-control" id="CFS_GST" name="CFS_GST" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>
                                                <td><input class="form-control" id="CFS_Total" name="CFS_Total" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>

                                                <td></td>
                                            </tr>`;

                        let saveButtonRow = `<tr>
                                                <td colspan="6" style="text-align:end;">
                                                    <a href="#" id="lnkUpdateCfsOC" class="btn" style="font-size: 15px; background-color: #339be1; color: white; width: 7%;">
                                                        <i class="fa fa-eraser"></i> Save
                                                    </a>
                                                </td>
                                                <td></td>
                                            </tr>`;
                        tbody1.append(grandTotalRow);
                        tbody1.append(saveButtonRow);
                        calculateCfsGrandTotals();
                    }
                    else {
                        if (cfsotherChargesArray.length > 0) {
                            tbody1.empty();
                            cfsotherChargesArray.forEach(function (item, index) {

                                let row1 = `  <tr >
                                                <td class="sr-no">${index + 1}</td>
                                                <td><input class="form-control cfs-nature_of_service" name="CFSOtherCharges[${index}].Nature_of_Service"   value="${item.Nature_of_Service || ''}" /></td>
                                                <td><input class="form-control cfs_amtbeforegst" name="CFSOtherCharges[${index}].AmtBeforeGST" style = "text-align:right;" placeholder="0.00" value="${item.AmtBeforeGST || ''}"/></td>
                                                <td><input class="form-control cfs_gstpercentage" name="CFSOtherCharges[${index}].GstPercentage" style = "text-align:right;" placeholder="0" value="${item.GstPercentage || ''}"/></td>
                                                <td><input class="form-control cfs_gstAmount" name="CFSOtherCharges[${index}].GstAmount" style = "text-align:right;" placeholder="0.00" readonly     value="${item.GstAmount || ''}"/></td>
                                                <td><input class="form-control cfs_total" name="CFSOtherCharges[${index}].Total"  style = "text-align:right;" placeholder="0.00" readonly  value="${item.Total || ''}"/></td>
                                                <td style="display:none"><input class="form-control cfs_rowid" name="CFSOtherCharges[${index}].Cfs_RowId" readonly   value="${item.Cfs_RowId || ''}"/></td>
                                                <td><button type="button" class="btn btn-danger" onclick="removeRow2(this)"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
                                            </tr>`;
                                tbody1.append(row1);
                            });
                            let grandTotalRow = `<tr >
                                                    <td></td>
                                                    <td>Grand Total</td>
                                                    <td><input class="form-control" id="CFS_Amt_Before_GST" name="CFS_Amt_Before_GST" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>
                                                    <td></td>
                                                    <td><input class="form-control" id="CFS_GST" name="CFS_GST" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>
                                                    <td><input class="form-control" id="CFS_Total" name="CFS_Total" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>

                                                    <td></td>
                                                </tr>`;


                            let saveButtonRow = `<tr>
                                                    <td colspan="6" style="text-align:end;">
                                                        <a href="#" id="lnkUpdateCfsOC" class="btn" style="font-size: 15px; background-color: #339be1; color: white; width: 7%;">
                                                            <i class="fa fa-eraser"></i> Save
                                                        </a>
                                                    </td>
                                                    <td></td>
                                                </tr>`;
                            tbody1.append(grandTotalRow);
                            tbody1.append(saveButtonRow);
                            calculateCfsGrandTotals();
                        }
                    }

                    initializeDatePickers();
                    if (d.finalsave) {
                        $('#FinalsavePanel').show();
                        $('#Type').prop('disabled', true).addClass("readonly").css({
                            "filter": "grayscale(1)",
                            "background-color": "#e9ecef"
                        });
                        $('#No_of_FCL').prop('disabled', true).addClass("readonly").css({
                            "filter": "grayscale(1)",
                            "background-color": "#e9ecef"
                        });

                        $('input[type="text"], input[type="date"], input[type="number"], select, textarea').prop('disabled', true);
                        $('#lnkSave, #lnkClearance, #lnkUpdateFCS, #lnkUpdateFCA, #lnkUpdateTC, #lnkUpdateCfsOC, #lnkUpdateAddTC, #lnkUpdateCOO, #lnkUpdateEIA, #lnkUpdateOC, #lnkUpdateFinalSave')
                            .prop('disabled', true)
                            .css({
                                "filter": "grayscale(1)",
                                "pointer-events": "none",   // prevent clicking
                                "opacity": "0.6"            // optional: visually indicate disabled
                            });

                        document.querySelectorAll(".panel").forEach(panel => {
                            const isInvoicePanel = panel.id === "InvoiceDetailsPanel";
                            const content = panel.querySelector(".toggle-content");
                            const icon = panel.querySelector(".toggle-icon");

                            if (isInvoicePanel) {

                                if (content) content.style.display = "block";
                                if (icon) {
                                    icon.classList.remove("fa-plus");
                                    icon.classList.add("fa-minus");
                                    icon.style.transform = "rotate(180deg)";
                                }
                            } else {

                                if (content) content.style.display = "none";
                                if (icon) {
                                    icon.classList.remove("fa-minus");
                                    icon.classList.add("fa-plus");
                                    icon.style.transform = "rotate(0deg)";
                                }
                            }
                            panel.querySelectorAll("input, select, textarea, button").forEach(field => {
                                field.disabled = true;
                            });
                        });
                        document.querySelectorAll(".panel").forEach(panel => {
                            const heading = panel.querySelector(".panel-heading span");
                            if (
                                heading &&
                                (
                                    heading.textContent.trim() === "Document Details" ||
                                    heading.textContent.trim() === "BL Surrender Charges"
                                )
                            ) {
                                panel.querySelectorAll("input, select, textarea, button").forEach(field => {
                                    field.disabled = false;
                                    field.classList.remove("readonly"); // remove the grayscale class
                                    field.style.filter = "none";        // remove grayscale
                                    field.style.backgroundColor = "";
                                });

                                const content = panel.querySelector(".toggle-content");
                                if (content) content.style.display = "block"; // open these panels

                                const icon = panel.querySelector(".toggle-icon");
                                if (icon) {
                                    icon.classList.remove("fa-plus");
                                    icon.classList.add("fa-minus");
                                    icon.style.transform = "rotate(180deg)";
                                }

                            }
                        });
/*
                            const panels = document.querySelectorAll(".panel");
                            panels.forEach(panel => {
                                const heading = panel.querySelector(".panel-heading span");
                                if (
                                    heading &&
                                    (
                                        heading.textContent.trim() === "Document Details" ||
                                        heading.textContent.trim() === "BL Surrender Charges"
                                    )
                                ) {
                                    panel.querySelectorAll("input, select, textarea, button").forEach(field => {
                                        field.disabled = false;
                                    });

                                    const icon = panel.querySelector(".toggle-icon");
                                    if (icon) {
                                        icon.classList.remove("fa-minus");
                                        icon.classList.add("fa-plus");
                                        icon.style.transform = "rotate(0deg)";
                                    }
                                }

                        });*/
                    }

                    //set total chanrges set 05/02/26 13:35
                    updateChargesPabelLoadData();


                } else {
                    alert("No details found.");
                }
                $('#loadingSpinner').hide();
            },
            error: function () {
                alert('Error loading invoice details');
            }
        });

    }
    function toggleInvoiceDetailsFields() {
        const panel = document.getElementById("InvoiceDetailsPanel");

        if (panel) {
            panel.querySelectorAll("input, select, textarea").forEach(field => {
                if (field.disabled) {

                    field.disabled = true;
                } else {

                    field.disabled = false;
                    field.classList.remove("readonly");
                    field.style.filter = "none";
                    field.style.backgroundColor = "";
                }
            });


            const noOfFCL = panel.querySelector("#No_of_FCL");
            if (noOfFCL && !noOfFCL.disabled) {
                noOfFCL.disabled = false;
                noOfFCL.classList.remove("readonly");
                noOfFCL.style.filter = "none";
                noOfFCL.style.backgroundColor = "";
            }

            const typeDropdown = panel.querySelector("#Type");
            if (typeDropdown && !typeDropdown.disabled) {
                typeDropdown.disabled = false;
                typeDropdown.classList.remove("readonly");
                typeDropdown.style.filter = "none";
                typeDropdown.style.backgroundColor = "";
            }


            $('#lnkDetail').trigger('click');
            
        }
    }


    $('#lnkDetail').on('click', function () {
        
        toggleInvoiceDetailsFields();
    });


    function refreshLnkDetailPage() {

    window.location.reload();


       $('#lnkDetail').trigger('click');
    }

    $(document).ready(function () {

        var loggedInUserIdforexcel = parseInt('@Session["EmployeeRowId"]');

// List of EmployeeRowIds allowed to see the button
var allowedUsers = [2044, 2928, 363, 344,1093,332];

        if (allowedUsers.includes(loggedInUserIdforexcel)) {
            $('#lnkExportToExcel').show();
        } else {
            $('#lnkExportToExcel').hide();
        }


            var loggedInUserId = parseInt('@Session["EmployeeRowId"]');


        var restrictedUsers = [344, 322];
        if (restrictedUsers.includes(loggedInUserIdforexcel)) {

            $('#lnkSave, #lnkClearance,#lnkEnableFinalSave, #lnkUpdateFCS, #lnkUpdateFCA, #lnkUpdateTC, #lnkUpdateCfsOC, #lnkUpdateAddTC, #lnkUpdateCOO, #lnkUpdateEIA, #lnkUpdateOC,#lnkUpdateBLOC,#lnkUpdateDocDetails, #lnkUpdateFinalSave').hide();
        }
        else {
            $('#lnkSave, #lnkClearance, #lnkEnableFinalSave, #lnkUpdateFCS, #lnkUpdateFCA, #lnkUpdateTC, #lnkUpdateCfsOC, #lnkUpdateAddTC, #lnkUpdateCOO, #lnkUpdateEIA, #lnkUpdateOC,#lnkUpdateBLOC, #lnkUpdateDocDetails, #lnkUpdateFinalSave').show();
        }

        var allowed = [363, 2928,2044];
        if (allowed.includes(loggedInUserIdforexcel)) {
            $('#lnkEnableFinalSave').show();
        } else {
            $('#lnkEnableFinalSave').hide();
        }

    });
    function getgriddetails() {
        var urlRequest1 = '@Url.Action("GetExportGridList", "Common")';

       $('#loadingMessage1').show();
        $('#TblExportTrackerInfo').hide();

        var selectedSearchType = $('#searchType').val();

            $.ajax({
                url: urlRequest1,
                type: 'GET',
                data: {
                    SearchType: selectedSearchType,

                },
                success: function (data) {

                    if (data.length === 0) {

                        $('#loadingMessage1').hide();
                        return alert("No data available");




                    }
                    else {

                        var totalRecords = data.length;
                        var pageLength = 15;
                        var totalPages = Math.ceil(totalRecords / pageLength);
                        var startRecord = 1;
                        var endRecord = totalRecords < pageLength ? totalRecords : pageLength;

                        $('#TblExportTrackerInfo_info').text('Showing ' + startRecord + ' to ' + endRecord + ' of ' + totalRecords + ' entries');

                        if ($.fn.dataTable.isDataTable('#TblExportTrackerInfo')) {
                            $('#TblExportTrackerInfo').DataTable().destroy();
                        }

                        var rows = '';
                        for (var i = 0; i < data.length; i++) {
                            var item = data[i];


                            var otherCharges = item.OtherCharges || [];
                            var DivisionTooltip = item.Division;
                            var M_TTooltip = item.Mfr_Out;
                            var Invoice_NoTooltip = item.Invoice_No;
                            var InvDateTooltip = item.InvDate;
                            var Bill_To_NameTooltip = item.Bill_to_Name;
                            var Ship_to_NameTooltip = item.Ship_to_Name;
                            var Shipping_Bill_NoTooltip = item.Shipping_Bill_No;
                            var Shipping_Bill_DateTooltip = item.Shipping_Bill_Date;
                            var EPCG_Licence_NoTooltip = item.EPCG_Licence_No;
                            var CurrencyTooltip = item.Currency;
                            var Basic_Amt_ChargesTooltip = item.Basic_Amt_Charges;
                            var Sea_Freight_Air_FreightTooltip = item.Sea_Freight_Air_Freight;
                            var Insurarnce_chargedTooltip = item.Insurarnce_charged;
                            var Other_chargedTooltip = item.Other_Charges;
                            var Invoice_ValueTooltip = item.Invoice_Value;
                            var Quntity_SQMTooltip = item.Quntity_SQM;
                            var AirWay_BillNo_Bill_of_LodingNoTooltip = item.AirWay_BillNo_Bill_of_LodingNo;
                            var AirWay_BillDate_Bill_of_LodingDateTooltip = item.AirWay_BillDate_Bill_of_LodingDate;
                            var Clearing_PointTooltip = item.Clearing_Point;
                            var Port_of_LoadingTooltip = item.Port_of_Loading;
                            var Port_of_DischargeTooltip = item.Port_of_Discharge;
                            var Mode_of_DishchargeTooltip = item.Mode;
                            var CountryTooltip = item.Country;
                            var Inco_TermsTooltip = item.Inco_Terms;
                            var Payment_TermsTooltip = item.Payment_Terms;
                            var RemarksTooltip = item.Remarks;
                            var ccAgentnameTooltip = item.CCClearance_Agent_Name;
                            var ccTotalTooltip = item.CCAmt_Before_GST;
                            var FCForwderTooltip = item.FCForwarder;
                            var FCSTotalTooltip = item.FCSAmt_Before_GST;
                            var FCATotalTooltip = item.FCAAMT_before_GST;
                            var CFS_VendorTooltip = item.CFS_Vendor;
                            var CFS_TotalTooltip = item.CFS_Amt_Before_GST;
                            var TC_TransporterTooltip = item.TC_Transporter;
                            var TC_TotalTooltip = item.TC_AMT_Before_GST;
                            var AddTC_TransporterTooltip = item.AddTC_Transporter;
                            var AddTC_TotalTooltip = item.AddTC_AMT_Before_GST;
                            var COO_VendorTooltip = item.COO_Vendor;
                            var COO_TotalTooltip = item.COO_Amt_Before_GST;
                            var EIA_VendorTooltip = item.EIA_Vendor;
                            var EIA_TotalTooltip = item.EIA_Amt_Before_GST;
                            var Doc_ForwardedNoTooltip = item.Doc_ForwardedNo;
                            var Doc_Sent_ThroughTooltip = item.Doc_Sent_Through;
                            var Doc_DateTooltip = item.Doc_Date;
                            var Doc_Submitted_Account_OnTooltip = item.Doc_Submitted_Account_On;
                            var FinalTotalTooltip = item.FinalTotal;
                            var TypeTooltip = item.Type;
                            var NooffclTooltip = item.No_of_FCL;
                            var finalsaveDisplay = item.finalsave ? 'Yes' : 'No';
                            //    var runfor = item.runfor;
                            var avgcostpersqmTooltip = item.AvgCostPerSQM;
                            var avgcostperfclTooltip = item.AvgCostPerFCL;
                            var total = 0;
                            const runfor = parseInt(item.runfor);
                            let rowClass = '';

                            if (runfor === 1) {
                                rowClass = 'tr-yellow';
                            } else if (runfor === 3) {
                                rowClass = 'tr-green';
                            }

                            rows += `<tr class="${rowClass}" data-obj='${JSON.stringify(item).replace(/'/g, '&#39;')}'>`;
                            rows += '<td  class="sticky-left-header"  title="">' + item.SrNo + '</td>';
                            rows += '<td  class="sticky-left-header" style = "text-align: center;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;"  title="' + DivisionTooltip + '">' + item.Division + '</td>';
                            rows += '<td  class="sticky-left-header" style="text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 98px;" title="' + M_TTooltip + '">' + item.Mfr_Out + '</td>';
                            rows += '<td  class="sticky-left-header" title="' + Invoice_NoTooltip + '">' + item.Invoice_No + '</td>';
                            rows += '<td  class="sticky-left-header" style = "text-align: center;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 75px;" title="' + InvDateTooltip + '">' + item.InvDate + '</td>';
                            rows += '<td  class="sticky-left-header" style="border-right: 2px solid #918989; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 10rem;"  title="' + Bill_To_NameTooltip + '">' + item.Bill_to_Name + '</td>';
                            rows += '<td  style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 10rem;"class="" title="' + Ship_to_NameTooltip + '">' + item.Ship_to_Name + '</td>';
                            rows += '<td class="" title="' + Shipping_Bill_NoTooltip + '">' + item.Shipping_Bill_No + '</td>';
                            rows += '<td   style = "text-align: center;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;"title="' + Shipping_Bill_DateTooltip + '">' + item.Shipping_Bill_Date + '</td>';
                            rows += '<td class="" title="' + EPCG_Licence_NoTooltip + '">' + item.EPCG_Licence_No + '</td>';
                            rows += '<td class="" title="' + CurrencyTooltip + '">' + item.Currency + '</td>';
                            rows += '<td class=""  style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;" title="' + Basic_Amt_ChargesTooltip + '">' + item.Basic_Amt_Charges + '</td>';
                            rows += '<td class=""   style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;"title="' + Sea_Freight_Air_FreightTooltip + '">' + item.Sea_Freight_Air_Freight + '</td>';
                            rows += '<td class=""   style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;"title="' + Insurarnce_chargedTooltip + '">' + item.Insurarnce_charged + '</td>';
                            rows += '<td class=""   style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;"title="' + Other_chargedTooltip + '">' + item.Other_Charges + '</td>';
                            rows += '<td class=""   style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;" title="' + Invoice_ValueTooltip + '">' + item.Invoice_Value + '</td>';
                            rows += '<td class=""   style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;" title="' + Quntity_SQMTooltip + '">' + item.Quntity_SQM + '</td>';
                            rows += '<td style="text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;" class="" title="' + AirWay_BillNo_Bill_of_LodingNoTooltip + '">' + item.AirWay_BillNo_Bill_of_LodingNo + '</td>';
                            rows += '<td style = "text-align: center;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;" title="' + AirWay_BillDate_Bill_of_LodingDateTooltip + '">' + item.AirWay_BillDate_Bill_of_LodingDate + '</td>';
                            rows += '<td  style = "text-align: center;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;"class="" title="' + Clearing_PointTooltip + '">' + item.Clearing_Point + '</td>';
                            rows += '<td class=""  style="text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;" title="' + Port_of_LoadingTooltip + '">' + item.Port_of_Loading + '</td>';
                            rows += '<td  style="text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;"class="" title="' + Port_of_DischargeTooltip + '">' + item.Port_of_Discharge + '</td>';
                            rows += '<td  class="" style="text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;" title="' + Mode_of_DishchargeTooltip + '">' + item.Mode + '</td>';
                            rows += '<td  class="" style="text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;" title="' + TypeTooltip + '">' + item.Type + '</td>';
                            rows += '<td  class="" style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;" title="' + NooffclTooltip + '">' + item.No_of_FCL + '</td>';
                            rows += '<td class="" style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;" title="' + CountryTooltip + '">' + item.Country + '</td>';
                            rows += '<td class="" title="' + Inco_TermsTooltip + '">' + item.Inco_Terms + '</td>';
                            rows += '<td class="" title="' + Payment_TermsTooltip + '">' + item.Payment_Terms + '</td>';
                            rows += '<td class="" title="' + RemarksTooltip + '">' + item.Remarks + '</td>';
                            rows += '<td class="" style="text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;max-width: 70px;border-left: 2px solid #918989;"title="' + (ccAgentnameTooltip || '') + '">' + (item.CCClearance_Agent_Name || '') + '</td>';
                            rows += '<td   style = "text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;border-right: 2px solid #918989;"class="" title="' + (ccTotalTooltip || '') + '">' + (item.CCAmt_Before_GST || '') + '</td>';
                            rows += '<td   style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 20px"class="" title="' + (FCForwderTooltip || '') + '">' + (item.FCForwarder || '') + '</td>';
                            rows += '<td style = "text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" class="" title="' + (FCSTotalTooltip || '') + '">' + (item.FCSAmt_Before_GST || '') + '</td>';
                            rows += '<td  style = "text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;border-right: 2px solid #918989;"class="" title="' + (FCATotalTooltip || '') + '">' + (item.FCAAMT_before_GST || '') + '</td>';
                            rows += '<td style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;max-width: 70px;" class="" title="' + (TC_TransporterTooltip || '') + '">' + (item.TC_Transporter || '') + '</td>';
                            rows += '<td style = "text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;border-right: 2px solid #918989;"class="" title="' + (TC_TotalTooltip || '') + '">' + (item.TC_AMT_Before_GST || '') + '</td>';
                            rows += '<td  style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;max-width: 70px;"class="" title="' + (CFS_VendorTooltip || '') + '">' + (item.CFS_Vendor || '') + '</td>';
                            rows += '<td style = "text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-right: 2px solid #918989;" class="" title="' + (CFS_TotalTooltip || '') + '">' + (item.CFS_Amt_Before_GST || '') + '</td>';
                            rows += '<td style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;max-width: 70px;" class="" title="' + (AddTC_TransporterTooltip || '') + '">' + (item.AddTC_Transporter || '') + '</td>';
                            rows += '<td style = "text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;border-right: 2px solid #918989;"class="" title="' + (AddTC_TotalTooltip || '') + '">' + (item.AddTC_AMT_Before_GST || '') + '</td>';

                            rows += '<td style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;max-width: 70px;"class="" title="' + (COO_VendorTooltip || '') + '">' + (item.COO_Vendor || '') + '</td>';
                            rows += '<td style = "text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;border-right: 2px solid #918989;"class="" title="' + (COO_TotalTooltip || '') + '">' + (item.COO_Amt_Before_GST || '') + '</td>';
                            rows += '<td style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;max-width: 70px;"class="" title="' + (EIA_VendorTooltip || '') + '">' + (item.EIA_Vendor || '') + '</td>';
                            rows += '<td style = "text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;border-right: 2px solid #918989;"class="" title="' + (EIA_TotalTooltip || '') + '">' + (item.EIA_Amt_Before_GST || '') + '</td>';

                         /*   total += parseFloat(item.CC_total) || 0;
                            total += parseFloat(item.FCSTotal) || 0;
                            total += parseFloat(item.FCATotal) || 0;
                            total += parseFloat(item.TC_Total) || 0;
                            total += parseFloat(item.CFS_Total) || 0;
                            total += parseFloat(item.AddTC_Total) || 0;
                            total += parseFloat(item.COO_Total) || 0;
                            total += parseFloat(item.EIA_Total) || 0;*/
                            for (var c = 0; c < otherCharges.length; c++) {


                                var item2 = otherCharges[c];
                                var mergedVendorTooltip = item2.OC_Vendor;

                                var mergedTotalTooltip = item2.OC_Amt_Before_GST;
                                var mergedRowIdTooltip = item2.OC_RowId;
                              //  total += parseFloat(item2.OC_Total) || 0;
                                rows += '<td style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;max-width: 70px;"class="" title="' + (mergedVendorTooltip || '') + '">' + (item2.OC_Vendor || '') + '</td>';

                                rows += '<td style = "text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;border-right: 2px solid #918989;"class="" title="' + (mergedTotalTooltip || '') + '">' + (item2.OC_Total || '') + '</td>';



                            }
                            let missing = 3 - otherCharges.length;
                            for (let j = 0; j < missing; j++) {
                                rows += '<td></td>';
                                rows += '<td style="border-right: 2px solid #918989;"></td>';

                            }

                            rows += '<td  style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;border-right: 2px solid #918989;"class="" title="' + FinalTotalTooltip + '">' + item.FinalTotal + '</td>';
                            rows += '<td  style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;border-right: 2px solid #918989;"class="" title="' + avgcostpersqmTooltip + '">' + item.AvgCostPerSQM + '</td>';
                            rows += '<td  style="text-align: end;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;border-right: 2px solid #918989;"class="" title="' + avgcostperfclTooltip + '">' + item.AvgCostPerFCL + '</td>';
                            rows += '<td style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;max-width: 70px;"class="" title="' + (Doc_ForwardedNoTooltip || '') + '">' + (item.Doc_ForwardedNo || '') + '</td>';
                            rows += '<td style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;max-width: 70px;"class="" title="' + (Doc_Sent_ThroughTooltip || '') + '">' + (item.Doc_Sent_Through || '') + '</td>';
                            rows += '<td style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"class="" title="' + (Doc_DateTooltip || '') + '">' + (item.Doc_Date || '') + '</td>';
                            rows += '<td style = "text-align: start;white-space: nowrap; overflow: hidden; text-overflow: ellipsis;max-width: 70px;border-right: 2px solid #918989;"class="" title="' + (Doc_Submitted_Account_OnTooltip || '') + '">' + (item.Doc_Submitted_Account_On || '') + '</td>';

                            rows += '</tr>';
                        }


                        $('.ExportInfotbody').html(rows);
                        $('#loadingMessage1').hide();
                        $('#TblExportTrackerInfo').show();

                        var table1 = $('#TblExportTrackerInfo').DataTable({
                            paging: true,
                            searching: true,


                            autoWidth: false,
                            responsive: true,
                            pageLength: 15,
                            lengthMenu: [15, 25, 50, 100],

                            language: {
                                emptyTable: "No Data Found"
                            },

                            initComplete: function () {
                                moveLengthDropdown();
                            }

                        });

                        function moveLengthDropdown() {

                            $('#TblExportTrackerInfo_filter').hide();


                            var $length = $('#TblExportTrackerInfo_wrapper').find('#TblExportTrackerInfo_length');
                            var $target = $('#Accountpage');
                            if ($length.length && $target.length) {
                                $target.find('#TblExportTrackerInfo_length').remove();

                                $length.appendTo($target).css({
                                    'margin-top': '-3px',
                                    'text-align': 'end',
                                    'display': 'inline-block'
                                });
                            } else {
                                console.warn("Either #TblExportTrackerInfo_length or #Accountpage is missing.");
                            }
                        }

                        $('#TblExportTrackerInfo thead').on('keyup change', '.column-search', function () {

                            var columnIndex = $(this).data('column');
                            var searchValue = this.value;
                            table1.column(columnIndex).search(searchValue).draw();
                        });

                    }

                }
            });

                $('[data-toggle="tooltip"]').tooltip();

        $('#TblExportTrackerInfo tbody').on('dblclick', 'tr', function () {


            autoClickTab('#lnkDetail');

            var table = $('#TblExportTrackerInfo').DataTable();
    var dr = table.row(this).data();
      var row = $(this).closest('tr');

            var json = $(this).attr('data-obj');
            var d = JSON.parse(json.replace(/&#39;/g, "'"));

            $('#invoiceDropdown').val(d.Invoice_No);
            loadInvoiceDetails(d.Invoice_No);
////            $('#Date1').val(d.InvDate);
////            $('#Division').val(d.Division);
////            $('#Mfr_Out').val(d.Mfr_Out);
////            $('#Bill_to_Name').val(d.Bill_to_Name);
////            $('#Ship_to_Name').val(d.Ship_to_Name);
////            $('#Shipping_Bill_No').val(d.Shipping_Bill_No);
////            $('#Date2').val(d.Shipping_Bill_Date);
////            $('#EPCG_Licence_No').val(d.EPCG_Licence_No);
////            $('#Currency').val(d.Currency);
////            $('#Basic_Amt_Charges').val(d.Basic_Amt_Charges);
////            $('#Sea_Freight_Air_Freight').val(d.Sea_Freight_Air_Freight);
////            $('#Insurarnce_charged').val(d.Insurarnce_charged);
////            $('#Other_Charges').val(d.Other_Charges);
////            $('#Invoice_Value').val(d.Invoice_Value);
////            $('#AirWay_BillNo_Bill_of_LodingNo').val(d.AirWay_BillNo_Bill_of_LodingNo);
////            $('#AirWay_BillDate_Bill_of_LodingDate').val(d.AirWay_BillDate_Bill_of_LodingDate);
////            $("#Clearing_Point option").filter(function () {
////                return $(this).text() === d.Clearing_Point;
////            }).prop("selected", true);
////            /*$('#Clearing_Point').val(d.Clearing_Point);*/
////            $('#Port_of_Loading').val(d.Port_of_Loading);
////            $('#Port_of_Discharge').val(d.Port_of_Discharge);
////            $('#Mode').val(d.Mode);
////         //   var mode = d.Mode;
////            //if (!d.Type) {
////            //    if (mode) {
////            //        loadFCLByMode(mode);
////            //    } else {
////            //        $('#Type').empty().append($('<option>').val('').text('-- Select --'));
////            //    }
////            //}
////            $('#Country').val(d.Country);
////            /*  $('#Inco_Terms').val(d.Inco_Terms);*/
////            $("#Inco_Terms option").filter(function () {
////                return $(this).text() === d.Inco_Terms;
////            }).prop("selected", true);
////            $('#Payment_Terms').val(d.Payment_Terms);
////            $('#Remarks').val(d.Remarks);

////            // CCC
////            $('#CCClearance_Agent_Name').val(d.CCClearance_Agent_Name);
////            $('#CCInvoice_No').val(d.CCInvoice_No);
////            $('#Date3').val(d.CCInvDate);
////            $('#CCClearance_agency_charges').val(d.CCClearance_agency_charges);
////            $('#CCClearance_Agency_chargesGST').val(d.CCClearance_Agency_chargesGST);
////            $('#CCClearance_Agency_chargesGSTAmount').val(d.CCClearance_Agency_chargesGSTAmount);
////            $('#CCClearance_Agency_charges_Total').val(d.CCClearance_Agency_charges_Total);

////            $('#CCEDI_Xeam_charges').val(d.CCEDI_Xeam_charges);
////            $('#CCEdi_Xeam_ChargesGST').val(d.CCEdi_Xeam_ChargesGST);
////            $('#CCEdi_Xeam_ChargesGSTAmount').val(d.CCEdi_Xeam_ChargesGSTAmount);
////            $('#CCEdi_Xeam_Charges_Total').val(d.CCEdi_Xeam_Charges_Total);

////            $('#CCVGM').val(d.CCVGM);
////            $('#CCVGMGST').val(d.CCVGMGST);
////            $('#CCVGMGSTAmount').val(d.CCVGMGSTAmount);
////            $('#CCVGM_Total').val(d.CCVGM_Total);

////            $('#CCGSEC').val(d.CCGSEC);
////            $('#CCGSECGST').val(d.CCGSECGST);
////            $('#CCGSECGSTAmount').val(d.CCGSECGSTAmount);
////            $('#CCGSEC_Total').val(d.CCGSEC_Total);

////            $('#CCCOO').val(d.CCCOO);
////            $('#CCCOOGST').val(d.CCCOOGST);
////            $('#CCCOOGSTAmount').val(d.CCCOOGSTAmount);
////            $('#CCCOO_Total').val(d.CCCOO_Total);

////            $('#CCExamination_CFS').val(d.CCExamination_CFS);
////            $('#CCExamination_CFSGST').val(d.CCExamination_CFSGST);
////            $('#CCExamination_CFSGSTAmount').val(d.CCExamination_CFSGSTAmount);
////            $('#CCExamination_CFS_Total').val(d.CCExamination_CFS_Total);

////            $('#CCLift_on_Lift_off').val(d.CCLift_on_Lift_off);
////            $('#CCLift_on_Lift_offGST').val(d.CCLift_on_Lift_offGST);
////            $('#CCLift_on_Lift_offGSTAmount').val(d.CCLift_on_Lift_offGSTAmount);
////            $('#CCLift_on_Lift_off_Total').val(d.CCLift_on_Lift_off_Total);

////            $('#CCOthers').val(d.CCOthers);
////            $('#CCOthersGST').val(d.CCOthersGST);
////            $('#CCOthersGSTAmount').val(d.CCOthersGSTAmount);
////            $('#CCOthers_Total').val(d.CCOthers_Total);
////            $('#CCAmt_Before_GST').val(d.CCAmt_Before_GST);
////            $('#CCGST').val(d.CCGST);
////            $('#CC_total').val(d.CC_total);

////            // ================= FCS =================
////            $('#FCForwarder').val(d.FCForwarder);
////            $('#FCInvoice_No').val(d.FCInvoice_No);
////            $('#FCInvDate').val(d.FCInvDate);
////            $('#FCSFreight').val(d.FCSFreight);
////            $('#FCSFreight_GST').val(d.FCSFreight_GST);
////            $('#FCSFreight_GSTAmount').val(d.FCSFreight_GSTAmount);
////            $('#FCSFreight_Total').val(d.FCSFreight_Total);

////            $('#FCSTHC').val(d.FCSTHC);
////            $('#FCSTHC_GST').val(d.FCSTHC_GST);
////            $('#FCSTHC_GSTAmount').val(d.FCSTHC_GSTAmount);
////            $('#FCSTHC_Total').val(d.FCSTHC_Total);

////            $('#FCSBL').val(d.FCSBL);
////            $('#FCSBL_GST').val(d.FCSBL_GST);
////            $('#FCSBL_GSTAmount').val(d.FCSBL_GSTAmount);
////            $('#FCSBL_Total').val(d.FCSBL_Total);

////            $('#FCSSeal').val(d.FCSSeal);
////            $('#FCSSEAL_GST').val(d.FCSSEAL_GST);
////            $('#FCSSEAL_GSTAmount').val(d.FCSSEAL_GSTAmount);
////            $('#FCSSEAL_Total').val(d.FCSSEAL_Total);

////            $('#FCSVGM').val(d.FCSVGM);
////            $('#FCSVGM_GST').val(d.FCSVGM_GST);
////            $('#FCSVGM_GSTAmount').val(d.FCSVGM_GSTAmount);
////            $('#FCSVGM_Total').val(d.FCSVGM_Total);

////            $('#FCSMUC').val(d.FCSMUC);
////            $('#FCSMUC_GST').val(d.FCSMUC_GST);
////            $('#FCSMUC_GSTAmount').val(d.FCSMUC_GSTAmount);
////            $('#FCSMUC_Total').val(d.FCSMUC_Total);

////            $('#FCSITHC').val(d.FCSITHC);
////            $('#FCSITHC_GST').val(d.FCSITHC_GST);
////            $('#FCSITHC_GSTAmount').val(d.FCSITHC_GSTAmount);
////            $('#FCSITHC_Total').val(d.FCSITHC_Total);

////            $('#FCSDry_Port_charges').val(d.FCSDry_Port_charges);
////            $('#FCSDry_Port_charges_GST').val(d.FCSDry_Port_charges_GST);
////            $('#FCSDry_Port_charges_GSTAmount').val(d.FCSDry_Port_charges_GSTAmount);
////            $('#FCSDry_Port_charges_Total').val(d.FCSDry_Port_charges_Total);

////            $('#FCSAdministrative_charges').val(d.FCSAdministrative_charges);
////            $('#FCSAdministrative_charges_GST').val(d.FCSAdministrative_charges_GST);
////            $('#FCSAdministrative_charges_GSTAmount').val(d.FCSAdministrative_charges_GSTAmount);
////            $('#FCSAdministrative_charges_Total').val(d.FCSAdministrative_charges_Total);

////            $('#FCSSecurity_filling_fees').val(d.FCSSecurity_filling_fees);
////            $('#FCSSecurity_filling_fees_GST').val(d.FCSSecurity_filling_fees_GST);
////            $('#FCSSecurity_filling_fees_GSTAmount').val(d.FCSSecurity_filling_fees_GSTAmount);
////            $('#FCSSecurity_filling_fees_Total').val(d.FCSSecurity_filling_fees_Total);

////            $('#FCSOther').val(d.FCSOther);
////            $('#FCSOther_GST').val(d.FCSOther_GST);
////            $('#FCSOther_GSTAmount').val(d.FCSOther_GSTAmount);
////            $('#FCSOther_Total').val(d.FCSOther_Total);

////            $('#FCSAmt_Before_GST').val(d.FCSAmt_Before_GST);
////            $('#FCSGST').val(d.FCSGST);
////            $('#FCSTotal').val(d.FCSTotal);

////            // ================= FCA =================
////            $('#FCAAir_Freight').val(d.FCAAir_Freight);
////            $('#FCAAir_Freight_GST').val(d.FCAAir_Freight_GST);
////            $('#FCAAir_Freight_GSTAmount').val(d.FCAAir_Freight_GSTAmount);
////            $('#FCAAir_Freight_Total').val(d.FCAAir_Freight_Total);

////            $('#FCAMCC').val(d.FCAMCC);
////            $('#FCAMCC_GST').val(d.FCAMCC_GST);
////            $('#FCAMCC_GSTAmount').val(d.FCAMCC_GSTAmount);
////            $('#FCAMCC_Total').val(d.FCAMCC_Total);

////            $('#FCAX_Ray').val(d.FCAX_Ray);
////            $('#FCAX_Ray_GST').val(d.FCAX_Ray_GST);
////            $('#FCAX_Ray_GSTAmount').val(d.FCAX_Ray_GSTAmount);
////            $('#FCAX_Ray_Total').val(d.FCAX_Ray_Total);

////            $('#FCAMYC_Fuel').val(d.FCAMYC_Fuel);
////            $('#FCAMYC_Fuel_GST').val(d.FCAMYC_Fuel_GST);
////            $('#FCAMYC_Fuel_GSTAmount').val(d.FCAMYC_Fuel_GSTAmount);
////            $('#FCAMYC_Fuel_Total').val(d.FCAMYC_Fuel_Total);

////            $('#FCAAMS').val(d.FCAAMS);
////            $('#FCAAMS_GST').val(d.FCAAMS_GST);
////            $('#FCAAMS_GSTAmount').val(d.FCAAMS_GSTAmount);
////            $('#FCAAMS_Total').val(d.FCAAMS_Total);

////            $('#FCAAWB').val(d.FCAAWB);
////            $('#FCAAWB_GST').val(d.FCAAWB_GST);
////            $('#FCAAWB_GSTAmount').val(d.FCAAWB_GSTAmount);
////            $('#FCAAWB_Total').val(d.FCAAWB_Total);

////            $('#FCAPCA').val(d.FCAPCA);
////            $('#FCAPCA_GST').val(d.FCAPCA_GST);
////            $('#FCAPCA_GSTAmount').val(d.FCAPCA_GSTAmount);
////            $('#FCAPCA_Total').val(d.FCAPCA_Total);

////            $('#FCAOthers').val(d.FCAOthers);
////            $('#FCAOthers_GST').val(d.FCAOthers_GST);
////            $('#FCAOthers_GSTAmount').val(d.FCAOthers_GSTAmount);
////            $('#FCAOthers_Total').val(d.FCAOthers_Total);

////            $('#FCAAMT_before_GST').val(d.FCAAMT_before_GST);
////            $('#FCAGST').val(d.FCAGST);
////            $('#FCATotal').val(d.FCATotal);


////            // TC
////            $('#TC_Transporter').val(d.TC_Transporter);
////            $('#TC_Invoice_No').val(d.TC_Invoice_No);
////            $('#TC_InvDate').val(d.TC_InvDate);
////            $('#TC_Charges').val(d.TC_Charges);
////            $('#TCChargesGST').val(d.TCChargesGST);
////            $('#TCChargesGSTAmount').val(d.TCChargesGSTAmount);
////            $('#TCCharges_Total').val(d.TCCharges_Total);

////            $('#TC_VGM').val(d.TC_VGM);
////            $('#TCVGMGST').val(d.TCVGMGST);
////            $('#TCVGMGSTAmount').val(d.TCVGMGSTAmount);
////            $('#TCVGM_Total').val(d.TCVGM_Total);

////            $('#TC_Other').val(d.TC_Other);
////            $('#TCOtherGST').val(d.TCOtherGST);
////            $('#TCOtherGSTAmount').val(d.TCOtherGSTAmount);
////            $('#TCOther_Total').val(d.TCOther_Total);
////            $('#TC_AMT_Before_GST').val(d.TC_AMT_Before_GST);
////            $('#TC_GST').val(d.TC_GST);
////            $('#TC_Total').val(d.TC_Total);
////            // CFS
////            $('#CFS_Vendor').val(d.CFS_Vendor);
////            $('#CFS_Invoice_No').val(d.CFS_Invoice_No);
////            $('#CFS_InvDate').val(d.CFS_InvDate);
////            $('#CFS_Particulars').val(d.CFS_Particulars);
////            $('#CFS_Amt_Before_GST').val(d.CFS_Amt_Before_GST);
////            $('#CFS_GST').val(d.CFS_GST);
////            $('#CFS_Total').val(d.CFS_Total);
////            // AddTC
////            $('#AddTC_Transporter').val(d.AddTC_Transporter);
////            $('#AddTC_Invoice_No').val(d.AddTC_Invoice_No);
////            $('#AddTC_InvDate').val(d.AddTC_InvDate);
////            $('#AddTC_Charges').val(d.AddTC_Charges);
////            $('#AddTCChargesGST').val(d.AddTCChargesGST);
////            $('#AddTCChargesGSTAmount').val(d.AddTCChargesGSTAmount);
////            $('#AddTCCharges_Total').val(d.AddTCCharges_Total);

////            $('#AddTC_VGM').val(d.AddTC_VGM);
////            $('#AddTCVGMGST').val(d.AddTCVGMGST);
////            $('#AddTCVGMGSTAmount').val(d.AddTCVGMGSTAmount);
////            $('#AddTCVGM_Total').val(d.AddTCVGM_Total);

////            $('#AddTC_Other').val(d.AddTC_Other);
////            $('#AddTCOtherGST').val(d.AddTCOtherGST);
////            $('#AddTCOtherGSTAmount').val(d.AddTCOtherGSTAmount);
////            $('#AddTCOther_Total').val(d.AddTCOther_Total);

////            $('#AddTC_AMT_Before_GST').val(d.AddTC_AMT_Before_GST);
////            $('#AddTC_GST').val(d.AddTC_GST);
////            $('#AddTC_Total').val(d.AddTC_Total);

////            // COO
////            $('#COO_Vendor').val(d.COO_Vendor);
////            $('#COO_Invoice_No').val(d.COO_Invoice_No);
////            $('#COO_InvDate').val(d.COO_InvDate);
////            $('#COO_Particulars').val(d.COO_Particulars);
////            $('#COO_Amt_Before_GST').val(d.COO_Amt_Before_GST);
////            $('#COOGSTPercentage').val(d.COOGSTPercentage);
////            $('#COO_GST').val(d.COO_GST);
////            $('#COO_Total').val(d.COO_Total);

////            // EIA
////            $('#EIA_Vendor').val(d.EIA_Vendor);
////            $('#EIA_Invoice_No').val(d.EIA_Invoice_No);
////            $('#EIA_InvDate').val(d.EIA_InvDate);
////            $('#EIA_Particulars').val(d.EIA_Particulars);
////            $('#EIA_Amt_Before_GST').val(d.EIA_Amt_Before_GST);
////            $('#EIAGSTPercentage').val(d.EIAGSTPercentage);
////            $('#EIA_GST').val(d.EIA_GST);
////            $('#EIA_Total').val(d.EIA_Total);

////            // Document info
////            $('#Doc_ForwardedNo').val(d.Doc_ForwardedNo);
////            $('#Doc_Sent_Through').val(d.Doc_Sent_Through);
////            $('#Doc_Date').val(d.Doc_Date);
////            $('#Doc_Submitted_Account_On').val(d.Doc_Submitted_Account_On);
////            $('#Weight').val(d.Weight);
////            $('#Quntity_SQM').val(d.Quntity_SQM);
////            if (!d.Mode || d.Mode.trim() === "" || d.Mode==="ROAD") {
////                $('#Type').prop('disabled', true);
////                $('#Type').addClass("readonly");
////                $('#Type').css({ "filter": "grayscale(1)", "background-color": "#e9ecef" });
////            } else {
////                $('#Type').prop('disabled', false);
////                $('#Type').removeClass("readonly");
////                $('#Type').css({ "filter": "none", "background-color": "" });
////            }

////            if (d.Type || d.Type.trim() !== "") {
////                if (d.Type === "COURIER" || d.Type === "CONSIGNMENT") {
////                    $('#Type').prop('disabled', true).addClass("readonly").css({
////                        "filter": "grayscale(1)",
////                        "background-color": "#e9ecef"
////                    });
////                }

////                $("#Type option").filter(function () {
////                    return $(this).text().trim() === d.Type.trim();
////                }).prop("selected", true);
////                $('#Type').closest('.form-group').find('span.required-startype').show();
////            }
////            else {
////            if (d.Mode && d.Mode.trim().toUpperCase() === "ROAD") {
////                d.Type = "";
////                var typeDropdown = $('#Type');
////                typeDropdown.empty();// force null/empty value
////                typeDropdown.append($('<option>').val('').text(''));
////                $('#Type').closest('.form-group').find('span.required-startype').hide();
////            }
////                else {
////                loadFCLByMode(d.Mode);
////                $('#Type').closest('.form-group').find('span.required-startype').show();
////                }
////                }


////            // $('#Type').val(d.Type);
////            if (d.Type && d.Type.trim() === "FCL") {
////                $('#No_of_FCL').prop('disabled', false);        // enable the field
////                $('#No_of_FCL').removeClass("readonly");        // remove readonly styling
////                $('#No_of_FCL').css({ "filter": "none", "background-color": "" }); // reset styles
////                $('#No_of_FCL').closest('.form-group').find('span.required-star').show();
////            } else {
////                $('#No_of_FCL').prop('disabled', true);         // disable if not FCL
////                $('#No_of_FCL').addClass("readonly");
////                $('#No_of_FCL').css({ "filter": "grayscale(1)", "background-color": "#e9ecef" });
////                $('#No_of_FCL').closest('.form-group').find('span.required-star').hide();
////            }
////            $('#No_of_FCL').val(d.No_of_FCL);
////            let finalSaveValue = d.finalsave;

////            let isFinalSave = String(finalSaveValue).toLowerCase() === "true";
////     function toggleFieldBasedOnValue(selector) {

////         if ($(selector).val() === "" || $(selector).val() === undefined || $(selector).val() === null ) {

////                    $(selector).prop('disabled', false);
////                    $(selector).removeClass("readonly");
////                    $(selector).css({ "filter": "none", "background-color": "" });
////                } else {

////                    $(selector).prop('disabled', true);
////                    $(selector).addClass("readonly");
////                 $(selector).css({
////                     "filter": "grayscale(1)", "background-color": "#e9ecef" });
////                }
////            }






////                toggleFieldBasedOnValue('#EPCG_Licence_No');
////                toggleFieldBasedOnValue('#invoiceDropdown');
////                toggleFieldBasedOnValue('#Shipping_Bill_No');
////                toggleFieldBasedOnValue('#Date2');
////                toggleFieldBasedOnValue('#AirWay_BillNo_Bill_of_LodingNo');
////                toggleFieldBasedOnValue('#AirWay_BillDate_Bill_of_LodingDate');

////                toggleFieldBasedOnValue('#Port_of_Loading');
////                toggleFieldBasedOnValue('#Port_of_Discharge');
////                toggleFieldBasedOnValue('#Inco_Terms');
////                toggleFieldBasedOnValue('#Remarks');
////                toggleFieldBasedOnValue('#Clearing_Point');


////            let otherChargesArray = d.OtherCharges || [];
////            let tbody = $('#chargesTable tbody');
////            tbody.empty(); // Clear previous
////            if (otherChargesArray.length === 0) {
////                // If otherChargesArray is empty, add one blank row
////                let row = `
////<tr style="font-size: 15px;">
////    <td class="sr-no">1</td>
////    <td><input type="text" class="form-control oc-vendor" name="OtherCharges[0].OC_Vendor" value="" /></td>
////    <td><input type="text" class="form-control oc-invoice-no" name="OtherCharges[0].OC_Invoice_No" value="" /></td>
////    <td><input type="text" class="form-control oc-invdate" name="OtherCharges[0].OC_InvDate" value="" placeholder="dd/mm/yy" /></td>
////    <td><input type="text" class="form-control oc-particulars" name="OtherCharges[0].OC_Particulars" value="" /></td>
////    <td><input type="text" class="form-control oc-amt-before-gst" name="OtherCharges[0].OC_Amt_Before_GST" style = "text-align:right;" value="0.00" placeholder="0.00" /></td>
////    <td><input type="text" class="form-control oc-gstPercentage" name="OtherCharges[0].OC_GSTPercentage" value="0.00" style = "text-align:right;" placeholder="0.00" /></td>
////    <td><input type="text" class="form-control oc-gstAmount" name="OtherCharges[0].OC_GSTAmount" value="0.00" style = "text-align:right;" readonly placeholder="0.00" /></td>
////    <td><input type="text" class="form-control oc-total" name="OtherCharges[0].OC_Total" value="0.00" style = "text-align:right;" readonly placeholder="0.00" /></td>
////    <td style="display: none;"><input type="text" class="form-control oc-rowid" name="OtherCharges[0].OC_RowId" value="" readonly /></td>
////    <td><button type="button" class="btn btn-danger" onclick="removeRow(this)"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
////</tr>`;
////                tbody.append(row);
////            } else {
////                // Dynamically build rows
////                otherChargesArray.forEach(function (item, index) {
////                                      let row = `
////<tr style="font-size: 15px;">
////    <td class="sr-no">${index + 1}</td>
////    <td><input type="text" class="form-control oc-vendor" name="OtherCharges[${index}].OC_Vendor" value="${item.OC_Vendor || ''}" /></td>
////    <td><input type="text" class="form-control oc-invoice-no" name="OtherCharges[${index}].OC_Invoice_No" value="${item.OC_Invoice_No || ''}" /></td>
////    <td><input type="text" class="form-control oc-invdate" name="OtherCharges[${index}].OC_InvDate" value="${item.OC_InvDate || ''}" placeholder="dd/mm/yy" /></td>
////    <td><input type="text" class="form-control oc-particulars" name="OtherCharges[${index}].OC_Particulars" value="${item.OC_Particulars || ''}" /></td>
////    <td><input type="text" class="form-control oc-amt-before-gst" name="OtherCharges[${index}].OC_Amt_Before_GST" style = "text-align:right;" value="${item.OC_Amt_Before_GST || ''}" placeholder="0.00" /></td>
////    <td><input type="text" class="form-control oc-gstPercentage" name="OtherCharges[${index}].OC_GSTPercentage" value="${item.OC_GSTPercentage || ''}" style = "text-align:right;" placeholder="0.00" /></td>
////    <td><input type="text" class="form-control oc-gstAmount" name="OtherCharges[${index}].OC_GSTAmount" value="${item.OC_GSTAmount || ''}" style = "text-align:right;" readonly placeholder="0.00" /></td>
////    <td><input type="text" class="form-control oc-total" name="OtherCharges[${index}].OC_Total"  style = "text-align:right;" value="${item.OC_Total || ''}" readonly placeholder="0.00" /></td>
////    <td style="display:none;"><input type="text" class="form-control oc-rowid" name="OtherCharges[${index}].OC_RowId" value="${item.OC_RowId || ''}" readonly /></td>
////    <td><button type="button" class="btn btn-danger" onclick="removeRow(this)"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
////</tr>`;
////                    tbody.append(row);

////                });
////            }
////            let cfsotherChargesArray = (d.CFSOtherCharges && Array.isArray(d.CFSOtherCharges)) ? d.CFSOtherCharges : [];
////            // ================= OTHER CHARGES TABLE =================
////            let tbody1 = $('#CfschargesTable tbody');
////            tbody1.empty();

////            let fixedServices = [
////                "Other/Private Yard LoLo Charges",
////                "Terminal Handling Charges",
////                "Rail Freight Charges",
////                "Others Support Ser.Infrastructure & Devel.Charges"
////            ];

////            if (cfsotherChargesArray.length === 0) {
////                tbody1.empty();
////                fixedServices.forEach(function (serviceName, index) {
////                    let row1 = `
////<tr >
////    <td class="sr-no">${index + 1}</td>
////    <td><input class="form-control cfs-nature_of_service" name="CFSOtherCharges[0].Nature_of_Service"  value="${serviceName}" /></td>
////    <td><input class="form-control cfs_amtbeforegst" name="CFSOtherCharges[0].AmtBeforeGST"  style = "text-align:right;" placeholder="0.00" /></td>
////    <td><input class="form-control cfs_gstpercentage" name="CFSOtherCharges[0].GstPercentage" style = "text-align:right;" placeholder="0" /></td>
////    <td><input class="form-control cfs_gstAmount" name="CFSOtherCharges[0].GstAmount" style = "text-align:right;" placeholder="0.00" readonly /></td>
////    <td><input class="form-control cfs_total" name="CFSOtherCharges[0].Total" style = "text-align:right;" placeholder="0.00" readonly /></td>
////    <td style="display:none"><input class="form-control cfs_rowid" name="CFSOtherCharges[0].Cfs_RowId" readonly /></td>
////    <td><button type="button" class="btn btn-danger" onclick="removeRow2(this)" ><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
////</tr>
////`;
////                    tbody1.append(row1);
////                });
////                let grandTotalRow = `
////<tr >
////    <td></td>
////    <td>Grand Total</td>
////    <td><input class="form-control" id="CFS_Amt_Before_GST" name="CFS_Amt_Before_GST" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>
////    <td></td>
////    <td><input class="form-control" id="CFS_GST" name="CFS_GST" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>
////    <td><input class="form-control" id="CFS_Total" name="CFS_Total" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>

////    <td></td>
////</tr>`;

////                // Append Save Button Row
////                let saveButtonRow = `
////<tr>
////    <td colspan="6" style="text-align:end;">
////        <a href="#" id="lnkUpdateCfsOC" class="btn" style="font-size: 15px; background-color: #339be1; color: white; width: 7%;">
////            <i class="fa fa-eraser"></i> Save
////        </a>
////    </td>
////    <td></td>
////</tr>`;
////                tbody1.append(grandTotalRow);
////                tbody1.append(saveButtonRow);
////                calculateCfsGrandTotals();
////            }
////            else {
////                if (cfsotherChargesArray.length > 0) {
////                    tbody1.empty();
////                    cfsotherChargesArray.forEach(function (item, index) {

////                        let row1 = `
////<tr >
////    <td class="sr-no">${index + 1}</td>
////    <td><input class="form-control cfs-nature_of_service" name="CFSOtherCharges[${index}].Nature_of_Service"   value="${item.Nature_of_Service || ''}" /></td>
////    <td><input class="form-control cfs_amtbeforegst" name="CFSOtherCharges[${index}].AmtBeforeGST" style = "text-align:right;" placeholder="0.00" value="${item.AmtBeforeGST || ''}"/></td>
////    <td><input class="form-control cfs_gstpercentage" name="CFSOtherCharges[${index}].GstPercentage" style = "text-align:right;" placeholder="0" value="${item.GstPercentage || ''}"/></td>
////    <td><input class="form-control cfs_gstAmount" name="CFSOtherCharges[${index}].GstAmount" style = "text-align:right;" placeholder="0.00" readonly     value="${item.GstAmount || ''}"/></td>
////    <td><input class="form-control cfs_total" name="CFSOtherCharges[${index}].Total"  style = "text-align:right;" placeholder="0.00" readonly  value="${item.Total || ''}"/></td>
////    <td style="display:none"><input class="form-control cfs_rowid" name="CFSOtherCharges[${index}].Cfs_RowId" readonly   value="${item.Cfs_RowId || ''}"/></td>
////    <td><button type="button" class="btn btn-danger" onclick="removeRow2(this)"><i class="fa fa-minus" style="margin-left:0;"></i></button></td>
////</tr>`;
////                        tbody1.append(row1);
////                    });
////                    let grandTotalRow = `
////<tr>
////    <td></td>
////    <td>Grand Total</td>
////    <td><input class="form-control" id="CFS_Amt_Before_GST" name="CFS_Amt_Before_GST" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>
////    <td></td>
////    <td><input class="form-control" id="CFS_GST" name="CFS_GST" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>
////    <td><input class="form-control" id="CFS_Total" name="CFS_Total" readonly style="text-align:right;" placeholder="0.00" value="0.00" /></td>

////    <td></td>
////</tr>`;

////                    // Append Save Button Row
////                    let saveButtonRow = `
////<tr>
////    <td colspan="6" style="text-align:end;">
////        <a href="#" id="lnkUpdateCfsOC" class="btn" style="font-size: 15px; background-color: #339be1; color: white; width: 7%;">
////            <i class="fa fa-eraser"></i> Save
////        </a>
////    </td>
////    <td></td>
////</tr>`;
////                    tbody1.append(grandTotalRow);
////                    tbody1.append(saveButtonRow);
////                    calculateCfsGrandTotals();
////                }
////            }
////            initializeDatePickers();
////            if (d.finalsave) {
////                $('#Type').prop('disabled', true).addClass("readonly").css({
////                    "filter": "grayscale(1)",
////                    "background-color": "#e9ecef"
////                });
////                $('#No_of_FCL').prop('disabled', true).addClass("readonly").css({
////                    "filter": "grayscale(1)",
////                    "background-color": "#e9ecef"
////                });
////                // 1. Disable all form fields globally
////                $('input[type="text"], input[type="date"], input[type="number"], select, textarea').prop('disabled', true);

////                // 2. Loop through each panel
////                document.querySelectorAll(".panel").forEach(panel => {
////                    const isInvoicePanel = panel.id === "InvoiceDetailsPanel";
////                    const content = panel.querySelector(".toggle-content");
////                    const icon = panel.querySelector(".toggle-icon");

////                    if (isInvoicePanel) {
////                        // ✅ Keep this panel OPEN
////                        if (content) content.style.display = "block"; // or "" depending on your CSS
////                        if (icon) {
////                            icon.classList.remove("fa-plus");
////                            icon.classList.add("fa-minus");
////                            icon.style.transform = "rotate(180deg)";
////                        }
////                    } else {
////                        // ❌ Close all other panels
////                        if (content) content.style.display = "none";
////                        if (icon) {
////                            icon.classList.remove("fa-minus");
////                            icon.classList.add("fa-plus");
////                            icon.style.transform = "rotate(0deg)";
////                        }
////                    }

////                    // 3. Disable all fields inside each panel
////                    panel.querySelectorAll("input, select, textarea, button").forEach(field => {
////                        field.disabled = true;
////                    });
////                });
////                    const panels = document.querySelectorAll(".panel");
////                    panels.forEach(panel => {
////                        const heading = panel.querySelector(".panel-heading span");
////                        if (heading && heading.textContent.trim() === "Document Details") {
////                            panel.querySelectorAll("input, select, textarea, button").forEach(field => {
////                                field.disabled = false;
////                            });

////                            // Expand the panel
////                            const icon = panel.querySelector(".toggle-icon");
////                            if (icon) {
////                                icon.classList.remove("fa-minus");
////                                icon.classList.add("fa-plus");
////                                icon.style.transform = "rotate(0deg)";
////                            }
////                        }

////                });
           // }
});


        $('#TblExportTrackerInfo tbody, TblAccountsInfo tbody').on('click', 'tr', function () {
    var table = $(this).closest('table');
    table.find('tbody tr').removeClass('selected');
    $(this).addClass('selected');
});
    }
    function initializeDatePickers() {
        $('.oc-invdate,.oc-advpaymenton,.oc-BLinvdate,.oc-paymentdate,oc-bladvpaymenton,oc-blpaymentdate').datepicker({
            dateFormat: 'dd/mm/yy',
            changeMonth: true,
            changeYear: true
        });

    }
    function clearDetailsForm() {
        const detailTab = document.querySelector('#tabDetail');

        if (detailTab) {

            detailTab.querySelectorAll('input[type="text"], input[type="number"], input[type="date"], textarea').forEach(el => el.value = '');

            detailTab.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
            document.getElementById("Inco_Terms").value = "";

            detailTab.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(el => el.checked = false);
        }
    }
    function formatToDDMMYY(dateStr) {
        const date = new Date(dateStr);
        if (isNaN(date)) return '';

        const dd = String(date.getDate()).padStart(2, '0');
        const mm = String(date.getMonth() + 1).padStart(2, '0');
        const yy = String(date.getFullYear()).slice(-2);

        return `${dd}/${mm}/${yy}`;
    }

        function GetData() {
            getgriddetails();
            //refreshLnkDetailPage();
    }
    function showDatePicker(inputElement) {
        var datePicker1 = Ext.create('Ext.picker.Date', {
            renderTo: Ext.getBody(),
            floating: true,
            format: 'd/m/Y',
            listeners: {

                select: function (picker, date) {

                    inputElement.value = Ext.Date.format(date, 'd/m/y');

                    picker.hide();
                },
                hide: function () {

                },
                blur: function () {
                    datePicker1.hide();
                }
            }
        });

        var inputPosition = inputElement.getBoundingClientRect();
        var x = inputPosition.left - 200;
        var y = inputPosition.top + inputPosition.height;


        datePicker1.showAt(x, y);
        Ext.getBody().on('click', function (event) {

            if (!datePicker1.el.contains(event.target) && event.target !== inputElement) {
                datePicker1.hide();
            }
        });
    }
    function toggleForwarderType(type) {
        document.getElementById("airSection").style.display = (type === "air") ? "block" : "none";
        document.getElementById("seaSection").style.display = (type === "sea") ? "block" : "none";
    }
    function calculateDueDate() {

        var blDateStr = $('#AirWay_BillDate_Bill_of_LodingDate').val();
        var paymentTerms = $('#Payment_Terms').val();

        if (!blDateStr || !paymentTerms) {
            $('#Due_Date').val('');
            return;
        }

        if (!paymentTerms.toUpperCase().includes('BL')) {
            //$('#Due_Date').val('');
            return;
        }

        var days = parseInt(paymentTerms.replace(/\D/g, ''));

        if (isNaN(days)) {
            $('#Due_Date').val('');
            return;
        }

        var parts = blDateStr.split('/');
        var day = parseInt(parts[0], 10);
        var month = parseInt(parts[1], 10) - 1;
        var year = parseInt(parts[2], 10);

        year = year < 100 ? 2000 + year : year;

        var blDate = new Date(year, month, day);

        blDate.setDate(blDate.getDate() + days);

        var dueDate =
            String(blDate.getDate()).padStart(2, '0') + '/' +
            String(blDate.getMonth() + 1).padStart(2, '0') + '/' +
            String(blDate.getFullYear()).slice(-2);

        $('#Due_Date').val(dueDate);
    }
    $(document).ready(function () {
        $("#Date1,#Date2,#Date3,#CFS_InvDate,#FCInvDate,#AdvPaymenton,#PaymentDate,#COO_InvDate,#TC_InvDate,#AddTCAdvPaymentOn,#AddTCPaymentDate,#AddTC_InvDate,#EIA_InvDate,#OC_InvDate,#Doc_Date,#OCAdvPaymenton,#OCPaymentDate,#Doc_Submitted_Account_On").datepicker({
            dateFormat: "dd/mm/yy"

        });

        $("#AirWay_BillDate_Bill_of_LodingDate").datepicker({
            format: "dd/mm/yy"
        }).on("changeDate clearDate change", function () {
            
            var paymentTerms = $('#Payment_Terms').val();

            if (paymentTerms && paymentTerms.toUpperCase().includes('BL')) {
                calculateDueDate();
            }

        });

        $(".oc-advpaymenton,.oc-paymentdate,.oc-bladvpaymenton,.oc-blpaymentdate").datepicker({
            dateFormat: "dd/mm/yy"

        });
    });
    $('#chargesTable').on('keyup', 'input', function () {
        updateOtherChargesSummary();
    });
    $('#BLchargesTable').on('keyup', 'input', function () {
        updateOtherChargesSummary();
    });
    $('#CfschargesTable').on('keyup', 'input', function () {
        updateCFSOtherChargesSummary();
    });
    function updateOtherChargesSummary() {
        const placeholder = $('#oc-row-placeholder');
        placeholder.hide();

        const tbody = $('#chargesSummaryTable tbody');
        const totalRow = $('#tr_total');

        // Clear previous rows
        tbody.find('.oc-summary-row, .oc-BLsummary-row').remove();
        tbody.find('.oc-summary-grandtotal').remove();

        let rowCount = 1;
        const uniqueCharges = new Map();

        // ✅ 1️⃣ Add Other Charges first
        $('#chargesTable tbody tr').each(function () {
            const vendor = $(this).find('.oc-vendor').val()?.trim();

            if (vendor) {
                const amtInput = $(this).find('.oc-amt-before-gst').val()?.replace(/,/g, '');
                const gstInput = $(this).find('.oc-gstAmount').val();
                const totalInput = $(this).find('.oc-total').val();

                if (!amtInput || !gstInput || !totalInput) return;

                const amt = parseFloat(amtInput) || 0;
                const gst = parseFloat(gstInput) || 0;
                const total = parseFloat(totalInput) || 0;

                const key = vendor.toLowerCase();
                let existingRow = tbody.find(`tr[data-vendor="${key}"][data-type="oc"]`);

                if (!existingRow.length) {
                    const newRow = `
                    <tr class="oc-summary-row" data-vendor="${key}" data-type="oc">
                        <td>${rowCount}</td>
                        <td>Other Charges</td>
                        <td id="amount"><span class="td-amt">${amt.toFixed(2)}</span></td>
                        <td id="amount"><span class="td-gst">${gst.toFixed(2)}</span></td>
                        <td id="amount"><span class="td-total">${total.toFixed(2)}</span></td>
                    </tr>`;
                    totalRow.before(newRow);
                    rowCount++;
                    uniqueCharges.set("oc-" + key, { amt, gst, total });
                } else {
                    const prev = uniqueCharges.get("oc-" + key) || { amt: 0, gst: 0, total: 0 };
                    const newValues = {
                        amt: prev.amt + amt,
                        gst: prev.gst + gst,
                        total: prev.total + total
                    };
                    uniqueCharges.set("oc-" + key, newValues);

                    existingRow.find('.td-amt').text(newValues.amt.toFixed(2));
                    existingRow.find('.td-gst').text(newValues.gst.toFixed(2));
                    existingRow.find('.td-total').text(newValues.total.toFixed(2));
                }
            }
        });

        // ✅ 2️⃣ Add BL Surrender Charges AFTER all Other Charges
        $('#BLchargesTable tbody tr').each(function () {
            const vendor = $(this).find('.oc-BLvendor').val()?.trim();

            if (vendor) {
                const amtInput = $(this).find('.oc-BLamt-before-gst').val()?.replace(/,/g, '');
                const gstInput = $(this).find('.oc-BLgstAmount').val();
                const totalInput = $(this).find('.oc-BLtotal').val();

                if (!amtInput || !gstInput || !totalInput) return;

                const amt = parseFloat(amtInput) || 0;
                const gst = parseFloat(gstInput) || 0;
                const total = parseFloat(totalInput) || 0;

                const key = vendor.toLowerCase();
                let existingRow = tbody.find(`tr[data-vendor="${key}"][data-type="bl"]`);

                if (!existingRow.length) {
                    const newRow = `
                    <tr class="oc-BLsummary-row" data-vendor="${key}" data-type="bl">
                        <td>${rowCount}</td>
                        <td>BL Surrender Charges</td>
                        <td id="amount"><span class="td-amt">${amt.toFixed(2)}</span></td>
                        <td id="amount"><span class="td-gst">${gst.toFixed(2)}</span></td>
                        <td id="amount"><span class="td-total">${total.toFixed(2)}</span></td>
                    </tr>`;

                    // ✅ Find the last "Other Charges" row, insert after it
                    const lastOCRow = tbody.find('tr.oc-summary-row:last');
                    if (lastOCRow.length) {
                        lastOCRow.after(newRow);
                    } else {
                        totalRow.before(newRow);
                    }

                    rowCount++;
                    uniqueCharges.set("bl-" + key, { amt, gst, total });
                } else {
                    const prev = uniqueCharges.get("bl-" + key) || { amt: 0, gst: 0, total: 0 };
                    const newValues = {
                        amt: prev.amt + amt,
                        gst: prev.gst + gst,
                        total: prev.total + total
                    };
                    uniqueCharges.set("bl-" + key, newValues);

                    existingRow.find('.td-amt').text(newValues.amt.toFixed(2));
                    existingRow.find('.td-gst').text(newValues.gst.toFixed(2));
                    existingRow.find('.td-total').text(newValues.total.toFixed(2));
                }
            }
        });

        // ✅ Update totals & numbering
        updateTotalRow();
        updateChargeRowsVisibilityAndSerialNumbers();
    }

/*    function updateOtherChargesSummary() {
    const placeholder = $('#oc-row-placeholder');
    placeholder.hide();

    const tbody = $('#chargesSummaryTable tbody');
    const totalRow = $('#tr_total');

    tbody.find('.oc-summary-row').not('#oc-row-placeholder').remove();
    tbody.find('.oc-summary-grandtotal').remove();

    let rowCount = $('#chargesSummaryTable tbody tr').length > 1 ? $('#chargesSummaryTable tbody tr').length : 9;

    const uniqueCharges = new Map();

    $('#chargesTable tbody tr').each(function () {
        const vendor = $(this).find('.oc-vendor').val()?.trim();

        if (vendor !== "") {
            const amtInput = $(this).find('.oc-amt-before-gst').val()?.replace(/,/g, '');
            const gstInput = $(this).find('.oc-gstAmount').val();
            const totalInput = $(this).find('.oc-total').val();

            if (!amtInput || !gstInput || !totalInput) {
                console.warn('Missing values in row:', $(this));
                return;
            }

            const amt = parseFloat(amtInput) || 0;
            const gst = parseFloat(gstInput) || 0;
            const total = parseFloat(totalInput) || 0;

            const key = vendor.toLowerCase();
            let existingRow = $('#chargesSummaryTable tbody tr').filter(function () {
                return $(this).data("vendor") === key;
            });

            if (!existingRow.length) {

                const newRow = `
                <tr class="oc-summary-row" data-vendor="${key}">
                    <td>${rowCount}</td>
                    <td>Other Charges</td>
                    <td id="amount"><span class="td-amt">${amt.toFixed(2)}</span></td>
                    <td id="amount"><span class="td-gst">${gst.toFixed(2)}</span></td>
                    <td id="amount"><span class="td-total">${total.toFixed(2)}</span></td>
                </tr>
                `;
               // $('#chargesSummaryTable tbody tr:nth-last-child(2)').after(newRow);
                $('#tr_total').before(newRow);
                rowCount++;
                uniqueCharges.set(key, { amt, gst, total });
            } else {

                const prev = uniqueCharges.get(key) || { amt: 0, gst: 0, total: 0 };
                const newValues = {
                    amt: prev.amt + amt,
                    gst: prev.gst + gst,
                    total: prev.total + total
                };
                uniqueCharges.set(key, newValues);

                existingRow.find('.td-amt').text(newValues.amt.toFixed(2));
                existingRow.find('.td-gst').text(newValues.gst.toFixed(2));
                existingRow.find('.td-total').text(newValues.total.toFixed(2));
            }
        }
    });
        $('#BLchargesTable tbody tr').each(function () {
        const vendor = $(this).find('.oc-BLvendor').val()?.trim();

        if (vendor !== "") {
            const amtInput = $(this).find('.oc-BLamt-before-gst').val()?.replace(/,/g, '');
            const gstInput = $(this).find('.oc-BLgstAmount').val();
            const totalInput = $(this).find('.oc-BLtotal').val();

            if (!amtInput || !gstInput || !totalInput) {
                console.warn('Missing values in row:', $(this));
                return;
            }

            const amt = parseFloat(amtInput) || 0;
            const gst = parseFloat(gstInput) || 0;
            const total = parseFloat(totalInput) || 0;

            const key = vendor.toLowerCase();
            let existingRow = $('#chargesSummaryTable tbody tr').filter(function () {
                return $(this).data("vendor") === key;
            });

            if (!existingRow.length) {

                const newRow = `
                <tr class="oc-BLsummary-row" data-vendor="${key}">
                    <td>${rowCount}</td>
                    <td>BL Surrender Charges</td>
                    <td id="amount"><span class="td-amt">${amt.toFixed(2)}</span></td>
                    <td id="amount"><span class="td-gst">${gst.toFixed(2)}</span></td>
                    <td id="amount"><span class="td-total">${total.toFixed(2)}</span></td>
                </tr>
                `;
               // $('#chargesSummaryTable tbody tr:nth-last-child(2)').after(newRow);
                $('#tr_total').before(newRow);
                rowCount++;
                uniqueCharges.set(key, { amt, gst, total });
            } else {

                const prev = uniqueCharges.get(key) || { amt: 0, gst: 0, total: 0 };
                const newValues = {
                    amt: prev.amt + amt,
                    gst: prev.gst + gst,
                    total: prev.total + total
                };
                uniqueCharges.set(key, newValues);

                existingRow.find('.td-amt').text(newValues.amt.toFixed(2));
                existingRow.find('.td-gst').text(newValues.gst.toFixed(2));
                existingRow.find('.td-total').text(newValues.total.toFixed(2));
            }
        }
    });



    updateTotalRow();
    updateChargeRowsVisibilityAndSerialNumbers();
}*/









    function updateTotalRow() {

        let totalAmount = 0;
        let totalGST = 0;
        let grandTotal = 0;

        $('#chargesSummaryBody .oc-summary-row').each(function () {
            const amount = parseFloat($(this).find('.td-amt').text().trim()) || 0;
            const gst = parseFloat($(this).find('.td-gst').text().trim()) || 0;
            const total = parseFloat($(this).find('.td-total').text().trim()) || 0;

            totalAmount += amount;
            totalGST += gst;
            grandTotal += total;
        });
        $('#chargesSummaryBody .oc-BLsummary-row').each(function () {
            const amount = parseFloat($(this).find('.td-amt').text().trim()) || 0;
            const gst = parseFloat($(this).find('.td-gst').text().trim()) || 0;
            const total = parseFloat($(this).find('.td-total').text().trim()) || 0;

            totalAmount += amount;
            totalGST += gst;
            grandTotal += total;
        });

        $('#tr_total .td-amt').text(totalAmount.toFixed(2));
        $('#tr_total .td-gst').text(totalGST.toFixed(2));
        $('#tr_total .td-total').text(grandTotal.toFixed(2));

    }







    function updateChargeRowsVisibilityAndSerialNumbers() {

        let srNo = 1;
        let amtBeforeGstTotal = 0;
        let gstTotal = 0;
        let grandTotal = 0;

        const rows = document.querySelectorAll('#chargesSummaryTable tbody tr');
        const totalRow = document.getElementById('tr_total');
        const totalAmtBeforeGST = document.getElementById('td_amt_before_gst');
        const totalGST = document.getElementById('td_GST');
        const totalCell = document.getElementById('td_Total');
        total = totalCell;
        rows.forEach((row) => {



            if (/*row.id === 'tr_total' ||*/ row.id === 'oc-row-placeholder') {
                row.style.display = 'none';
                return;
            }
            if (row.id !== 'tr_total' && row.id !== 'tr_FCL' && row.id !== 'tr_sqm') {
                row.style.display = ''; // Show valid rows

                const spans = row.querySelectorAll('span');
                if (spans.length >= 3) {
                    const amt = parseFloat(spans[0]?.textContent || '0') || 0;
                    const gst = parseFloat(spans[1]?.textContent || '0') || 0;
                    const total = parseFloat(spans[2]?.textContent || '0') || 0;

                    amtBeforeGstTotal += amt;
                    gstTotal += gst;
                    grandTotal += total;
                }

                const srCell = row.querySelector('td:first-child');
                if (srCell) srCell.textContent = srNo++;
            }
        });


        totalRow.style.display = '';
        totalAmtBeforeGST.textContent = amtBeforeGstTotal.toFixed(2);
        totalGST.textContent = gstTotal.toFixed(2);
        totalCell.textContent = grandTotal.toFixed(2);

        //const totalSrCell = totalRow.querySelector('td:first-child');
        //if (totalSrCell) totalSrCell.textContent = srNo;

        //totalRow.querySelector('td:first-child').textContent = srNo++;
        //document.querySelector('#tr_FCL td:first-child').textContent = srNo++;
        //document.querySelector('#tr_sqm td:first-child').textContent = srNo++;
        if (totalRow) {
            totalRow.querySelector('td:first-child').textContent = srNo++;
        }
        const fclRow = document.getElementById('tr_FCL');
        if (fclRow) {
            fclRow.querySelector('td:first-child').textContent = srNo++;
        }
        const sqmRow = document.getElementById('tr_sqm');
        if (sqmRow) {
            sqmRow.querySelector('td:first-child').textContent = srNo++;
        }
        calculateAvgCosts(amtBeforeGstTotal, gstTotal, grandTotal);
    }



    function calculateAvgCosts(amtBeforeGstTotal, gstTotal,grandTotal) {

        const totalFCL = parseFloat($('#No_of_FCL').val()) || 0; // assuming you have a textbox/input with FCL count
        const totalSQM = parseFloat($('#Quntity_SQM').val()) || 0; // assuming you have total sqm field

        let avgFCL = 0;
        let avgfclamt_before_gst = 0;
        let avgfcl_gst = 0;
        let avgSQM = 0;
        let avgsqmamt_before_gst = 0;
        let avgsqm_gst = 0;

        if (totalFCL > 0) {
            avgfclamt_before_gst = amtBeforeGstTotal / totalFCL
            avgfcl_gst = gstTotal / totalFCL
            avgFCL = grandTotal / totalFCL;
        }
        if (totalSQM > 0) {

            avgsqmamt_before_gst = amtBeforeGstTotal / totalSQM;
            avgsqm_gst = gstTotal / totalSQM;
            avgSQM = grandTotal / totalSQM;
        }

        $('#td_avgsqmamt_before_gst').text(avgsqmamt_before_gst.toFixed(2));
        $('#td_avgsqm_gst').text(avgsqm_gst.toFixed(2));
        $('#td_avgsqm').text(avgSQM.toFixed(2));

        $('#td_avgfclamt_before_gst').text(avgfclamt_before_gst.toFixed(2));
        $('#td_avgfcl_gst').text(avgfcl_gst.toFixed(2));
        $('#td_avgfcl_total').text(avgFCL.toFixed(2));
    }

    function toggleDetails(clickedHeader) {
        const panel = clickedHeader.closest('.panel');
        const content = panel.querySelector('.toggle-content');
        const icon = panel.querySelector('.toggle-icon');
        const isVisible = content.style.display === 'block';

        if (isVisible) {

            content.style.display = 'none';
            icon.classList.remove('fa-minus');
            icon.classList.add('fa-plus');
            icon.style.transform = icon.classList.contains('fa-minus') ? 'rotate(180deg)' : 'rotate(0deg)';
        } else {

            document.querySelectorAll('.panel').forEach(p => {
                const otherContent = p.querySelector('.toggle-content');
                const otherIcon = p.querySelector('.toggle-icon');
                if (otherContent && otherContent !== content) {
                    otherContent.style.display = 'none';
                    otherIcon.classList.remove('fa-minus');
                    otherIcon.classList.add('fa-plus');
                    otherIcon.style.transform = icon.classList.contains('fa-minus') ? 'rotate(180deg)' : 'rotate(0deg)';
                }
            });


            content.style.display = 'block';
            icon.classList.remove('fa-plus');
            icon.classList.add('fa-minus');
            icon.style.transform = icon.classList.contains('fa-minus') ? 'rotate(180deg)' : 'rotate(0deg)';
            document.getElementById("td_CCAmt_Before_GST").textContent = document.getElementById("CCAmt_Before_GST")?.value || "0.00";
            document.getElementById("td_CCGST").textContent = document.getElementById("CCGST")?.value || "0.00";
            document.getElementById("td_CC_total").textContent = document.getElementById("CC_total")?.value || "0.00";

            document.getElementById("td_FCSAmt_Before_GST").textContent = document.getElementById("FCSAmt_Before_GST")?.value || "0.00";
            document.getElementById("td_FCSGST").textContent = document.getElementById("FCSGST")?.value || "0.00";
            document.getElementById("td_FCSTotal").textContent = document.getElementById("FCSTotal")?.value || "0.00";

            document.getElementById("td_FCAAMT_before_GST").textContent = document.getElementById("FCAAMT_before_GST")?.value || "0.00";
            document.getElementById("td_FCAGST").textContent = document.getElementById("FCAGST")?.value || "0.00";
            document.getElementById("td_FCATotal").textContent = document.getElementById("FCATotal")?.value || "0.00";


            document.getElementById("td_TC_AMT_Before_GST").textContent = document.getElementById("TC_AMT_Before_GST")?.value || "0.00";
            document.getElementById("td_TC_GST").textContent = document.getElementById("TC_GST")?.value || "0.00";
            document.getElementById("td_TC_Total").textContent = document.getElementById("TC_Total")?.value || "0.00";
            document.getElementById("td_CFS_Amt_Before_GST").textContent = document.getElementById("CFS_Amt_Before_GST")?.value || "0.00";
            document.getElementById("td_CFS_GST").textContent = document.getElementById("CFS_GST")?.value || "0.00";
            document.getElementById("td_CFS_Total").textContent = document.getElementById("CFS_Total")?.value || "0.00";
            document.getElementById("td_AddTC_AMT_Before_GST").textContent = document.getElementById("AddTC_AMT_Before_GST")?.value || "0.00";
            document.getElementById("td_AddTC_GST").textContent = document.getElementById("AddTC_GST")?.value || "0.00";
            document.getElementById("td_AddTC_Total").textContent = document.getElementById("AddTC_Total")?.value || "0.00";

            document.getElementById("td_COO_Amt_Before_GST").textContent = document.getElementById("COO_Amt_Before_GST")?.value || "0.00";
            document.getElementById("td_COO_GST").textContent = document.getElementById("COO_GST")?.value || "0.00";
            document.getElementById("td_COO_Total").textContent = document.getElementById("COO_Total")?.value || "0.00";
            document.getElementById("td_EIA_Amt_Before_GST").textContent = document.getElementById("EIA_Amt_Before_GST")?.value || "0.00";
            document.getElementById("td_EIA_GST").textContent = document.getElementById("EIA_GST")?.value || "0.00";
            document.getElementById("td_EIA_Total").textContent = document.getElementById("EIA_Total")?.value || "0.00";

            updateChargeRowsVisibilityAndSerialNumbers();
            updateOtherChargesSummary();
            calculateCfsGrandTotals();
        }
    }
    $(document).ready(function () {


        $('#chargesTable tbody tr').each(function () {
            attachCalculationHandlers(this);
        });

        $('#BLchargesTable tbody tr').each(function () {
            attachCalculationHandlers(this);
        });
        $('#CfschargesTable tbody tr').each(function () {
            attachCalculationHandlers(this);
        });
        $('#CfschargesTable').on('keyup', '.cfs_amtbeforegst, .cfs_gstpercentage', function () {
            const rowElement = $(this).closest('tr');


            const amt = parseFloat(rowElement.find('.cfs_amtbeforegst').val()) || 0;
            const gstPercent = parseFloat(rowElement.find('.cfs_gstpercentage').val()) || 0;

            const gst = (amt * gstPercent) / 100;
            const total = amt + gst;

            rowElement.find('.cfs_gstAmount').val(gst.toFixed(2));
            rowElement.find('.cfs_total').val(total.toFixed(2));


            calculateCfsGrandTotals();
        });
    });
    function attachCalculationHandlers(row) {
        $(row).find('.cfs_amtbeforegst,.cfs_gstpercentage').on('input', function () {
            const rowElement = $(this).closest('tr');
            const amt = parseFloat(rowElement.find('.cfs_amtbeforegst').val()) || 0;
            const gstPercent = parseFloat(rowElement.find('.cfs_gstpercentage').val()) || 0;
            const gst = (amt * gstPercent) / 100;
            const total = amt + gst;


            rowElement.find('.cfs_gstAmount').val(gst.toFixed(2));
            rowElement.find('.cfs_total').val(total.toFixed(2));
        });
        $(row).find('.amt-before-gst,.oc-gstPercentage').on('input', function () {
            const rowElement = $(this).closest('tr');
            const amt = parseFloat(rowElement.find('.amt-before-gst').val()) || 0;
            const gstPercent = parseFloat(rowElement.find('.oc-gstPercentage').val()) || 0;

            const gst = (amt * gstPercent)/100;
            const total = amt + gst;


            rowElement.find('.gst').val(gst.toFixed(2));
            rowElement.find('.total').val(total.toFixed(2));
        });
        $(row).find('.amt-before-gst,.oc-BLgstPercentage').on('input', function () {
            const rowElement = $(this).closest('tr');
            const amt = parseFloat(rowElement.find('.amt-before-gst').val()) || 0;
            const gstPercent = parseFloat(rowElement.find('.oc-BLgstPercentage').val()) || 0;

            const gst = (amt * gstPercent)/100;
            const total = amt + gst;


            rowElement.find('.gst').val(gst.toFixed(2));
            rowElement.find('.total').val(total.toFixed(2));
        });

    }
    function updateSrNo() {
        const rows = document.querySelectorAll('#chargesTable tbody tr');

        rows.forEach((row, index) => {
            const srNoCell = row.querySelector('.sr-no');
            if (srNoCell) {

                srNoCell.textContent = index + 1;
            }
        });
        $('#chargesSummaryBody .oc-summary-row').each(function () {
            $(this).find('td:first-child').text(srNo++);
        });
        const rows2 = document.querySelectorAll('#BLchargesTable tbody tr');

        rows2.forEach((row, index) => {
            const srNoCell = row.querySelector('.sr-no');
            if (srNoCell) {

                srNoCell.textContent = index + 1;
            }
        });
        $('#chargesSummaryBody .oc-BLsummary-row').each(function () {
            $(this).find('td:first-child').text(srNo++);
        });
        $('#CfschargesTable tbody tr').each(function (index) {
            $(this).find('.sr-no').text(index + 1);
        });
    }
    function addRow() {
        const tableBody = document.querySelector('#chargesTable tbody');
        const firstRow = tableBody.querySelector('tr');

        const newRow = firstRow.cloneNode(true);




        newRow.querySelectorAll('input').forEach(input => {
            input.value = '';
        });


        newRow.querySelector('.oc-amt-before-gst').setAttribute('placeholder', '0.00');
        newRow.querySelector('.oc-gstPercentage').setAttribute('placeholder', '0.00');
        newRow.querySelector('.oc-gstAmount').setAttribute('placeholder', '0.00');
        newRow.querySelector('.oc-total').setAttribute('placeholder', '0.00');

        const invDateInput = newRow.querySelector('.oc-invdate');
        invDateInput.value = '';
        invDateInput.setAttribute('placeholder', 'dd/mm/yy');

        tableBody.appendChild(newRow);

        updateSrNo();
        initializeDatePickers();

        $(invDateInput).datepicker({
            dateFormat: 'dd/mm/yy'
        });


        attachCalculationHandlers(newRow);

        const tableBody1 = document.querySelector('#CfschargesTable tbody');
        const firstRow1 = tableBody1.querySelector('tr');
        const newRow1 = firstRow1.cloneNode(true);
        const rows = tableBody1.querySelectorAll('tr');
        newRow1.querySelectorAll('input').forEach(input => {
            input.value = '';
        });
        newRow1.querySelector('.cfs_amtbeforegst').setAttribute('placeholder', '0.00');
        newRow1.querySelector('.cfs_gstpercentage').setAttribute('placeholder', '0');
        newRow1.querySelector('.cfs_gstAmount').setAttribute('placeholder', '0.00');
        newRow1.querySelector('.cfs_total').setAttribute('placeholder', '0.00');
        const summaryRowCount = 2;
        const insertBeforeRow = rows[rows.length - summaryRowCount];

        tableBody1.insertBefore(newRow1, insertBeforeRow);

        updateSrNo();
        attachCalculationHandlers(newRow1);
        calculateCfsGrandTotals();
    }
    function addRow2() {

        const tableBody2 = document.querySelector('#BLchargesTable tbody');
        const firstRow2 = tableBody2.querySelector('tr');

        const newRow2 = firstRow2.cloneNode(true);




        newRow2.querySelectorAll('input').forEach(input => {
            input.value = '';
        });


        newRow2.querySelector('.oc-BLamt-before-gst').setAttribute('placeholder', '0.00');
        newRow2.querySelector('.oc-BLgstPercentage').setAttribute('placeholder', '0.00');
        newRow2.querySelector('.oc-BLgstAmount').setAttribute('placeholder', '0.00');
        newRow2.querySelector('.oc-BLtotal').setAttribute('placeholder', '0.00');

        const invDateInput2 = newRow2.querySelector('.oc-BLinvdate');
        invDateInput2.value = '';
        invDateInput2.setAttribute('placeholder', 'dd/mm/yy');

        tableBody2.appendChild(newRow2);
        updateSrNo();
        initializeDatePickers();


        $(invDateInput2).datepicker({
            dateFormat: 'dd/mm/yy'
        });

      attachCalculationHandlers(newRow2);

        updateSrNo();

        calculateCfsGrandTotals();
    }
  /*  function addRow() {
        const tableBody = document.querySelector('#chargesTable tbody');
        const firstRow = tableBody.querySelector('tr');
        const tableBody2 = document.querySelector('#BLchargesTable tbody');
        const firstRow2 = tableBody.querySelector('tr');

        const newRow = firstRow.cloneNode(true);
        const newRow2 = firstRow1.cloneNode(true);



        newRow.querySelectorAll('input').forEach(input => {
            input.value = '';
        });
        newRow2.querySelectorAll('input').forEach(input => {
            input.value = '';
        });

        newRow.querySelector('.oc-amt-before-gst').setAttribute('placeholder', '0.00');
        newRow.querySelector('.oc-gstPercentage').setAttribute('placeholder', '0.00');
        newRow.querySelector('.oc-gstAmount').setAttribute('placeholder', '0.00');
        newRow.querySelector('.oc-total').setAttribute('placeholder', '0.00');
        newRow2.querySelector('.oc-amt-before-gst').setAttribute('placeholder', '0.00');
        newRow2.querySelector('.oc-gstPercentage').setAttribute('placeholder', '0.00');
        newRow2.querySelector('.oc-gstAmount').setAttribute('placeholder', '0.00');
        newRow2.querySelector('.oc-total').setAttribute('placeholder', '0.00');
        const invDateInput = newRow.querySelector('.oc-invdate');
        invDateInput.value = '';
        invDateInput.setAttribute('placeholder', 'dd/mm/yy');

        tableBody.appendChild(newRow);

        const invDateInput2 = newRow2.querySelector('.oc-invdate');
        invDateInput2.value = '';
        invDateInput2.setAttribute('placeholder', 'dd/mm/yy');

        tableBody2.appendChild(newRow2);
        updateSrNo();
        initializeDatePickers();

        $(invDateInput).datepicker({
            dateFormat: 'dd/mm/yy'
        });
        $(invDateInput2).datepicker({
            dateFormat: 'dd/mm/yy'
        });

        attachCalculationHandlers(newRow);
        attachCalculationHandlers(newRow2);
        const tableBody1 = document.querySelector('#CfschargesTable tbody');
        const firstRow1 = tableBody1.querySelector('tr');
        const newRow1 = firstRow1.cloneNode(true);
        const rows = tableBody1.querySelectorAll('tr');
        newRow1.querySelectorAll('input').forEach(input => {
            input.value = '';
        });
        newRow1.querySelector('.cfs_amtbeforegst').setAttribute('placeholder', '0.00');
        newRow1.querySelector('.cfs_gstpercentage').setAttribute('placeholder', '0');
        newRow1.querySelector('.cfs_gstAmount').setAttribute('placeholder', '0.00');
        newRow1.querySelector('.cfs_total').setAttribute('placeholder', '0.00');
        const summaryRowCount = 2;
        const insertBeforeRow = rows[rows.length - summaryRowCount];

        tableBody1.insertBefore(newRow1, insertBeforeRow);

        updateSrNo();
        attachCalculationHandlers(newRow1);
        calculateCfsGrandTotals();
    }*/
    function removeRow2(button) {

             const row1 = button.closest('tr');
     const tableBody1 = document.querySelector('#CfschargesTable tbody');
        if (tableBody1.rows.length > 1) {

            const isBlankRow1 =
                !$(row1).find('.cfs-nature_of_service').val()&&
                !$(row1).find('.cfs_amtbeforegst').val() &&
                !$(row1).find('.cfs_gstpercentage').val() &&
                !$(row1).find('.cfs_gstAmount').val() &&
                !$(row1).find('.cfs_total').val();


    if (isBlankRow1) {

        row1.remove();
        updateSrNo();
        return;
    }
            if (confirm("Are you sure you want to delete this charge?")) {

    const urlDeleteRequest = '@Url.Action("DeleteCFSOtherChargeRecords", "ExportTracker")';
    const invoice_no = $('#invoiceDropdown').val();


    const charge1 = {

        Cfs_RowId: $(row1).find('.cfs_rowid').val(),
        Nature_of_Service: $(row1).find('.cfs-nature_of_service').val(),
        AmtBeforeGST: $(row1).find('.cfs_amtbeforegst').val(),
        GstPercentage: $(row1).find('.cfs_gstpercentage').val(),
        GstAmount: $(row1).find('.cfs_gstAmount').val(),
        Total: $(row1).find('.cfs_total').val()

    };

    const model = {
        Invoice_No: invoice_no,
        CFSOtherCharges: [charge1]
    };

    // Send AJAX request to delete
    $.ajax({
        url: urlDeleteRequest,
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(model),
        success: function (response) {
            if (response.success) {

                row1.remove();
            /*    const amt = parseFloat(charge.OC_Amt_Before_GST);
                const gst = parseFloat(charge.OC_GST);
                const total = parseFloat(charge.OC_Total);

                // Remove matching row from summary table
                $('#chargesSummaryTable tbody tr').each(function () {
                    const summaryAmt = parseFloat($(this).find('.td-amt').text());
                    const summaryGst = parseFloat($(this).find('.td-gst').text());
                    const summaryTotal = parseFloat($(this).find('.td-total').text());

                    // Check for matching charge details (amt, gst, total)
                    if (summaryAmt === amt && summaryGst === gst && summaryTotal === total) {
                        $(this).remove();
                    }
                });*/
                updateSrNo();
                calculateCfsGrandTotals();

                alert('✅ Record deleted successfully');
            } else {
                alert('❌ Failed to delete record: ' + response.message);
            }
        },
        error: function () {
            alert('❌ Error deleting record from server.');

        }
    });
}

}
    }
    function removeRow(button) {
    const row = button.closest('tr');
    const tableBody = document.querySelector('#chargesTable tbody');

    // Only allow deletion if more than one row exists
        if (tableBody.rows.length > 1) {

            const isBlankRow =
                !$(row).find('.oc-vendor').val() &&
                !$(row).find('.oc-invoice-no').val() &&
                !$(row).find('.oc-invdate').val() &&
                !$(row).find('.oc-particulars').val() &&
                !$(row).find('.oc-amt-before-gst').val() &&
                !$(row).find('.oc-gstPercentage').val() &&
                !$(row).find('.oc-gstAmount').val() &&
                !$(row).find('.oc-total').val();

            if (isBlankRow) {
                // Just remove the row without AJAX call
                row.remove();
                updateSrNo();
                return;
            }
        if (confirm("Are you sure you want to delete this charge?")) {
            const urlDeleteRequest = '@Url.Action("DeleteOtherChargeRecords", "ExportTracker")';
            const invoice_no = $('#invoiceDropdown').val();

            // Collect values from the row
            const charge = {

                OC_RowId: $(row).find('.oc-rowid').val() || null,
                OC_Vendor: $(row).find('.oc-vendor').val(),
                OC_Invoice_No: $(row).find('.oc-invoice-no').val(),
                OC_InvDate: $(row).find('.oc-invdate').val(),
                OC_Particulars: $(row).find('.oc-particulars').val(),
                OC_Amt_Before_GST: $(row).find('.oc-amt-before-gst').val(),
                OC_GSTPercentage: $(row).find('.oc-gstPercentage').val(),
                OC_GSTAmount: $(row).find('.oc-gstAmount').val(),
                OC_Total: $(row).find('.oc-total').val()
            };

            const model = {
                Invoice_No: invoice_no,
                OtherCharges: [charge]
            };

            $.ajax({
                url: urlDeleteRequest,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(model),
                success: function (response) {
                    if (response.success) {
                        row.remove();
                        const amt = parseFloat(charge.OC_Amt_Before_GST);
                        const gst = parseFloat(charge.OC_GSTAmount);
                        const total = parseFloat(charge.OC_Total);


                        $('#chargesSummaryTable tbody tr').each(function () {
                            const summaryAmt = parseFloat($(this).find('.td-amt').text());
                            const summaryGst = parseFloat($(this).find('.td-gst').text());
                            const summaryTotal = parseFloat($(this).find('.td-total').text());


                            if (summaryAmt === amt && summaryGst === gst && summaryTotal === total) {
                                $(this).remove();
                            }
                        });
                        updateSrNo();

                        alert('✅ Record deleted successfully');
                    } else {
                        alert('❌ Failed to delete record: ' + response.message);
                    }
                },
                error: function () {
                    alert('❌ Error deleting record from server.');

                }
            });
        }

        }

}
    function removeRow3(button) {
    const row = button.closest('tr');
        const tableBody = document.querySelector('#BLchargesTable tbody');

    // Only allow deletion if more than one row exists
        if (tableBody.rows.length > 1) {

            const isBlankRow =
                !$(row).find('.oc-BLvendor').val() &&
                !$(row).find('.oc-BLinvoice-no').val() &&
                !$(row).find('.oc-BLinvdate').val() &&
                !$(row).find('.oc-BLparticulars').val() &&
                !$(row).find('.oc-BLamt-before-gst').val() &&
                !$(row).find('.oc-BLgstPercentage').val() &&
                !$(row).find('.oc-BLgstAmount ').val() &&
                !$(row).find('.oc-BLtotal').val();

            if (isBlankRow) {
                // Just remove the row without AJAX call
                row.remove();
                updateSrNo();
                return;
            }
        if (confirm("Are you sure you want to delete this charge?")) {
            const urlDeleteRequest = '@Url.Action("DeleteOtherChargeRecords", "ExportTracker")';
            const invoice_no = $('#invoiceDropdown').val();

            // Collect values from the row
            const charge = {

                OC_RowId: $(row).find('.oc-BLrowid').val() || null,
                OC_Vendor: $(row).find('.oc-BLvendor').val(),
                OC_Invoice_No: $(row).find('.oc-BLinvoice-no').val(),
                OC_InvDate: $(row).find('.oc-BLinvdate').val(),
                OC_Particulars: $(row).find('.oc-BLparticulars').val(),
                OC_Amt_Before_GST: $(row).find('.oc-BLamt-before-gst').val(),
                OC_GSTPercentage: $(row).find('.oc-BLgstPercentage').val(),
                OC_GSTAmount: $(row).find('.oc-BLgstAmount ').val(),
                OC_Total: $(row).find('.oc-BLtotal').val()
            };

            const model = {
                Invoice_No: invoice_no,
                OtherCharges: [charge]
            };

            $.ajax({
                url: urlDeleteRequest,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(model),
                success: function (response) {
                    if (response.success) {
                        row.remove();
                        const amt = parseFloat(charge.OC_Amt_Before_GST);
                        const gst = parseFloat(charge.OC_GSTAmount);
                        const total = parseFloat(charge.OC_Total);


                        $('#chargesSummaryTable tbody tr').each(function () {
                            const summaryAmt = parseFloat($(this).find('.td-amt').text());
                            const summaryGst = parseFloat($(this).find('.td-gst').text());
                            const summaryTotal = parseFloat($(this).find('.td-total').text());


                            if (summaryAmt === amt && summaryGst === gst && summaryTotal === total) {
                                $(this).remove();
                            }
                        });
                        updateSrNo();

                        alert('✅ Record deleted successfully');
                    } else {
                        alert('❌ Failed to delete record: ' + response.message);
                    }
                },
                error: function () {
                    alert('❌ Error deleting record from server.');

                }
            });
        }

        }

}




    document.addEventListener('DOMContentLoaded', updateSrNo);
    function autoClickTab(tabId) {

        const tab = document.getElementById(tabId);
        if (tab) { tab.click(); }
    }

    //05/02/26 12:34 data add load invoice data and finalsave
    function updateChargesPabelLoadData() {

        document.getElementById("td_CCAmt_Before_GST").textContent = document.getElementById("CCAmt_Before_GST")?.value || "0.00";
        document.getElementById("td_CCGST").textContent = document.getElementById("CCGST")?.value || "0.00";
        document.getElementById("td_CC_total").textContent = document.getElementById("CC_total")?.value || "0.00";

        document.getElementById("td_FCSAmt_Before_GST").textContent = document.getElementById("FCSAmt_Before_GST")?.value || "0.00";
        document.getElementById("td_FCSGST").textContent = document.getElementById("FCSGST")?.value || "0.00";
        document.getElementById("td_FCSTotal").textContent = document.getElementById("FCSTotal")?.value || "0.00";

        document.getElementById("td_FCAAMT_before_GST").textContent = document.getElementById("FCAAMT_before_GST")?.value || "0.00";
        document.getElementById("td_FCAGST").textContent = document.getElementById("FCAGST")?.value || "0.00";
        document.getElementById("td_FCATotal").textContent = document.getElementById("FCATotal")?.value || "0.00";

        document.getElementById("td_TC_AMT_Before_GST").textContent = document.getElementById("TC_AMT_Before_GST")?.value || "0.00";
        document.getElementById("td_TC_GST").textContent = document.getElementById("TC_GST")?.value || "0.00";
        document.getElementById("td_TC_Total").textContent = document.getElementById("TC_Total")?.value || "0.00";

        document.getElementById("td_CFS_Amt_Before_GST").textContent = document.getElementById("CFS_Amt_Before_GST")?.value || "0.00";
        document.getElementById("td_CFS_GST").textContent = document.getElementById("CFS_GST")?.value || "0.00";
        document.getElementById("td_CFS_Total").textContent = document.getElementById("CFS_Total")?.value || "0.00";

        document.getElementById("td_AddTC_AMT_Before_GST").textContent = document.getElementById("AddTC_AMT_Before_GST")?.value || "0.00";
        document.getElementById("td_AddTC_GST").textContent = document.getElementById("AddTC_GST")?.value || "0.00";
        document.getElementById("td_AddTC_Total").textContent = document.getElementById("AddTC_Total")?.value || "0.00";

        document.getElementById("td_COO_Amt_Before_GST").textContent = document.getElementById("COO_Amt_Before_GST")?.value || "0.00";
        document.getElementById("td_COO_GST").textContent = document.getElementById("COO_GST")?.value || "0.00";
        document.getElementById("td_COO_Total").textContent = document.getElementById("COO_Total")?.value || "0.00";

        document.getElementById("td_EIA_Amt_Before_GST").textContent = document.getElementById("EIA_Amt_Before_GST")?.value || "0.00";
        document.getElementById("td_EIA_GST").textContent = document.getElementById("EIA_GST")?.value || "0.00";
        document.getElementById("td_EIA_Total").textContent = document.getElementById("EIA_Total")?.value || "0.00";

        updateChargeRowsVisibilityAndSerialNumbers();
        updateOtherChargesSummary();
        calculateCfsGrandTotals();
    }

</script>

<script>
    $(document).ready(function () {

        //11/02/26 12:34 auto calculate and set 0.00 if empty on blur for all charges tables

        //Clearance Charges
        $(document).on(
            'keydown',
            '#tblClearanceCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val();
                if (val === '0' || val === '0.00') {
                    $(this).val('');
                }
            }
        );

        $(document).on(
            'blur',
            '#tblClearanceCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val().trim();
                if (val === '') {
                    $(this).val('0.00');
                }
            }
        );

        //Forwarder Charges (Sea)
        $(document).on(
            'keydown',
            '#tblSeaForwerderCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val();
                if (val === '0' || val === '0.00') {
                    $(this).val('');
                }
            }
        );

        $(document).on(
            'blur',
            '#tblSeaForwerderCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val().trim();
                if (val === '') {
                    $(this).val('0.00');
                }
            }
        );

        //Forwarder Charges (Air)
        $(document).on(
            'keydown',
            '#tblAirForwerderCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val();
                if (val === '0' || val === '0.00') {
                    $(this).val('');
                }
            }
        );

        $(document).on(
            'blur',
            '#tblAirForwerderCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val().trim();
                if (val === '') {
                    $(this).val('0.00');
                }
            }
        );


        // TC Charges
        $(document).on(
            'keydown',
            '#tblTCCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val();
                if (val === '0' || val === '0.00') {
                    $(this).val('');
                }
            }
        );

        $(document).on(
            'blur',
            '#tblTCCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val().trim();
                if (val === '') {
                    $(this).val('0.00');
                }
            }
        );

        // CFS Charges
        $(document).on(
            'keydown',
            '#CfschargesTable input.form-control:not([readonly])',
            function () {

                let val = $(this).val();
                if (val === '0' || val === '0.00') {
                    $(this).val('');
                }
            }
        );

        $(document).on(
            'blur',
            '#CfschargesTable input.form-control:not([readonly])',
            function () {

                let val = $(this).val().trim();
                if (val === '') {
                    $(this).val('0.00');
                }
            }
        );

        // Add TC Charges
        $(document).on(
            'keydown',
            '#tblAddTCCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val();
                if (val === '0' || val === '0.00') {
                    $(this).val('');
                }
            }
        );

        $(document).on(
            'blur',
            '#tblAddTCCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val().trim();
                if (val === '') {
                    $(this).val('0.00');
                }
            }
        );

        // COO Charges
        $(document).on(
            'keydown',
            '#tblCOOCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val();
                if (val === '0' || val === '0.00') {
                    $(this).val('');
                }
            }
        );

        $(document).on(
            'blur',
            '#tblCOOCharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val().trim();
                if (val === '') {
                    $(this).val('0.00');
                }
            }
        );

        // EIA Charges
        $(document).on(
            'keydown',
            '#tblEIACharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val();
                if (val === '0' || val === '0.00') {
                    $(this).val('');
                }
            }
        );

        $(document).on(
            'blur',
            '#tblEIACharges input.form-control:not(:disabled)',
            function () {

                let val = $(this).val().trim();
                if (val === '') {
                    $(this).val('0.00');
                }
            }
        );

        //BL Charges
        $(document).on(
            'keydown',
            '#BLchargesTable .oc-BLamt-before-gst:not(:disabled), #BLchargesTable .oc-BLgstPercentage:not(:disabled)',
            function () {

                let val = $(this).val();
                if (val === '0.00' || val === '0') {
                    $(this).val('');
                }
            }
        );

        $(document).on(
            'blur',
            '#BLchargesTable .oc-BLamt-before-gst:not(:disabled), #BLchargesTable .oc-BLgstPercentage:not(:disabled), ' +
            '#chargesTable .oc-amt-before-gst:not(:disabled), #chargesTable .oc-gstPercentage:not(:disabled)',
            function () {

                let val = $(this).val().trim();
                if (val === '') {
                    $(this).val('0.00');
                }
            }
        );

        //Other Charges
        $(document).on(
            'keydown',
            '#chargesTable .oc-amt-before-gst:not(:disabled), #chargesTable .oc-gstPercentage:not(:disabled)',
            function () {

                let val = $(this).val();
                if (val === '0.00' || val === '0') {
                    $(this).val('');
                }
            }
        );

        $(document).on(
            'blur',
            '#chargesTable .oc-amt-before-gst:not(:disabled), #chargesTable .oc-gstPercentage:not(:disabled)',
            function () {

                let val = $(this).val().trim();
                if (val === '') {
                    $(this).val('0.00');
                }
            }
        );
    });
</script>

@section scripts
        {
    <script src="~/WebFormScripts/ExtOperation.js"></script>
    <link href="~/Content/Css/TSCommon.css" rel="stylesheet" />
    <script src="~/Content/plugins/datatables/jquery.dataTables.min.js"></script>


}


